---
title: 'POLS 1600: Final Paper Template'
author: "Group XX: Member names here "
date: "4/14/2022"
output:
  html_document:
    theme: journal
    toc: TRUE
    toc_float: TRUE
    toc_depth: 2
    number_sections: TRUE
---

```{r init,echo=F, message=F,results=F}
# Set global options for knitr
knitr::opts_chunk$set(error = TRUE, 
                      echo = F,
                      results = "hide",
                      comment = NA, 
                      warning = FALSE, 
                      error = FALSE, 
                      message = FALSE, 
                      cache = FALSE,
                      tidy = FALSE)
```


# Introduction 

This document provides a template for the structure of your final papers for POLS 1600. 

Replace this markdown text with the introduction to your paper that:

- Clearly articulates your group's research question

- Lays out the theoretical framework that motivates your inquiry

- Describes your empirical strategy

- Provides an outline of the rest of the paper and previews your results.


# Theory and Expectations 

In this section you will develop on your theoretical framework to develop a set of testable empirical implications that address your broader research question.

This section should begin by explaining the following:

- What is the phenomena you are studying? (Research Question/Outcome of Interest)

- Why should we care about this phenomena? (Context/Motivation/Importance)

Then it should turn to addressing:

- What are the factors scholars think explain this phenomena? (Literature Review/Key predictors/Alternative explanations)

Which should lead to a discussion of

- What are the empirical implications of these claims? (Testable hypotheses)


# Data 

In this section you will describe your data. 

- Identify the source or sources of your data
- Define the unit of analysis and number of observations in your data
- Explain how your key concepts (outcome variable, key predictors, covariates/alternative explanations) are operationalized and measured
- Describe the distributions of these data using a table and/or figure(s). 
- Interpret these distributions for your reader. What does a typical observation in the data look like. Are some data skewed. Are their big outliers 

Before that adapt the code chunks below to:

- Set up the work space
- Load your data
- Recode and transform the data as needed
- Produce tables of summary statistics and figures

I've included code chunks in the .Rmd file to demonstrate this process using data from the 2020 National Election Time Series Study. 

However, you won't see that code until in the knitted document until you get to the code appendix at the end.


```{r setup, message=F}
# ---- Packages ----

# Pacakges used in analysis
the_packages <- c(
  ## R Markdown
  "kableExtra","DT","texreg","htmltools",
  "flair", # Comments only
  ## Tidyverse
  "tidyverse", "lubridate", "forcats", "haven", "labelled",
  "modelr", "purrr",
  ## Extensions for ggplot
  "ggmap","ggrepel", "ggridges", "ggthemes", "ggpubr", 
  "GGally", "scales", "dagitty", "ggdag", "ggforce",
  # Data 
  "COVID19","maps","mapdata","qss","tidycensus", "dataverse",
  # Analysis
  "DeclareDesign", "boot"
)

# Define function to load packages
ipak <- function(pkg){
    new.pkg <- pkg[!(pkg %in% installed.packages()[, "Package"])]
    if (length(new.pkg)) 
        install.packages(new.pkg, dependencies = TRUE)
    sapply(pkg, require, character.only = TRUE)
}

ipak(the_packages)
```

```{r data}
# Uncomment to install
# remotes::install_github("jamesmartherus/anesr")
library(anesr)

# Load 2020 NES
data("timeseries_2020", package ="anesr")

# rename timeseries_2020 to df
df <- timeseries_2020

```

```{r recodes}

df %>%
  mutate(
    # ---- OUTCOMES ----
    
    ## V201233 PRE: HOW OFTEN TRUST GOVERNMENT IN WASHINGTON TO DO WHAT IS RIGHT
    ### Reverse code so 0 = Never, 4 = Always
    trust_gov = ifelse(V201233 < 0, NA, (V201233-5)*-1),
    
    # ---- KEY PREDICTORs ----
    
    ## V202457 POST: HAS R EVER BEEN ARRESTED
    been_arrested = case_when(
      V202457 == 2 ~ 0,
      V202457 == 1 ~ 1,
      T ~ NA_real_
    ),
    ## V202456: DURING PAST 12 MONTHS, R OR ANY FAMILY MEMBERS STOPPED BY POLICE
    police_stop_12mo = case_when(
      V202456 == 2 ~ 0,
      V202456 == 1 ~ 1,
      T ~ NA_real_
    ),
    
    # ---- COVARIATES ----
    
    ## V201549x  PRE: SUMMARY: R selfâ€identified race/ethnicity
    race_f = ifelse(
      V201549x < 0, NA,
      # Remove numbers from race variable labels
      gsub("^[[:graph:]]* ", "", as_factor(V201549x))
    ),
    is_white = ifelse(race_f == "White, non-Hispanic", 1, 0),
    is_nonwhite = ifelse(is_white == 1, 0, 1),
    ## V201617x PRE: SUMMARY: Total (family) income
    income  = ifelse(V201617x < 0, NA, V201617x),
    income_class = case_when(
      income <= 6 ~ "Low income",
      income > 6 & income < 17 ~ "Middle income",
      income >= 17 ~ "High income",
      T ~ NA_character_
    ) %>% factor(., levels = c("Middle income","Low income","High income")) # Make middle income reference category
    
  ) -> df



# ---- Check Recodes ----

## Trust
table(df$V201233, df$trust_gov, useNA = "ifany")
## CJS Contact

### Respondented Arrested Ever
table(df$V202457, df$been_arrested, useNA = "ifany")

### Respondent or peers/family been stopped by police in past year
table(df$V202456, df$police_stop_12mo, useNA = "ifany")

## Race
table(df$race_f, df$V201549x, useNA = "ifany")
### White indicator
table(df$race_f, df$is_white, useNA = "ifany")

### Non-White indicator
table(df$race_f, df$is_nonwhite, useNA = "ifany")

## Income
table(df$income, df$income_class)
```


```{r descriptives}

# Variables for table of descriptive statistics:
the_vars <- c("trust_gov",
              "been_arrested", "police_stop_12mo",
              "is_nonwhite",
              "income")

# Create table of summary statistics

df %>%
  select(all_of(the_vars))%>%
  pivot_longer(
    cols = all_of(the_vars),
    names_to = "Variable"
  )%>%
  mutate(
    Variable = factor(Variable, levels = the_vars)
  )%>%
  arrange(Variable)%>%
  dplyr::group_by(Variable)%>%
  dplyr::summarise(
    min = min(value, na.rm=T),
    p25 = quantile(value, na.rm=T, prob = 0.25),
    Median = quantile(value, na.rm=T, prob = 0.5),
    mean = mean(value, na.rm=T),
    p75 = quantile(value, na.rm=T, prob = 0.25),
    max = max(value, na.rm=T),
    missing = sum(is.na(value))
  ) %>%
  mutate(
    Variable = case_when(
      Variable == "been_arrested" ~ "Ever Arrested",
      Variable == "income" ~ "Income",
      Variable == "police_stop_12mo" ~ "Stopped by Police in Past Year",
      Variable == "is_nonwhite" ~ "Is Non-White",
      Variable == "trust_gov" ~ "Trust in Government"
    )
  ) -> sum_df

# ---- Descriptive Figures ----


## Distribution of trust in Government
fig1 <- df %>%
  ggplot(aes(trust_gov))+
  geom_histogram()+
  labs(
    x = "Trust in Government"
  )

## 

fig2 <- df %>%
  mutate(
    `Ever Arrested` = ifelse(been_arrested == 1, "Yes", "No")
  ) %>%
  filter(!is.na(`Ever Arrested`))%>%
  ggplot(aes(`Ever Arrested`,trust_gov, 
             fill = `Ever Arrested`,
             group = `Ever Arrested`))+
  stat_summary()+
  labs(
    y = "Trust in Government\n(0 = Never, 4 = Always)"
  )

```

```{r sumtab, results="asis"}
knitr::kable(sum_df,
             caption = "Descriptive Statistics") %>%
  kableExtra::kable_styling() %>%
  kableExtra::pack_rows("Outcome", start_row = 1, end_row =1) %>%
  kableExtra::pack_rows("Key Predictors", start_row = 2, end_row =3) %>%
  kableExtra::pack_rows("Covariates", start_row = 4, end_row =5)

```


```{r fig1, fig.cap="Distribution of Trust in Government"}
fig1
```


```{r fig2, fig.cap="Average Trust in Government by Arrest Status"}
fig2
```


# Design 

In this section you'll 

# Results 

# Conclusion 

# Code Appendix 


```{r, echo=T, eval=F}
<<init>>

<<setup>>

<<data>>

<<recodes>>

<<descriptives>>

<<sumtab>>

<<fig1>>

<<fig2>>
```

