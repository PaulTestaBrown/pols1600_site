{
  "hash": "a02864ba5d52181a994e07d947eb5786",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: 'Lab 08 - Replicating Grumbach and Hill (2022):'\nsubtitle: \"Reproducing the results\"\nauthor: \"P.F. Testa\"\ndate: \"Last Updated 2024-03-19\"\nformat:\n  html:\n    toc: true\n    toc-location: right\n    toc-float: true\n    toc-depth: 2\n    number-sections: true\nexecute: \n  eval: true\n  echo: true\n  warning: false\n  message: false\n  cache: true\n---\n\n\n\n# Overview {.unnumbered}\n\nIn this lab, we continue our replication of Grumbach and Hill (2021) \"Rock the Registration: Same Day Registration Increases Turnout of Young Voters.\"\n\nTo accomplish this we will:\n\n0. Load packages and set the working directory to **where this file is saved**. (5 minutes)\n\n1. **Summarize the study** in terms of it's research question, theory, design, and results. (10 minutes)\n\n2. Download the replication files and **save them in the same folder as this lab** (5 minutes)\n\n3. **Load the data** from your computers into R (5 minutes)\n\n4. Get a quick **HLO** of the data (10 minutes)\n\n5. **Merge** data on election policy into data on voting (5 minutes, together),\n\n6. **Recode** the covariates, key predictors, and outcome for the study (10 minutes, partly together)\n\n7. Recreate **Figure 1** (15 minutes)\n\n8. Recreate **Figure 2** (15 minutes)\n\nFinally, we'll take the weekly survey which should be a **fun** one\n\nOne of these 8 tasks will be randomly selected as the graded question for the lab.\n\nYou will work in your assigned groups. Only one member of each group needs to submit the html file of lab.\n\nThis lab **must** contain the names of the group members in attendance.\n\nIf you are attending remotely, you will submit your labs individually.\n\nHere are your assigned groups for the semester.\n\n\n::: {.cell}\n::: {.cell-output-display}\n\n```{=html}\n<div class=\"datatables html-widget html-fill-item\" id=\"htmlwidget-39c3f98e803d8e4c44b2\" style=\"width:100%;height:auto;\"></div>\n<script type=\"application/json\" data-for=\"htmlwidget-39c3f98e803d8e4c44b2\">{\"x\":{\"filter\":\"none\",\"vertical\":false,\"data\":[[\"1\",\"2\",\"3\",\"4\",\"5\",\"6\",\"7\",\"8\"],[\"Group 1\",\"Group 2\",\"Group 3\",\"Group 4\",\"Group 5\",\"Group 6\",\"Group 7\",\"Group 8\"],[\"Maia Eng\",\"Andrew Rovinsky\",\"Serafym Rybachkivskyi\",\"Tiffany Eddy\",\"Christopher Maron\",\"Mia Hamilton\",\"Mariana Melzer\",\"Logan Szittai\"],[\"Guadalupe Herrera\",\"Spencer Lorin\",\"Rachel Kim\",\"Daniel Solomon\",\"Daniel Baker\",\"Emily Colon\",\"Kahrie Langham\",\"Keiley Thompson\"],[\"Stephen Robinson\",\"Lucinda Anderson\",\"Kai Blades\",\"Zoe Smith\",\"Neve Diaz-Carr\",\"Davis Kelly\",\"Shannon Feerick-Hillenbrand\",\"Lydell Dyer\"],[\"Jeremiah Harrington\",\"Serenity Hamilton\",\"Emma Coleman\",\"Lorena Calderon\",\"Olivia Hanley\",\"Talia Levine\",\"Jarret Fernandes\",\"Mahir Arora\"]],\"container\":\"<table class=\\\"display\\\">\\n  <thead>\\n    <tr>\\n      <th> <\\/th>\\n      <th>Group<\\/th>\\n      <th>1<\\/th>\\n      <th>2<\\/th>\\n      <th>3<\\/th>\\n      <th>4<\\/th>\\n    <\\/tr>\\n  <\\/thead>\\n<\\/table>\",\"options\":{\"columnDefs\":[{\"orderable\":false,\"targets\":0},{\"name\":\" \",\"targets\":0},{\"name\":\"Group\",\"targets\":1},{\"name\":\"1\",\"targets\":2},{\"name\":\"2\",\"targets\":3},{\"name\":\"3\",\"targets\":4},{\"name\":\"4\",\"targets\":5}],\"order\":[],\"autoWidth\":false,\"orderClasses\":false}},\"evals\":[],\"jsHooks\":[]}</script>\n```\n\n:::\n:::\n\n\n# Goals {.unnumbered}\n\nThis week's lab will give you practice:\n\n- Summarizing academic work (Q1)\n\n- Loading data into R from your own computer (rather than just downloading it from the web) (Q2-3)\n\n- Looking at new data and figuring out what you need to do (e.g. merging, recoding) before you can analyze it (Q4-6)\n\n- Creating and interpreting figures that summarize aspects of a study's design and data (Q7-8)\n\nNext week, we'll get into the nuts and bolts of replicating Grumbach and Hill's main results\n\n\n# Workflow {.unnumbered}\n\n## Please render this .qmd file {.unnumbered}\n\nAs with every lab, you should:\n\n-   Download the file\n-   Save it in your course folder\n-   **Update the `author:` section of the YAML header to include the names of your group members in attendance.**\n-   Render the document\n-   Open the html file in your browser (Easier to read)\n-   Write your code in the **chunks provided under each section**\n-   Comment out or delete any test code you do not need\n-   **Render the document again after completing a section or chunk** (Error checking)\n-   Upload the final lab to [Canvas](https://canvas.brown.edu/courses/1094972/assignments){target=\"_blank\"}.\n\n# Get set up to work{.unnumbered}\n\n## Load packages {.unnumbered}\n\n\nAs always, let's load the packages we'll need for today\n\n\n::: {.cell}\n\n```{.r .cell-code}\nthe_packages <- c(\n  ## R Markdown\n  \"kableExtra\",\"DT\",\"texreg\",\"htmltools\",\n  ## Tidyverse\n  \"tidyverse\", \"lubridate\", \"forcats\", \"haven\", \"labelled\",\n  ## Extensions for ggplot\n  \"ggmap\",\"ggrepel\", \"ggridges\", \"ggthemes\", \"ggpubr\", \n  \"GGally\", \"scales\", \"dagitty\", \"ggdag\", \"ggforce\",\n  # Data \n  \"COVID19\",\"maps\",\"mapdata\",\"qss\",\"tidycensus\", \"dataverse\",\n  \"janitor\",\n  # Analysis\n  \"DeclareDesign\", \"easystats\", \"zoo\",\"margins\",\n  \"modelsummary\", \"ggeffects\"\n)\n\n# Define function to load packages\nipak <- function(pkg){\n    new.pkg <- pkg[!(pkg %in% installed.packages()[, \"Package\"])]\n    if (length(new.pkg)) \n        install.packages(new.pkg, dependencies = TRUE)\n    sapply(pkg, require, character.only = TRUE)\n}\n\nipak(the_packages)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n   kableExtra            DT        texreg     htmltools     tidyverse \n         TRUE          TRUE          TRUE          TRUE          TRUE \n    lubridate       forcats         haven      labelled         ggmap \n         TRUE          TRUE          TRUE          TRUE          TRUE \n      ggrepel      ggridges      ggthemes        ggpubr        GGally \n         TRUE          TRUE          TRUE          TRUE          TRUE \n       scales       dagitty         ggdag       ggforce       COVID19 \n         TRUE          TRUE          TRUE          TRUE          TRUE \n         maps       mapdata           qss    tidycensus     dataverse \n         TRUE          TRUE          TRUE          TRUE          TRUE \n      janitor DeclareDesign     easystats           zoo       margins \n         TRUE          TRUE          TRUE          TRUE          TRUE \n modelsummary     ggeffects \n         TRUE          TRUE \n```\n\n\n:::\n:::\n\n\n# Load the data\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Set working directory to source file location\n\n# Load data (assumes a file called `cps_clean.rda` is in the same folder as this lab)\n\n\n# # BACKUP: Uncomment if you're having trouble you can load a version of the data from the web:\nload(url(\"https://pols1600.paultesta.org/files/data/cps_clean.rda\"))\n```\n:::\n\n\n# Create additional variables\n\nThe following code **relevels** the factor variable `age_group` so that \"65+\" is the first level of the factor. \n\nWhen `lm()` converts `age_group` to indicators for each in level of the factor, it's excludes the first level, which becomes the `reference category` described by the intercept, $\\beta_0$ in the model.\n\n**Please create the following additional variables, that will be useful for presenting and visualizing data:**\n\n- `election_type` a categorical variable takes a value of \"Presidential\" when `year` is a presidential election, and a value of \"Midterm\" otherwise\n- `SDR` a categorical variable that takes a value of \"SDR\" when `sdr == 1` and 0 otherwise (you may already have this in your data)\n\n\n::: {.cell}\n\n```{.r .cell-code}\npresidential_elections <- seq(1980, 2016, by = 4)\n \ncps %>% \n  mutate(\n    age_group = fct_relevel(age_group, \"65+\"),\n    SDR = ifelse(sdr == 1, \"SDR\",\"non-SDR\"),\n    election_type = ifelse(year %in% presidential_elections, \"General\",\"Midterm\"),\n  ) -> cps\n```\n:::\n\n\n\n# Describing variation by state, year, and policy\n\n## Variation by state\n\nCreate a figure that shows how average turnout varies across state.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Create dataframe of average voting rates by state\ncps %>% \n  group_by(st) %>% \n  summarise(\n    turnout = mean(dv_voted, na.rm=T)\n  ) %>% \n  mutate(\n    st = fct_reorder(st, turnout)\n    ) -> df_state\n\ndf_state %>% \n  ggplot(aes(turnout,st))+\n  geom_bar(stat = \"identity\")\n```\n\n::: {.cell-output-display}\n![](08-lab-comments_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n\n\n## Variation over time\n\nCreate a figure that shows how turnout varies across time.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncps %>% \n  group_by(year, election_type ) %>%\n  summarise(\n    turnout = mean(dv_voted, na.rm=T)\n  ) -> year_df\n\nyear_df %>% \n  ggplot(aes(year, turnout)) +\n  geom_line() +\n  facet_grid(~election_type)\n```\n\n::: {.cell-output-display}\n![](08-lab-comments_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n:::\n\n\n\n## Variation across policy\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncps %>% \n  group_by(year, st, election_type ) %>%\n  summarise(\n    turnout = mean(dv_voted, na.rm=T)\n  ) -> year_state_df\n\nyear_state_df %>% \n  ungroup() %>% \n  ggplot(aes(year, turnout, group=st)) +\n  geom_line()+\n  stat_smooth(geom = \"line\", col = \"red\",aes(group = NULL))+\n  facet_grid(~election_type)\n```\n\n::: {.cell-output-display}\n![](08-lab-comments_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n:::\n\n\n\n\n# Understanding Two-Way Fixed Effects Regression\n\nIn this question you will estimate **four** increasingly complex models using `lm_robust()` and explain how each subsequent model differs from the preceding model.\n\n1. A simple linear model, `m1` akin to what `lm()` produces modelling turnout (`dv_voted`) as a function of same day registration (`sdr`)\n\n2. A simple linear model, `m2`  with standard errors that are robust to heteroskedasticity (i.e. non-constant error variance) by setting `lm_robust()` argument to `se_type = \"stata\"` \n\n3. A two-way fixed effects model, `m3`, with fixed effects for `st`ate and `year` using `lm_robust()` argument: `fixed_effects = ~ st + year`\n\n4. A two-way fixed effects model, `m3`, with fixed effects for `st`ate and `year` using `lm_robust()` argument: `fixed_effects = ~ st + year` **AND** robust standard errors  **clustered by state** using the argument: `clusters = st`\n\n\n\n## Estimate the models\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# ---- m1: Simple OLS regression ----\nm1 <- lm_robust(dv_voted ~ sdr, \n                data = cps,\n                se_type = \"classical\",\n                try_cholesky = T)\n\n# ---- m2: Simple OLS with robust standard errors ----\nm2 <- lm_robust(dv_voted ~ sdr, \n                data = cps,\n                se_type = \"stata\",\n                try_cholesky = T)\n\n# ---- m3: Two-way Fixed Effects for State and Year ----\nm3 <- lm_robust(dv_voted ~ sdr,\n                data = cps,\n                fixed_effects = ~ st + year,\n                se_type = \"stata\",\n                try_cholesky = T)\n\n# ---- m4: TWFE for State and Year and cluster robst SEs ----\n\nm4 <- lm_robust(dv_voted ~ sdr,\n                data = cps,\n                fixed_effects = ~ st + year,\n                se_type = \"stata\",\n                clusters = st,\n                try_cholesky = T)\n```\n:::\n\n\n## Present and interpret the results\n\nWhen you've completed the previous section, you should be able uncomment and run the following code\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# htmlreg(l = list(m1,m2,m3, m4),\n#         digits = 5,\n#         include.ci = F,\n#         ) %>% HTML() %>% browsable()\n```\n:::\n\n\n**Please write a few sentences** explaining how the coefficient on `sdr` and it's standard error changes across the four models. I'll get you started:\n\nThe table presents the results of four regression models. The outcome in each model is a binary indicator of whether respondents to the CPS voted in a given election. The key predictor of interest in each model is the coefficient for `sdr` which corresponds the model's predicted difference in turnout in states that had same day registration compared to states that did not. Model 1 presents the results form a simple linear regression assuming homoskedastic errors (i.e. constant error variance). The coefficient on `sdr` of 0.062 implies that this model predicts turnout will be higher by 6.2 percentage points in states with Same Day Registration. The standard error of 0.00110 is small relative to the coefficient, which as we will see in two weeks implies a *statistically significant* relationship. \n\nModel 2 presents the same specification, but uses robust standard errors that allow for non-constant (heteroskedastic) error variance. The coefficient on `sdr` is exactly the same as Model 1, and the standard error is similar to the ten-thousandth decimal place. In short, simplying including robust standard errors does little to change our substantive interpretation.\n\nModel 3 includes fixed effects of state and year. Specifically, `lm_robust()` uses the [within-in](https://en.wikipedia.org/wiki/Fixed_effects_model#Fixed_effects_estimator) transformation, subtracting off the state and year level means of the predictors and outcomes before estimating the regression. This transformation is equivalent to including indicator variables to represent the various levels of each fixed effect (e.g. including year and st as factor variables in the model). That latter, sometimes called the dummy variable approach, is more computationally intensive, but as the code below demonstrates, they all yield the same estimates and standard errors (although their are some additional adjustments that `lm_robust()` performs, which we are not when we calculate the within transformations by hand) \n\n\n::: {.cell}\n\n```{.r .cell-code}\noptions(digits = 5)\noptions(scipen = 5)\n\n# Kludge-y method of alternating projections....\ncps %>% \n  ungroup() %>% \n  # Only use observations from m3\n  filter(!is.na(dv_voted), !is.na(sdr)) %>% \n  dplyr::group_by(st) %>% \n  # Within transformation by states\n  mutate(\n    dv_voted_within = dv_voted - mean(dv_voted, na.rm=T),\n    sdr_within = sdr - mean(sdr, na.rm=T)\n  ) %>% \n  ungroup() %>% \n  # Within transformation by year\n  dplyr::group_by(year) %>%\n  mutate(\n    dv_voted_within = dv_voted_within - mean(dv_voted_within, na.rm=T),\n    sdr_within = sdr_within - mean(sdr_within,na.rm=T)\n  ) %>% ungroup() %>% \n  # Within transformation by year\n  dplyr::group_by(st) %>%\n  mutate(\n    dv_voted_within = dv_voted_within - mean(dv_voted_within, na.rm=T),\n    sdr_within = sdr_within - mean(sdr_within,na.rm=T)\n  ) %>% \n    dplyr::group_by(year) %>%\n  mutate(\n    dv_voted_within = dv_voted_within - mean(dv_voted_within, na.rm=T),\n    sdr_within = sdr_within - mean(sdr_within,na.rm=T)\n  ) %>% ungroup() %>% \n  dplyr::group_by(st) %>%\n  mutate(\n    dv_voted_within = dv_voted_within - mean(dv_voted_within, na.rm=T),\n    sdr_within = sdr_within - mean(sdr_within,na.rm=T)\n  ) %>% \n    dplyr::group_by(year) %>%\n  mutate(\n    dv_voted_within = dv_voted_within - mean(dv_voted_within, na.rm=T),\n    sdr_within = sdr_within - mean(sdr_within,na.rm=T)\n  ) %>% ungroup()-> cps\n\nstart_time_m3_within  <- Sys.time()\nm3_within <- lm_robust(dv_voted_within ~ sdr_within, \n                       cps,\n                       se_type = \"stata\",\n                       try_cholesky = T)\n\nend_time_m3_within  <- Sys.time()\ntime_m3_within <- round(end_time_m3_within - start_time_m3_within,5)\n\n\nstart_time_m3_indicator  <- Sys.time()\nm3_indicator <- lm_robust(dv_voted ~ sdr + factor(year) + factor(st),\n                          cps,\n                          se_type = \"stata\")\nend_time_m3_indicator  <- Sys.time()\ntime_m3_indicator <- round(end_time_m3_indicator - start_time_m3_indicator,5)\n\ntime_m3_indicator\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nTime difference of 6.7778 secs\n```\n\n\n:::\n\n```{.r .cell-code}\ntime_m3_within\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nTime difference of 1.721 secs\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n2+2\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 4\n```\n\n\n:::\n\n```{.r .cell-code}\nhtmlreg(list(m3, m3_within, m3_indicator),\n        omit.coef = \"factor|Intercept\",\n        digits = 5,\n        include.ci = F\n        ) %>% HTML() %>% browsable()\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<table class=\"texreg\" style=\"margin: 10px auto;border-collapse: collapse;border-spacing: 0px;caption-side: bottom;color: #000000;border-top: 2px solid #000000;\">\n<caption>Statistical models</caption>\n<thead>\n<tr>\n<th style=\"padding-left: 5px;padding-right: 5px;\">&nbsp;</th>\n<th style=\"padding-left: 5px;padding-right: 5px;\">Model 1</th>\n<th style=\"padding-left: 5px;padding-right: 5px;\">Model 2</th>\n<th style=\"padding-left: 5px;padding-right: 5px;\">Model 3</th>\n</tr>\n</thead>\n<tbody>\n<tr style=\"border-top: 1px solid #000000;\">\n<td style=\"padding-left: 5px;padding-right: 5px;\">sdr</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">0.00671<sup>&#42;&#42;&#42;</sup></td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">&nbsp;</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">0.00671<sup>&#42;&#42;&#42;</sup></td>\n</tr>\n<tr>\n<td style=\"padding-left: 5px;padding-right: 5px;\">&nbsp;</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">(0.00185)</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">&nbsp;</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">(0.00185)</td>\n</tr>\n<tr>\n<td style=\"padding-left: 5px;padding-right: 5px;\">sdr_within</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">&nbsp;</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">0.00671<sup>&#42;&#42;&#42;</sup></td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">&nbsp;</td>\n</tr>\n<tr>\n<td style=\"padding-left: 5px;padding-right: 5px;\">&nbsp;</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">&nbsp;</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">(0.00185)</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">&nbsp;</td>\n</tr>\n<tr style=\"border-top: 1px solid #000000;\">\n<td style=\"padding-left: 5px;padding-right: 5px;\">R<sup>2</sup></td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">0.02845</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">0.00001</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">0.02845</td>\n</tr>\n<tr>\n<td style=\"padding-left: 5px;padding-right: 5px;\">Adj. R<sup>2</sup></td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">0.02841</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">0.00001</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">0.02841</td>\n</tr>\n<tr>\n<td style=\"padding-left: 5px;padding-right: 5px;\">Num. obs.</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">1988501</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">1988501</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">1988501</td>\n</tr>\n<tr style=\"border-bottom: 2px solid #000000;\">\n<td style=\"padding-left: 5px;padding-right: 5px;\">RMSE</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">0.48986</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">0.48985</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">0.48986</td>\n</tr>\n</tbody>\n<tfoot>\n<tr>\n<td style=\"font-size: 0.8em;\" colspan=\"4\"><sup>&#42;&#42;&#42;</sup>p &lt; 0.001; <sup>&#42;&#42;</sup>p &lt; 0.01; <sup>&#42;</sup>p &lt; 0.05</td>\n</tr>\n</tfoot>\n</table>\n\n```\n\n:::\n:::\n\n\nFinally, model 4 presents the results of a TWFE regression with fixed effects for state and year with robust standard errors clustered by state. The coefficient on `sdr` remains the same as in Model 3, predicting about 0.6 percentage points higher turnout in states with same day registration. We see that once we relax the assumption that our errors are independent, and allow for correlations between observations from the same state, our uncertainty about this coefficient (quantified by it's standard error) increases 10-fold, and we are non longer confident that there is a statistically significant relationship between same day registration and voting in these data. In sum, once we account for fixed differeces accross states and between time periods, and allow correlated errors between observations from the same state, variation in the presence of same day registration laws seems to explain relatively little variation in voting\n\n\n:::{.callout-note}\nSo which model should we prefer? I would say the default approach of most social scientists is to prefer the **most conservative** estimate, which in this case corresponds to the results from model 4. We'd rather underclaim than overclaim. Since rarely if ever, do we **know** the right model, it's generally common practice to report the results of multiple models with different spefications (as Grumbach and Hill do) as a way of demonstrating the robustness of ones' results.\n:::\n\n\n# Replicate two models from Figure 3\n\nInteresting.Once we account for fixed differences across states and between time periods and allow correlated errors between observations from the same state, variation in the presence of same day registration laws seems to explain relatively little variation in voting. \n\nGrumbach and Hill, however, are interested in a different question, namely, **whether the effects of same day registration vary by age.** \n\nGrumbach and Hill test these claims using a regression model that interacts the `sdr` variable with indicators for the `age_group` of respondents. \n\nThe combination of the coefficient on `sdr` and the coefficient on the interaction of `sdr` with a specific age group indicator, tells us the predicted effect of `sdr` for respondents of that age group. In other words, it lets us assess whether same day registration is associated with more turnout among younger voters compared to older voters.\n\nFormally, we we can desribe these models using the following notation\n\n$$\ny_{ist} = \\beta_0 + \\overbrace{\\alpha_s}^{\\text{FE State}} + \\underbrace{\\gamma_t}_{\\text{FE Year}} + \\overbrace{\\beta_1sdr_{st}}^{\\text{ME of SDR for 65+}} + \\underbrace{\\sum_{k = 18-14}^{k = 55-64}\\beta_{k} sdr_{st}\\times age_{ist}}_{\\Delta \\text{ in ME of SDR for Age }}  +\\overbrace{X\\beta}^{\\text{Controls}}+\\epsilon_{ist}\n$$\n\nPlease fit **two models** that **interact** the variable `sdr` with the variable `age_group`. Include fixed effects for `st`ate and `year`, and cluster your standard errors by `st`ate. \n\nCall one model `m1gh` and only include the interaction between same day voting and age cohorts (`sdr*age_group`).\n\nCall the second model `m2gh`. In addition to the interaction, include controls for:\n\n- `race` (as a factor)\n- `is_female`\n- `income`\n- `education`\n\n## Estimate the models\n\n\n::: {.cell}\n\n```{.r .cell-code}\nm1gh <- lm_robust(dv_voted ~ sdr*age_group, \n                  data = cps,\n                  fixed_effects = ~ st + year,\n                  se_type = \"stata\",\n                  clusters = st,\n                  try_cholesky = T\n                  )\n\n\nm2gh <- lm_robust(dv_voted ~ sdr*age_group +\n                    factor(race) + is_female + income + education, \n                  data = cps,\n                  fixed_effects = ~ st + year,\n                  se_type = \"stata\",\n                  clusters = st,\n                  try_cholesky = T\n                  )\n```\n:::\n\n\n## Present the results\n\nPlease present the results in a regression table:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nhtmlreg(list(m1gh, m2gh), \n        digits = 4,\n        include.ci = F) %>% HTML() %>% browsable()\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<table class=\"texreg\" style=\"margin: 10px auto;border-collapse: collapse;border-spacing: 0px;caption-side: bottom;color: #000000;border-top: 2px solid #000000;\">\n<caption>Statistical models</caption>\n<thead>\n<tr>\n<th style=\"padding-left: 5px;padding-right: 5px;\">&nbsp;</th>\n<th style=\"padding-left: 5px;padding-right: 5px;\">Model 1</th>\n<th style=\"padding-left: 5px;padding-right: 5px;\">Model 2</th>\n</tr>\n</thead>\n<tbody>\n<tr style=\"border-top: 1px solid #000000;\">\n<td style=\"padding-left: 5px;padding-right: 5px;\">sdr</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">0.0120</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">0.0004</td>\n</tr>\n<tr>\n<td style=\"padding-left: 5px;padding-right: 5px;\">&nbsp;</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">(0.0162)</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">(0.0128)</td>\n</tr>\n<tr>\n<td style=\"padding-left: 5px;padding-right: 5px;\">age_group18-24</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">-0.3518<sup>&#42;&#42;&#42;</sup></td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">-0.4125<sup>&#42;&#42;&#42;</sup></td>\n</tr>\n<tr>\n<td style=\"padding-left: 5px;padding-right: 5px;\">&nbsp;</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">(0.0061)</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">(0.0051)</td>\n</tr>\n<tr>\n<td style=\"padding-left: 5px;padding-right: 5px;\">age_group25-34</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">-0.2149<sup>&#42;&#42;&#42;</sup></td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">-0.3198<sup>&#42;&#42;&#42;</sup></td>\n</tr>\n<tr>\n<td style=\"padding-left: 5px;padding-right: 5px;\">&nbsp;</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">(0.0060)</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">(0.0040)</td>\n</tr>\n<tr>\n<td style=\"padding-left: 5px;padding-right: 5px;\">age_group35-44</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">-0.1026<sup>&#42;&#42;&#42;</sup></td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">-0.2179<sup>&#42;&#42;&#42;</sup></td>\n</tr>\n<tr>\n<td style=\"padding-left: 5px;padding-right: 5px;\">&nbsp;</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">(0.0063)</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">(0.0038)</td>\n</tr>\n<tr>\n<td style=\"padding-left: 5px;padding-right: 5px;\">age_group45-54</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">-0.0431<sup>&#42;&#42;&#42;</sup></td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">-0.1450<sup>&#42;&#42;&#42;</sup></td>\n</tr>\n<tr>\n<td style=\"padding-left: 5px;padding-right: 5px;\">&nbsp;</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">(0.0059)</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">(0.0038)</td>\n</tr>\n<tr>\n<td style=\"padding-left: 5px;padding-right: 5px;\">age_group55-64</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">0.0064</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">-0.0642<sup>&#42;&#42;&#42;</sup></td>\n</tr>\n<tr>\n<td style=\"padding-left: 5px;padding-right: 5px;\">&nbsp;</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">(0.0047)</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">(0.0036)</td>\n</tr>\n<tr>\n<td style=\"padding-left: 5px;padding-right: 5px;\">sdr:age_group18-24</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">0.0142</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">0.0472<sup>&#42;&#42;&#42;</sup></td>\n</tr>\n<tr>\n<td style=\"padding-left: 5px;padding-right: 5px;\">&nbsp;</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">(0.0108)</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">(0.0081)</td>\n</tr>\n<tr>\n<td style=\"padding-left: 5px;padding-right: 5px;\">sdr:age_group25-34</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">0.0003</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">0.0219<sup>&#42;&#42;</sup></td>\n</tr>\n<tr>\n<td style=\"padding-left: 5px;padding-right: 5px;\">&nbsp;</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">(0.0137)</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">(0.0076)</td>\n</tr>\n<tr>\n<td style=\"padding-left: 5px;padding-right: 5px;\">sdr:age_group35-44</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">-0.0142</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">0.0074</td>\n</tr>\n<tr>\n<td style=\"padding-left: 5px;padding-right: 5px;\">&nbsp;</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">(0.0162)</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">(0.0087)</td>\n</tr>\n<tr>\n<td style=\"padding-left: 5px;padding-right: 5px;\">sdr:age_group45-54</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">-0.0147</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">0.0001</td>\n</tr>\n<tr>\n<td style=\"padding-left: 5px;padding-right: 5px;\">&nbsp;</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">(0.0120)</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">(0.0068)</td>\n</tr>\n<tr>\n<td style=\"padding-left: 5px;padding-right: 5px;\">sdr:age_group55-64</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">-0.0149</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">-0.0108</td>\n</tr>\n<tr>\n<td style=\"padding-left: 5px;padding-right: 5px;\">&nbsp;</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">(0.0096)</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">(0.0062)</td>\n</tr>\n<tr>\n<td style=\"padding-left: 5px;padding-right: 5px;\">factor(race)200</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">&nbsp;</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">0.0518<sup>&#42;&#42;&#42;</sup></td>\n</tr>\n<tr>\n<td style=\"padding-left: 5px;padding-right: 5px;\">&nbsp;</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">&nbsp;</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">(0.0081)</td>\n</tr>\n<tr>\n<td style=\"padding-left: 5px;padding-right: 5px;\">factor(race)300</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">&nbsp;</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">-0.0548<sup>&#42;&#42;&#42;</sup></td>\n</tr>\n<tr>\n<td style=\"padding-left: 5px;padding-right: 5px;\">&nbsp;</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">&nbsp;</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">(0.0118)</td>\n</tr>\n<tr>\n<td style=\"padding-left: 5px;padding-right: 5px;\">factor(race)650</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">&nbsp;</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">-0.1619<sup>&#42;&#42;&#42;</sup></td>\n</tr>\n<tr>\n<td style=\"padding-left: 5px;padding-right: 5px;\">&nbsp;</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">&nbsp;</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">(0.0305)</td>\n</tr>\n<tr>\n<td style=\"padding-left: 5px;padding-right: 5px;\">factor(race)651</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">&nbsp;</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">-0.1784<sup>&#42;&#42;&#42;</sup></td>\n</tr>\n<tr>\n<td style=\"padding-left: 5px;padding-right: 5px;\">&nbsp;</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">&nbsp;</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">(0.0090)</td>\n</tr>\n<tr>\n<td style=\"padding-left: 5px;padding-right: 5px;\">factor(race)652</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">&nbsp;</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">-0.1277<sup>&#42;&#42;&#42;</sup></td>\n</tr>\n<tr>\n<td style=\"padding-left: 5px;padding-right: 5px;\">&nbsp;</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">&nbsp;</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">(0.0188)</td>\n</tr>\n<tr>\n<td style=\"padding-left: 5px;padding-right: 5px;\">factor(race)700</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">&nbsp;</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">-0.0916<sup>&#42;&#42;&#42;</sup></td>\n</tr>\n<tr>\n<td style=\"padding-left: 5px;padding-right: 5px;\">&nbsp;</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">&nbsp;</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">(0.0236)</td>\n</tr>\n<tr>\n<td style=\"padding-left: 5px;padding-right: 5px;\">factor(race)801</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">&nbsp;</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">0.0130</td>\n</tr>\n<tr>\n<td style=\"padding-left: 5px;padding-right: 5px;\">&nbsp;</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">&nbsp;</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">(0.0110)</td>\n</tr>\n<tr>\n<td style=\"padding-left: 5px;padding-right: 5px;\">factor(race)802</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">&nbsp;</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">-0.0233<sup>&#42;</sup></td>\n</tr>\n<tr>\n<td style=\"padding-left: 5px;padding-right: 5px;\">&nbsp;</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">&nbsp;</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">(0.0097)</td>\n</tr>\n<tr>\n<td style=\"padding-left: 5px;padding-right: 5px;\">factor(race)803</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">&nbsp;</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">-0.0406</td>\n</tr>\n<tr>\n<td style=\"padding-left: 5px;padding-right: 5px;\">&nbsp;</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">&nbsp;</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">(0.0277)</td>\n</tr>\n<tr>\n<td style=\"padding-left: 5px;padding-right: 5px;\">factor(race)804</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">&nbsp;</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">-0.0566</td>\n</tr>\n<tr>\n<td style=\"padding-left: 5px;padding-right: 5px;\">&nbsp;</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">&nbsp;</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">(0.0403)</td>\n</tr>\n<tr>\n<td style=\"padding-left: 5px;padding-right: 5px;\">factor(race)805</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">&nbsp;</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">0.0548</td>\n</tr>\n<tr>\n<td style=\"padding-left: 5px;padding-right: 5px;\">&nbsp;</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">&nbsp;</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">(0.0291)</td>\n</tr>\n<tr>\n<td style=\"padding-left: 5px;padding-right: 5px;\">factor(race)806</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">&nbsp;</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">-0.0432</td>\n</tr>\n<tr>\n<td style=\"padding-left: 5px;padding-right: 5px;\">&nbsp;</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">&nbsp;</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">(0.0520)</td>\n</tr>\n<tr>\n<td style=\"padding-left: 5px;padding-right: 5px;\">factor(race)807</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">&nbsp;</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">-0.0486</td>\n</tr>\n<tr>\n<td style=\"padding-left: 5px;padding-right: 5px;\">&nbsp;</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">&nbsp;</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">(0.0574)</td>\n</tr>\n<tr>\n<td style=\"padding-left: 5px;padding-right: 5px;\">factor(race)808</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">&nbsp;</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">-0.0593</td>\n</tr>\n<tr>\n<td style=\"padding-left: 5px;padding-right: 5px;\">&nbsp;</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">&nbsp;</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">(0.0473)</td>\n</tr>\n<tr>\n<td style=\"padding-left: 5px;padding-right: 5px;\">factor(race)809</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">&nbsp;</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">-0.1125<sup>&#42;&#42;&#42;</sup></td>\n</tr>\n<tr>\n<td style=\"padding-left: 5px;padding-right: 5px;\">&nbsp;</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">&nbsp;</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">(0.0271)</td>\n</tr>\n<tr>\n<td style=\"padding-left: 5px;padding-right: 5px;\">factor(race)810</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">&nbsp;</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">0.0169</td>\n</tr>\n<tr>\n<td style=\"padding-left: 5px;padding-right: 5px;\">&nbsp;</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">&nbsp;</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">(0.0340)</td>\n</tr>\n<tr>\n<td style=\"padding-left: 5px;padding-right: 5px;\">factor(race)811</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">&nbsp;</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">-0.0932</td>\n</tr>\n<tr>\n<td style=\"padding-left: 5px;padding-right: 5px;\">&nbsp;</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">&nbsp;</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">(0.1396)</td>\n</tr>\n<tr>\n<td style=\"padding-left: 5px;padding-right: 5px;\">factor(race)812</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">&nbsp;</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">-0.0474</td>\n</tr>\n<tr>\n<td style=\"padding-left: 5px;padding-right: 5px;\">&nbsp;</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">&nbsp;</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">(0.0891)</td>\n</tr>\n<tr>\n<td style=\"padding-left: 5px;padding-right: 5px;\">factor(race)813</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">&nbsp;</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">-0.0445<sup>&#42;&#42;&#42;</sup></td>\n</tr>\n<tr>\n<td style=\"padding-left: 5px;padding-right: 5px;\">&nbsp;</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">&nbsp;</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">(0.0076)</td>\n</tr>\n<tr>\n<td style=\"padding-left: 5px;padding-right: 5px;\">factor(race)814</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">&nbsp;</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">-0.0316</td>\n</tr>\n<tr>\n<td style=\"padding-left: 5px;padding-right: 5px;\">&nbsp;</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">&nbsp;</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">(0.1223)</td>\n</tr>\n<tr>\n<td style=\"padding-left: 5px;padding-right: 5px;\">factor(race)815</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">&nbsp;</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">-0.1124</td>\n</tr>\n<tr>\n<td style=\"padding-left: 5px;padding-right: 5px;\">&nbsp;</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">&nbsp;</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">(0.0601)</td>\n</tr>\n<tr>\n<td style=\"padding-left: 5px;padding-right: 5px;\">factor(race)816</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">&nbsp;</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">0.2548</td>\n</tr>\n<tr>\n<td style=\"padding-left: 5px;padding-right: 5px;\">&nbsp;</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">&nbsp;</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">(0.1910)</td>\n</tr>\n<tr>\n<td style=\"padding-left: 5px;padding-right: 5px;\">factor(race)817</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">&nbsp;</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">0.1245</td>\n</tr>\n<tr>\n<td style=\"padding-left: 5px;padding-right: 5px;\">&nbsp;</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">&nbsp;</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">(0.1979)</td>\n</tr>\n<tr>\n<td style=\"padding-left: 5px;padding-right: 5px;\">factor(race)818</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">&nbsp;</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">0.8195<sup>&#42;&#42;&#42;</sup></td>\n</tr>\n<tr>\n<td style=\"padding-left: 5px;padding-right: 5px;\">&nbsp;</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">&nbsp;</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">(0.0074)</td>\n</tr>\n<tr>\n<td style=\"padding-left: 5px;padding-right: 5px;\">factor(race)819</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">&nbsp;</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">-0.0831</td>\n</tr>\n<tr>\n<td style=\"padding-left: 5px;padding-right: 5px;\">&nbsp;</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">&nbsp;</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">(0.1869)</td>\n</tr>\n<tr>\n<td style=\"padding-left: 5px;padding-right: 5px;\">factor(race)820</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">&nbsp;</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">0.0325</td>\n</tr>\n<tr>\n<td style=\"padding-left: 5px;padding-right: 5px;\">&nbsp;</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">&nbsp;</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">(0.0592)</td>\n</tr>\n<tr>\n<td style=\"padding-left: 5px;padding-right: 5px;\">factor(race)830</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">&nbsp;</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">-0.1871<sup>&#42;&#42;</sup></td>\n</tr>\n<tr>\n<td style=\"padding-left: 5px;padding-right: 5px;\">&nbsp;</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">&nbsp;</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">(0.0667)</td>\n</tr>\n<tr>\n<td style=\"padding-left: 5px;padding-right: 5px;\">is_female</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">&nbsp;</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">0.0240<sup>&#42;&#42;&#42;</sup></td>\n</tr>\n<tr>\n<td style=\"padding-left: 5px;padding-right: 5px;\">&nbsp;</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">&nbsp;</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">(0.0017)</td>\n</tr>\n<tr>\n<td style=\"padding-left: 5px;padding-right: 5px;\">income</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">&nbsp;</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">0.0093<sup>&#42;&#42;&#42;</sup></td>\n</tr>\n<tr>\n<td style=\"padding-left: 5px;padding-right: 5px;\">&nbsp;</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">&nbsp;</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">(0.0002)</td>\n</tr>\n<tr>\n<td style=\"padding-left: 5px;padding-right: 5px;\">education</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">&nbsp;</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">0.0895<sup>&#42;&#42;&#42;</sup></td>\n</tr>\n<tr>\n<td style=\"padding-left: 5px;padding-right: 5px;\">&nbsp;</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">&nbsp;</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">(0.0016)</td>\n</tr>\n<tr style=\"border-top: 1px solid #000000;\">\n<td style=\"padding-left: 5px;padding-right: 5px;\">R<sup>2</sup></td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">0.0864</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">0.1707</td>\n</tr>\n<tr>\n<td style=\"padding-left: 5px;padding-right: 5px;\">Adj. R<sup>2</sup></td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">0.0864</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">0.1706</td>\n</tr>\n<tr>\n<td style=\"padding-left: 5px;padding-right: 5px;\">Num. obs.</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">1980510</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">1616508</td>\n</tr>\n<tr>\n<td style=\"padding-left: 5px;padding-right: 5px;\">RMSE</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">0.4748</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">0.4515</td>\n</tr>\n<tr style=\"border-bottom: 2px solid #000000;\">\n<td style=\"padding-left: 5px;padding-right: 5px;\">N Clusters</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">49</td>\n<td style=\"padding-left: 5px;padding-right: 5px;\">49</td>\n</tr>\n</tbody>\n<tfoot>\n<tr>\n<td style=\"font-size: 0.8em;\" colspan=\"3\"><sup>&#42;&#42;&#42;</sup>p &lt; 0.001; <sup>&#42;&#42;</sup>p &lt; 0.01; <sup>&#42;</sup>p &lt; 0.05</td>\n</tr>\n</tfoot>\n</table>\n\n```\n\n:::\n:::\n\n\n\n# Recreate Figure 3\n\nWuff. That's a lot of coefficients to sort through. \n\nMoreover, the question Grumbach and Hill are interested -- how the marginal effect of same day registration varies by age -- isn't directly answered by any one coefficient in the the table.\n\nThat's because in these interaction models, the marginal effect of SDR (and it's standard error) varies conditionally on the value of age group we're looking at. \n\nThe comments to this lab contain a more formal discussion of the math behind this results. \n\nFor you're purposes just know that quantites of interest from the models you estimated above can be described as follows:\n\n- $\\beta_1 \\text{sdr}$ describes the **marginal effect** of Same Day registration for the reference category of `age_group`, here individuals who are 65+ years of age. The standard error for this estimate is simply the standard error for the coefficient.\n\n- The **sum** of $\\beta_1 + \\beta_{\\text{k=18-24}}$, where  $\\beta_{\\text{k=18-24}}$ corresponds to the coefficient for the **interaction** term `sdr:age_group18-24` describes the **marginal effect** of Same Day registration for 18 to 24 year olds.\n\n- Similarly $\\beta_1 + \\beta_{\\text{k=25-34}}$ describes the marginal effect of Same Day registration for 25 to 34 year olds.\n\n------------------------\n\nMore formally, we can think of the marginal effect of any variable in a multiple regression as the partial derivative of the outcome with respect to that variable. Depending on how much calculus we took, this is either relatively obvious, or completely confusioning. \n\nSo below, when taking the partial derivative of $y$ with respect to $x$ $(\\frac{\\partial y}{\\partial x})$, anything not involving an $x$ is treated as a constant and the partial derivative of a constant is 0. By the [power rule](https://en.wikipedia.org/wiki/Power_rule), the derivative of $\\beta_1 x$ is 1, and so the marginal effect of x on y  is $\\beta_1$\n\n$$\n\\begin{aligned}\ny &= \\beta_0 + \\beta_1 x +\\beta_2z \\\\\n\\frac{\\partial y}{\\partial x} &= 0 + \\beta_1*(1) + 0\\\\\n\\frac{\\partial y}{\\partial x} &= \\beta_1\n\\end{aligned} \n$$\n\nNow consider a multiple regression with an interaction between two variables $x$ and $z$\n\n$$\ny = \\beta_0 +\\beta_1x +\\beta_2 z + \\beta_3 x*z\n$$\n\nTaking the partial derivative of y with respect to x $(\\frac{\\partial y}{\\partial x})$, there are now two terms with $x$ in them:\n\n$$\n\\begin{aligned}\ny &= \\beta_0 +\\beta_1x +\\beta_2 z + \\beta_3 x*z \\\\\n\\frac{\\partial y}{\\partial x} &= 0 + \\beta_1*(1) +0 + \\beta_3*(1)*z\\\\\n\\frac{\\partial y}{\\partial x} &= \\beta_1 +\\beta_3z\n\\end{aligned} \n$$\nAnd the marginal effect of $x$ now depends on value of $z$ at which we evaluate the model. Moreover, it can be shown for example in [Brambor Clark, and Golder 2006](https://www.jstor.org/stable/25791835), that the standard error of this marginal effect is a function of the variance and covariance of $\\beta_1$ and $\\beta_3$ and the value of the conditioning term $z$\n\n$$\n\\text{Var}(\\frac{\\partial y}{\\partial x}) = \\text{Var}(\\beta_1) + z^2\\text{Var}(\\beta_3) + 2\\times z \\text{Cov}(\\beta_1,\\beta_3)\n$$\n\n\n## Marginal Effects of Interactions\n\nIn the code below, I've written a **custom function** called `me_fn()` to calculate the **marginal effects** of Same Day Registration, a specific age cohort^[This is not a robust function, but one designed to work speicfically for these data and models]\n\nThe function returns $1\\times 5$ table with following columns\n\n- `Age` the Age for which we are evaluating the marginal effect of `sdr`\n- `Effect` the marginal effect of `sdr` condtional on `age_group` equalling the age cohort in `Age`\n- `SE` the standard error of this marginal effect\n- `ll` the **lower limit** of a 95 percent **confidence interval** for our estimate\n- `ul` the **upper limit** of a 95 percent **confidence interval** for our estimate\n\nWe will talk in more detail about what a **confidence interval** is in two weeks. For now, you can think of this interval as a **range of equally plausible values** for the marginal effect of SDR at a given age cohort. \n\n:::{callout-note}\nThe heuristic for interpreting a confidence interval as a measure of statistical significance, is to ask:\n\n> Is **zero within** the upper and lower **limits of the confidence interval**. If so, then the true estimate could be negative, or it could be positive, in which case, we conclude the estimate is **not statistically significant**.\n:::\n\nPlease run the code below:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nme_fn <- function(mod, cohort, ci=0.95){\n  # Confidence Level for CI\n  alpha <- 1-ci\n  z <- qnorm(1-alpha/2)\n  \n  # Age (Always one for indicator of specific cohort)\n  age <- 1\n  \n  # Variance Covariance Matrix from Model\n  cov <- vcov(mod)\n  \n  # coefficient for SDR (Marginal Effect for reference category: 65+)\n  b1 <- coef(mod)[\"sdr\"]\n  \n  # If age is one of the interactions\n  if(cohort %in% c(\"18-24\",\"25-34\",\"35-44\",\"45-54\",\"55-64\")){\n    # get the name of the specific interaction\n    the_int <- paste(\"sdr:age_group\",cohort,sep=\"\")\n    # the coefficient on the interaction\n    b2 <- coef(mod)[the_int]\n    # Calculate marginal effect for age cohort\n    me <- b1 + b2*age\n    me_se <- sqrt(cov[\"sdr\",\"sdr\"] + age^2*cov[the_int,the_int] + 2*age*cov[\"sdr\",the_int])\n    ll <- me - z*me_se\n    ul <- me + z*me_se\n  }\n  if(!cohort %in% c(\"18-24\",\"25-34\",\"35-44\",\"45-54\",\"55-64\")){\n    me <- b1 \n    me_se <- mod$std.error[\"sdr\"]\n    ll <- mod$conf.low[\"sdr\"]\n    ul <- mod$conf.high[\"sdr\"]\n  }\n\n  res <- tibble(\n    Age = cohort,\n    Effect = me,\n    SE = me_se,\n    ll = ll,\n    ul = ul\n  )\n  return(res)\n\n\n}\n```\n:::\n\n\nThen uncomment the code below to create the data frame to produce a version of the coefficient plots from Grumbach and Hill's Figure 3.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# List of age cohorts\nthe_age_groups <- levels(cps$age_group)\n\n## Model 1: No controls\n## Esimate Marginal effect for each age cohort\nthe_age_groups %>% \n  purrr::map_df(~me_fn(m1gh, cohort=.)) %>% \n  # Add Format labels for plotting\n  mutate(\n    Age = factor(Age),\n    Model = \"No controls\"\n  ) -> fig3_no_controls\n\n## Model 1: Controls for Education, Income, Race, \n## Esimate Marginal effect for each age cohort\nthe_age_groups %>% \n  purrr::map_df(~me_fn(m2gh, cohort=.)) %>% \n  mutate(\n    Age = factor(Age),\n    Model = \"With controls\"\n  ) -> fig3_controls\n  \nfig3_df <- fig3_no_controls %>% bind_rows(fig3_controls)\n```\n:::\n\n\n------------------------\n\nIf you're trying to understand the code above, it's a equivalent to writing something like:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nrbind(\nme_fn(m1gh, cohort=\"18-24\"),\nme_fn(m1gh, cohort=\"25-34\"),\nme_fn(m1gh, cohort=\"35-44\"),\nme_fn(m1gh, cohort=\"45-54\"),\nme_fn(m1gh, cohort=\"55-64\"),\nme_fn(m1gh, cohort=\"65+\")\n) %>% \n  mutate(\n    Age = factor(Age),\n    Model = \"No controls\"\n  )\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 6 × 6\n  Age     Effect     SE       ll     ul Model      \n  <fct>    <dbl>  <dbl>    <dbl>  <dbl> <chr>      \n1 18-24  0.0263  0.0160 -0.00500 0.0575 No controls\n2 25-34  0.0123  0.0156 -0.0183  0.0429 No controls\n3 35-44 -0.00218 0.0159 -0.0333  0.0289 No controls\n4 45-54 -0.00262 0.0136 -0.0293  0.0240 No controls\n5 55-64 -0.00287 0.0128 -0.0280  0.0222 No controls\n6 65+    0.0120  0.0162 -0.0206  0.0447 No controls\n```\n\n\n:::\n:::\n\n\n\n# Recreate Figure 3\n \nNow we can recreate the first and second panels in the first column of Grumbach and Hill's Figure 3.\n \nIn the code chunk below, pipe `fig3_df` into ggplot() and:\n\n- Set the `x` aesthetic to `Age`\n- Set the `y` aesthetic to `Effect`\n- Add `geom_point()`\n- Add `geom_linerange(aes(ymin = ll, ymax =ul))`\n- Add `geom_hline(yintercept = 0)`\n- Add a `facet_wrap(~Model)`\n- Set the `theme` if you like\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfig3_df %>% \n  ggplot(aes(Age, Effect))+\n  geom_point()+\n  geom_linerange(aes(ymin = ll, ymax =ul))+\n  geom_hline(yintercept = 0)+\n  facet_wrap(~Model)+\n  theme_minimal()\n```\n\n::: {.cell-output-display}\n![](08-lab-comments_files/figure-html/unnamed-chunk-17-1.png){width=672}\n:::\n:::\n\n\n## Compare your figure to Figure 3 from the text\n\nFinally, **write a few sentences** comparing your results to those presented in Figure 3 of Grumbach and Hill:\n\n\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<script src=\"../site_libs/htmlwidgets-1.6.4/htmlwidgets.js\"></script>\n<link href=\"../site_libs/datatables-css-0.0.0/datatables-crosstalk.css\" rel=\"stylesheet\" />\n<script src=\"../site_libs/datatables-binding-0.31/datatables.js\"></script>\n<script src=\"../site_libs/jquery-3.6.0/jquery-3.6.0.min.js\"></script>\n<link href=\"../site_libs/dt-core-1.13.6/css/jquery.dataTables.min.css\" rel=\"stylesheet\" />\n<link href=\"../site_libs/dt-core-1.13.6/css/jquery.dataTables.extra.css\" rel=\"stylesheet\" />\n<script src=\"../site_libs/dt-core-1.13.6/js/jquery.dataTables.min.js\"></script>\n<link href=\"../site_libs/crosstalk-1.2.1/css/crosstalk.min.css\" rel=\"stylesheet\" />\n<script src=\"../site_libs/crosstalk-1.2.1/js/crosstalk.min.js\"></script>\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}