<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.545">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Your Group Members Names Here">
<meta name="dcterms.date" content="2024-01-24">

<title>POLS 1600 - Lab 07 - Exploring Russians’ Attitudes About the War in Ukraine</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="../site_libs/kePrint-0.0.1/kePrint.js"></script>
<link href="../site_libs/lightable-0.0.1/lightable.css" rel="stylesheet">

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../styles.css">
</head>

<body class="docked nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">POLS 1600</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../syllabus.html"> 
<span class="menu-text">Syllabus</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../class/index.html"> 
<span class="menu-text">Class</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../assignments/index.html"> 
<span class="menu-text">Assignments</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul class="collapse">
  <li><a href="#overview" id="toc-overview" class="nav-link active" data-scroll-target="#overview">Overview</a></li>
  <li><a href="#goals" id="toc-goals" class="nav-link" data-scroll-target="#goals">Goals</a></li>
  <li><a href="#workflow" id="toc-workflow" class="nav-link" data-scroll-target="#workflow">Workflow</a></li>
  <li><a href="#please-knit-this-.rmd-file" id="toc-please-knit-this-.rmd-file" class="nav-link" data-scroll-target="#please-knit-this-.rmd-file">Please knit this .Rmd file</a></li>
  <li><a href="#get-setup-to-work" id="toc-get-setup-to-work" class="nav-link" data-scroll-target="#get-setup-to-work"><span class="header-section-number">1</span> Get setup to work</a>
  <ul class="collapse">
  <li><a href="#load-packages" id="toc-load-packages" class="nav-link" data-scroll-target="#load-packages"><span class="header-section-number">1.1</span> Load Packages</a></li>
  <li><a href="#load-the-data" id="toc-load-the-data" class="nav-link" data-scroll-target="#load-the-data"><span class="header-section-number">1.2</span> Load the data</a></li>
  <li><a href="#describe-the-data" id="toc-describe-the-data" class="nav-link" data-scroll-target="#describe-the-data"><span class="header-section-number">1.3</span> Describe the data</a></li>
  </ul></li>
  <li><a href="#interpretting-long-chunks-of-code" id="toc-interpretting-long-chunks-of-code" class="nav-link" data-scroll-target="#interpretting-long-chunks-of-code"><span class="header-section-number">2</span> Interpretting long chunks of code</a></li>
  <li><a href="#explore-the-demographic-predictors-of-russians-support-for-the-war-in-ukraine" id="toc-explore-the-demographic-predictors-of-russians-support-for-the-war-in-ukraine" class="nav-link" data-scroll-target="#explore-the-demographic-predictors-of-russians-support-for-the-war-in-ukraine"><span class="header-section-number">3</span> Explore the demographic predictors of Russians’ Support for the War in Ukraine</a>
  <ul class="collapse">
  <li><a href="#describe-your-expectations-for-these-models" id="toc-describe-your-expectations-for-these-models" class="nav-link" data-scroll-target="#describe-your-expectations-for-these-models"><span class="header-section-number">3.1</span> Describe your expectations for these models</a></li>
  <li><a href="#estimate-the-regression-models" id="toc-estimate-the-regression-models" class="nav-link" data-scroll-target="#estimate-the-regression-models"><span class="header-section-number">3.2</span> Estimate the regression models</a></li>
  </ul></li>
  <li><a href="#display-your-models-in-a-regression-table-and-offer-some-initial-interpretations" id="toc-display-your-models-in-a-regression-table-and-offer-some-initial-interpretations" class="nav-link" data-scroll-target="#display-your-models-in-a-regression-table-and-offer-some-initial-interpretations"><span class="header-section-number">4</span> Display your models in a regression table and offer some initial interpretations</a></li>
  <li><a href="#use-r2-to-compare-models" id="toc-use-r2-to-compare-models" class="nav-link" data-scroll-target="#use-r2-to-compare-models"><span class="header-section-number">5</span> Use <span class="math inline">\(R^2\)</span> to compare models</a></li>
  <li><a href="#produce-and-visualize-predicted-values-for-m1-and-m3" id="toc-produce-and-visualize-predicted-values-for-m1-and-m3" class="nav-link" data-scroll-target="#produce-and-visualize-predicted-values-for-m1-and-m3"><span class="header-section-number">6</span> Produce and visualize predicted values for m1 and m3</a></li>
  <li><a href="#produce-and-visualize-predicted-values-for-m2-and-m4" id="toc-produce-and-visualize-predicted-values-for-m2-and-m4" class="nav-link" data-scroll-target="#produce-and-visualize-predicted-values-for-m2-and-m4"><span class="header-section-number">7</span> Produce and visualize predicted values for m2 and m4</a></li>
  <li><a href="#explore-another-relationship-in-the-data-optional" id="toc-explore-another-relationship-in-the-data-optional" class="nav-link" data-scroll-target="#explore-another-relationship-in-the-data-optional"><span class="header-section-number">8</span> Explore another relationship in the data (Optional)</a></li>
  <li><a href="#take-the-class-survey" id="toc-take-the-class-survey" class="nav-link" data-scroll-target="#take-the-class-survey">Take the Class Survey</a></li>
  </ul>
</nav>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Lab 07 - Exploring Russians’ Attitudes About the War in Ukraine</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Your Group Members Names Here </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">January 24, 2024</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="overview" class="level1 unnumbered">
<h1 class="unnumbered">Overview</h1>
<p>Today, we’ll explore Russians’ support the war in Ukraine using a public opinion survey from Russia conducted by Alexei Miniailo’s <a href="https://www.dorussianswantwar.com/en">“Do Russians Want War”</a> project.</p>
<p>The survey was conducted by phone using a random sample of mobile phone numbers to produce a sample of respondents representative of the population in terms of age, sex, and geography. It was in the field from February 28 to March 2.</p>
<p>We will look at how support for the war varies with the demographic predictors <code>age</code>, <code>sex</code> and <code>education</code>. We will see how multiple regression can be used to describe more complex relationships. From our baseline model, we will ask:</p>
<ul>
<li><p>Does the relationship between age and support for the war vary among male and female respondents (Interaction model)</p></li>
<li><p>Does the relationship between age and support vary at different levels of age (Polynomial regression model)</p></li>
<li><p>Does the relationship between age and support vary at different levels of age and does the nature of this variation differ among male and female respondents (Polynomial regression model with an interaction term)</p></li>
</ul>
<p>To accomplish this, we will do the following:</p>
<ol type="1">
<li><p>Get set up to work and describe our data (10 minutes)</p></li>
<li><p>Get practice interpreting long chunks of codes with lots of <code>%&gt;%</code>s (10 minutes)</p></li>
<li><p>Estimate four models of increasing complexity (15 minutes)</p></li>
<li><p>Present these models in a regression table and interpret the results (10 minutes)</p></li>
<li><p>Evaluate the relative performance of these models in terms of their variance explained <span class="math inline">\(R^2\)</span>’s (15 minutes)</p></li>
<li><p>Produce predicted values to help us interpret and compare our baseline model to a model where the “effect” of an increase in age changes with age (10 minutes)</p></li>
<li><p>Produce predicted values to help us interpret and compare models where the “effect” of age is allowed to vary with respondent’s sex (10 minutes)</p></li>
</ol>
<p>Finally, if there’s time, we will:</p>
<ol start="8" type="1">
<li>Explore additional questions of our choosing in the data</li>
</ol>
<p>One of questions 1-7 will be randomly selected as the graded question for the lab.</p>
<p>You will work in your assigned groups. Only one member of each group needs to submit the html file produced by knitting the lab.</p>
<p>This lab <strong>must</strong> contain the names of the group members in attendance.</p>
<p>If you are attending remotely, you will submit your labs individually.</p>
<p>You can find your assigned groups in previous <a href="https://pols1600.paultesta.org/labs/06-lab-comments.html" target="_blank">labs</a></p>
</section>
<section id="goals" class="level1 unnumbered">
<h1 class="unnumbered">Goals</h1>
<p>Broadly, our goals in this assignment are to:</p>
<div class="sidenote">
<p><span class="math display">\[y = \beta_0 + \beta_1 x + \beta_2 z + \overbrace{\beta_3 x\cdot z}^{\text{Interaction term}} \]</span></p>
</div>
<ul>
<li><p>Get comfortable estimating and interpreting regression models with <strong>interaction terms</strong></p>
<ul>
<li><p>Including an interaction between two variables is useful if we think the “effect” of one variable depends on the value of another variable.</p></li>
<li><p>Today, we test whether the association between support for the war and age differs between male and female respondents.</p></li>
</ul></li>
</ul>
<div class="sidenote">
<p><span class="math display">\[x^1 = x; \, x^2 = x\cdot x; \,   x^{nth} = \prod_{i=1}^{i=n} x_i = x_1\cdot x_2 \cdot x_3 \dots \cdot x_n \]</span></p>
</div>
<ul>
<li><p>Get comfortable estimating and interpreting regression models with <strong>polynomial terms</strong></p>
<ul>
<li><p>Polynomial terms are a way of incorporating non-linearity in our predictors.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a></p></li>
<li><p>If we think the relationship between a predictor and an outcome varies at different levels of the predictor, we can include a polynomial term(s) for that predictor. Now our model will describe the relationship between <span class="math inline">\(x\)</span> and <span class="math inline">\(y\)</span> with a curve (varying slope), rather than a line (constant slope)</p></li>
</ul></li>
<li><p>Learn how to generate predicted values from our model to help us interpret <strong>complex regression models</strong></p>
<ul>
<li><p>Regression tables are great for summarizing basic regression models.</p></li>
<li><p>Models with interaction terms or polynomial terms (or both) are difficult to interpret by looking at just the coefficients themselves</p></li>
<li><p>Producing predicted values that show how the model’s predictions change as variables in a interaction or polynomial change help us understand what these coefficients are telling us.</p></li>
</ul></li>
<li><p>Practice <strong>comparing <em>nested</em> models</strong> using the proportion of the variance explained by each model.</p>
<ul>
<li><p>Recall that a model’s <span class="math inline">\(R^2\)</span> describes the proportion of the total variance in our outcome, explained by the model’s predictions.</p></li>
<li><p>When we add predictors to a model, the model becomes more flexible, and can explain more variance in the outcome.</p></li>
<li><p><em>adjusted</em> <span class="math inline">\(R^2\)</span> adjusts models’s <span class="math inline">\(R^2\)</span> by penalizing models for total number of predictors needed to explain given amount of variance</p></li>
<li><p>When models are <em>nested</em> (the predictors in a smaller model are a subset of the predictors in a larger model), we can compare the relative performance of the two using tools like <span class="math inline">\(R^2\)</span> and adjusted <span class="math inline">\(R^2\)</span>.</p></li>
<li><p>When comparing models, we make trade offs between our desire to explain as much variation in the outcome as possible with a general preference for more parsimonious models.<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a></p>
<ul>
<li>For example, a simple bivariate regression and a complicated multiple regression could have the same <span class="math inline">\(R^2\)</span> (i.e.&nbsp;the both explain 50 percent of the total variance in the outcome), but the adjusted <span class="math inline">\(R^2\)</span> will be higher for the simple regression compared to the multiple regression, because it needed fewer predictors to explain the same amount of variance.</li>
</ul></li>
</ul></li>
</ul>
</section>
<section id="workflow" class="level1 unnumbered">
<h1 class="unnumbered">Workflow</h1>
</section>
<section id="please-knit-this-.rmd-file" class="level1 unnumbered">
<h1 class="unnumbered">Please knit this .Rmd file</h1>
<p>As with every lab, you should:</p>
<ul>
<li>Download the file</li>
<li>Save it in your course folder</li>
<li><strong>Update the <code>author:</code> section of the YAML header to include the names of your group members in attendance.</strong></li>
<li>Knit the document</li>
<li>Open the html file in your browser (Easier to read)</li>
<li>Write your code in the chunks provided</li>
<li>Comment out or delete any test code you do not need</li>
<li><strong>Knit the document again after completing a section or chunk</strong> (Error checking)</li>
<li>Upload the final lab to <a href="https://canvas.brown.edu/courses/1091286/assignments/7925689?module_item_id=10882050" target="_blank">Canvas</a>.</li>
</ul>
</section>
<section id="get-setup-to-work" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Get setup to work</h1>
<section id="load-packages" class="level2" data-number="1.1">
<h2 data-number="1.1" class="anchored" data-anchor-id="load-packages"><span class="header-section-number">1.1</span> Load Packages</h2>
<p>First lets load the libraries we’ll need for today.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>the_packages <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>  <span class="do">## R Markdown</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">"kableExtra"</span>,<span class="st">"DT"</span>,<span class="st">"texreg"</span>,<span class="st">"htmltools"</span>,</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  <span class="co">#"flair", # Comments only</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Tidyverse</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">"tidyverse"</span>, <span class="st">"lubridate"</span>, <span class="st">"forcats"</span>, <span class="st">"haven"</span>, <span class="st">"labelled"</span>,</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Extensions for ggplot</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>  <span class="st">"ggmap"</span>,<span class="st">"ggrepel"</span>, <span class="st">"ggridges"</span>, <span class="st">"ggthemes"</span>, <span class="st">"ggpubr"</span>, </span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>  <span class="st">"GGally"</span>, <span class="st">"scales"</span>, <span class="st">"dagitty"</span>, <span class="st">"ggdag"</span>, <span class="st">"ggforce"</span>,</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Data </span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>  <span class="st">"COVID19"</span>,<span class="st">"maps"</span>,<span class="st">"mapdata"</span>,<span class="st">"qss"</span>,<span class="st">"tidycensus"</span>, <span class="st">"dataverse"</span>,</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Analysis</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>  <span class="st">"DeclareDesign"</span>, <span class="st">"zoo"</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Define function to load packages</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>ipak <span class="ot">&lt;-</span> <span class="cf">function</span>(pkg){</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>    new.pkg <span class="ot">&lt;-</span> pkg[<span class="sc">!</span>(pkg <span class="sc">%in%</span> <span class="fu">installed.packages</span>()[, <span class="st">"Package"</span>])]</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">length</span>(new.pkg)) </span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>        <span class="fu">install.packages</span>(new.pkg, <span class="at">dependencies =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sapply</span>(pkg, require, <span class="at">character.only =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a><span class="fu">ipak</span>(the_packages)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   kableExtra            DT        texreg     htmltools     tidyverse 
         TRUE          TRUE          TRUE          TRUE          TRUE 
    lubridate       forcats         haven      labelled         ggmap 
         TRUE          TRUE          TRUE          TRUE          TRUE 
      ggrepel      ggridges      ggthemes        ggpubr        GGally 
         TRUE          TRUE          TRUE          TRUE          TRUE 
       scales       dagitty         ggdag       ggforce       COVID19 
         TRUE          TRUE          TRUE          TRUE          TRUE 
         maps       mapdata           qss    tidycensus     dataverse 
         TRUE          TRUE          TRUE          TRUE          TRUE 
DeclareDesign           zoo 
         TRUE          TRUE </code></pre>
</div>
</div>
</section>
<section id="load-the-data" class="level2" data-number="1.2">
<h2 data-number="1.2" class="anchored" data-anchor-id="load-the-data"><span class="header-section-number">1.2</span> Load the data</h2>
<p>Next we’ll load the recoded data for the lab.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="fu">url</span>(<span class="st">"https://pols1600.paultesta.org/files/data/df_drww.rda"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="describe-the-data" class="level2" data-number="1.3">
<h2 data-number="1.3" class="anchored" data-anchor-id="describe-the-data"><span class="header-section-number">1.3</span> Describe the data</h2>
<p>As always, it’s important to get a high level overview of data when we first load it into R.</p>
<p>Below we take a look at the first few values of all the data. You’ll see that <code>df_drww</code> includes both the Russian data and recoded revisions of the data (which are typically appended with <code>_n</code> for numeric data or <code>_f</code> for factor data).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(df_drww)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 1,807
Columns: 42
$ sex                          &lt;chr&gt; "Male", "Male", "Female", "Female", "Male…
$ age                          &lt;dbl&gt; 99, 78, 73, 73, 69, 69, 59, 54, 49, 48, 4…
$ support_war                  &lt;fct&gt; "(НЕ ЗАЧИТЫВАТЬ) Затрудняюсь ответить", "…
$ trust_gov                    &lt;fct&gt; (НЕ ЗАЧИТЫВАТЬ) Затрудняюсь ответить, Дов…
$ employ_working               &lt;dbl&gt; 1, 0, 0, 0, 1, 0, 0, 1, 1, 0, 0, 1, 1, 1,…
$ employ_student               &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…
$ employ_retired               &lt;dbl&gt; 0, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0,…
$ employ_maternity_leave       &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…
$ employ_homemaker             &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…
$ employ_unemployed            &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0,…
$ employ_other_employment      &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…
$ other_employ_open_response   &lt;chr&gt; "                                        …
$ education                    &lt;fct&gt; (НЕ ЗАЧИТЫВАТЬ) Затрудняюсь ответить, Выс…
$ social_classmates            &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0,…
$ social_in_contact_with       &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0,…
$ social_facebook              &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0,…
$ social_instagram             &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0,…
$ social_twitter               &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0,…
$ social_telegram              &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0,…
$ social_whatsapp              &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0,…
$ social_viber                 &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0,…
$ social_tiktok                &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0,…
$ social_other_social_networks &lt;dbl&gt; 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0,…
$ none_social                  &lt;fct&gt; НЕ ВЫБРАН, ВЫБРАН, НЕ ВЫБРАН, ВЫБРАН, НЕ …
$ dk_social                    &lt;fct&gt; ВЫБРАН, НЕ ВЫБРАН, НЕ ВЫБРАН, НЕ ВЫБРАН, …
$ other_social_open_response   &lt;chr&gt; "                                        …
$ other_social_group           &lt;fct&gt; NA, NA, Ютуб, NA, Ютуб, NA, NA, NA, NA, N…
$ geo_urban_rural              &lt;fct&gt; NA, NA, "город, поселок городского типа",…
$ geo_district                 &lt;fct&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…
$ weight                       &lt;dbl&gt; 0.000, 0.000, 1.208, 0.000, 1.231, 1.208,…
$ support_war_f                &lt;fct&gt; NA, Yes, Yes, Yes, Yes, Yes, No, Yes, Yes…
$ support_war01                &lt;dbl&gt; NA, 1, 1, 1, 1, 1, 0, 1, 1, NA, 1, 1, 1, …
$ trust_gov_f                  &lt;fct&gt; NA, Partly, Largely, Fully, Partly, Fully…
$ trust_gov_n                  &lt;dbl&gt; NA, 1, 2, 3, 1, 3, 0, NA, 2, NA, NA, 0, 3…
$ education_f                  &lt;fct&gt; NA, College or some college, Vocational, …
$ education_n                  &lt;dbl&gt; NA, 4, 3, 4, 1, 3, 4, NA, 4, NA, 3, 3, 3,…
$ geo_urban_rural_f            &lt;fct&gt; NA, NA, Urban, NA, Rural, Urban, Rural, N…
$ geo_district_f               &lt;fct&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, N…
$ social_youtube               &lt;dbl&gt; 0, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1, 0,…
$ social_yandex                &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…
$ total_social_media_use       &lt;dbl&gt; 0, 0, 1, 0, 1, 0, 0, 0, 9, 0, 1, 0, 1, 0,…
$ no_social_media              &lt;dbl&gt; 1, 1, 0, 1, 0, 1, 1, 1, 0, 1, 0, 1, 0, 1,…</code></pre>
</div>
</div>
<p>In the first part of this lab, we’ll work with the following variables</p>
<ul>
<li><p><code>support_war01</code> “Please tell me, do you support or do not support Russia’s military actions on the territory of Ukraine?” (1=yes, 0 = no)</p></li>
<li><p><code>age</code> “How old are you?”</p></li>
<li><p><code>sex</code> “Gender of respondent” (As assessed by the interviewer)</p></li>
<li><p><code>education_n</code> “What is your highest level of education (confirmed by a diploma, certificate)?” (1 = Primary school, 2 = “High School”, 3 = “Vocational School” 4 = “College”, 5 = Graduate Degree)<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a></p></li>
</ul>
<p>In the code chunk below, I create a data frame of summary statistics:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>the_vars <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"support_war01"</span>,<span class="st">"age"</span>, <span class="st">"is_female"</span>, <span class="st">"education_n"</span>)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>df_drww <span class="sc">%&gt;%</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">is_female =</span> <span class="fu">ifelse</span>(sex <span class="sc">==</span> <span class="st">"Female"</span>,<span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">all_of</span>(the_vars)) <span class="sc">%&gt;%</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">all_of</span>(the_vars ),</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">"Variable"</span>,</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">"Value"</span></span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Variable) <span class="sc">%&gt;%</span></span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">N obs</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">n</span>(),</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">Missing =</span> <span class="fu">sum</span>(<span class="fu">is.na</span>(Value)),</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">Min =</span> <span class="fu">min</span>(Value, <span class="at">na.rm =</span> T),</span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">25th perc</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">quantile</span>(Value, .<span class="dv">25</span>, <span class="at">na.rm=</span>T),</span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">Mean =</span> <span class="fu">mean</span>(Value, <span class="at">na.rm=</span>T),</span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">Median =</span> <span class="fu">median</span>(Value, <span class="at">na.rm =</span> T),</span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">75th perc</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">quantile</span>(Value, .<span class="dv">75</span>, <span class="at">na.rm=</span>T),</span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>    <span class="at">Max =</span> <span class="fu">max</span>(Value, <span class="at">na.rm =</span> T)</span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">Variable =</span> <span class="fu">case_when</span>(</span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a>      Variable <span class="sc">==</span> <span class="st">"age"</span> <span class="sc">~</span> <span class="st">"Age"</span>,</span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a>      Variable <span class="sc">==</span> <span class="st">"education_n"</span> <span class="sc">~</span> <span class="st">"Education"</span>,</span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a>      Variable <span class="sc">==</span> <span class="st">"is_female"</span> <span class="sc">~</span> <span class="st">"Female"</span>,</span>
<span id="cb6-29"><a href="#cb6-29" aria-hidden="true" tabindex="-1"></a>      Variable <span class="sc">==</span> <span class="st">"support_war01"</span> <span class="sc">~</span> <span class="st">"Support for War"</span>,</span>
<span id="cb6-30"><a href="#cb6-30" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb6-31"><a href="#cb6-31" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb6-32"><a href="#cb6-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">Variable =</span> <span class="fu">factor</span>(Variable, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Support for War"</span>,<span class="st">"Age"</span>,<span class="st">"Female"</span>,<span class="st">"Education"</span>))</span>
<span id="cb6-33"><a href="#cb6-33" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb6-34"><a href="#cb6-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(Variable) <span class="ot">-&gt;</span>  summary_table</span>
<span id="cb6-35"><a href="#cb6-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-36"><a href="#cb6-36" aria-hidden="true" tabindex="-1"></a>summary_table</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 9
  Variable     `N obs` Missing   Min `25th perc`   Mean Median `75th perc`   Max
  &lt;fct&gt;          &lt;int&gt;   &lt;int&gt; &lt;dbl&gt;       &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;       &lt;dbl&gt; &lt;dbl&gt;
1 Support for…    1807     334     0           0  0.720      1           1     1
2 Age             1807       0    18          34 46.6       45          60    99
3 Female          1807       0     0           0  0.470      0           1     1
4 Education       1807      13     1           3  3.17       3           4     5</code></pre>
</div>
</div>
<p>Which we can then format into a table of summary statistics:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span><span class="fu">kable</span>(summary_table,</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>      <span class="at">digits =</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kable_styling</span>(<span class="at">bootstrap_options =</span> <span class="fu">c</span>(<span class="st">"striped"</span>, <span class="st">"hover"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">pack_rows</span>(</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">group_label =</span> <span class="st">"Outcome"</span>,</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">start_row =</span> <span class="dv">1</span>,</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">end_row =</span> <span class="dv">1</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>  )<span class="sc">%&gt;%</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">pack_rows</span>(</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">group_label =</span> <span class="st">"Predictors"</span>,</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">start_row =</span> <span class="dv">2</span>,</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">end_row =</span> <span class="dv">4</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="table table-striped table-hover table-sm small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Variable</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">N obs</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Missing</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Min</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">25th perc</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Mean</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Median</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">75th perc</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Max</th>
</tr>
</thead>
<tbody>
<tr class="odd" data-grouplength="1">
<td colspan="9" style="border-bottom: 1px solid"><strong>Outcome</strong></td>
</tr>
<tr class="even">
<td style="text-align: left; padding-left: 2em;" data-indentlevel="1">Support for War</td>
<td style="text-align: right;">1807</td>
<td style="text-align: right;">334</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.72</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd" data-grouplength="3">
<td colspan="9" style="border-bottom: 1px solid"><strong>Predictors</strong></td>
</tr>
<tr class="even">
<td style="text-align: left; padding-left: 2em;" data-indentlevel="1">Age</td>
<td style="text-align: right;">1807</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">18</td>
<td style="text-align: right;">34</td>
<td style="text-align: right;">46.65</td>
<td style="text-align: right;">45</td>
<td style="text-align: right;">60</td>
<td style="text-align: right;">99</td>
</tr>
<tr class="odd">
<td style="text-align: left; padding-left: 2em;" data-indentlevel="1">Female</td>
<td style="text-align: right;">1807</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">0.47</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="even">
<td style="text-align: left; padding-left: 2em;" data-indentlevel="1">Education</td>
<td style="text-align: right;">1807</td>
<td style="text-align: right;">13</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">3.17</td>
<td style="text-align: right;">3</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">5</td>
</tr>
</tbody>
</table>


</div>
</div>
<p><strong>Please use this table to describe a typical respondent to the survey</strong></p>
<p>YOUR DESCRIPTION HERE</p>
<hr>
</section>
</section>
<section id="interpretting-long-chunks-of-code" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Interpretting long chunks of code</h1>
<p>The previous section contained a fairly long chunk of code.</p>
<p>I suspect you had little trouble interpreting the table of summary statistics produced by the second code chunk (<code>summary_table</code>), but may not have followed everything that was happening in the first code chunk (<code>summary_stats</code>).</p>
<p>In this section, I want you to practice interpreting large chunks of code with lots of <code>%&gt;%</code></p>
<ul>
<li><p>Recall, that the pipe command takes the outcome from a function that comes before the <code>%&gt;%</code> and <code>pipes</code> it into the <strong>first argument</strong> of the function that comes after it.</p></li>
<li><p>Each function in <code>summary_stats</code> expects a <code>data.frame</code> in its first argument. The function then does something to this inputted data frame (add a column, pivot columns, etc) and returns a new data.frame which <code>%&gt;%</code> then passes on to next function.</p></li>
</ul>
<p>To learn how to produce a table of summary statistics (a common task for empirical work), it’s helpful to understand what’s happening at each step of the process in the <code>summary_stats</code> code chunk.</p>
<p>In the code chunk below, starting from <code>df_drww %&gt;%</code> please</p>
<ul>
<li><p>Copy and paste the all the code up until the next <code>%&gt;%</code></p></li>
<li><p>Run this code in your console</p></li>
<li><p>Write a comment above this code in code chunk</p></li>
</ul>
<p>Running code line-by-line, is great way to learn how to code, by understanding what happens in each line of code.</p>
<p>There are about 8 or 9 steps of code to explain (depending on how you copy and paste.) I’ve done steps 1-3 below. Please take the next 10 minutes or so to fill in the rest.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ---- Step 1 -----</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a vector of variables we want to summarize</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>the_vars <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"support_war01"</span>,<span class="st">"age"</span>, <span class="st">"is_female"</span>, <span class="st">"education_n"</span>)</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a><span class="co"># ---- Step 2 -----</span></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a><span class="co"># From df_drww create a new variable `is_female` that is 1 when sex == "Female, and 0 otherwise</span></span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>df_drww <span class="sc">%&gt;%</span></span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(                             </span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">is_female =</span> <span class="fu">ifelse</span>(sex <span class="sc">==</span> <span class="st">"Female"</span>,<span class="dv">1</span>, <span class="dv">0</span>) </span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>  ) </span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a><span class="co"># ---- Step 3 -----</span></span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Select just the columns we want to summarize</span></span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>df_drww <span class="sc">%&gt;%</span></span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>    <span class="at">is_female =</span> <span class="fu">ifelse</span>(sex <span class="sc">==</span> <span class="st">"Female"</span>,<span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">all_of</span>(the_vars))</span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a><span class="co"># ---- Step 4 -----</span></span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Comment</span></span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a>df_drww <span class="sc">%&gt;%</span></span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a>    <span class="at">is_female =</span> <span class="fu">ifelse</span>(sex <span class="sc">==</span> <span class="st">"Female"</span>,<span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb9-33"><a href="#cb9-33" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb9-34"><a href="#cb9-34" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">all_of</span>(the_vars)) <span class="sc">%&gt;%</span></span>
<span id="cb9-35"><a href="#cb9-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb9-36"><a href="#cb9-36" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">all_of</span>(the_vars ),</span>
<span id="cb9-37"><a href="#cb9-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">"Variable"</span>,</span>
<span id="cb9-38"><a href="#cb9-38" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">"Value"</span></span>
<span id="cb9-39"><a href="#cb9-39" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb9-40"><a href="#cb9-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-41"><a href="#cb9-41" aria-hidden="true" tabindex="-1"></a><span class="co"># ---- Step 5 -----</span></span>
<span id="cb9-42"><a href="#cb9-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-43"><a href="#cb9-43" aria-hidden="true" tabindex="-1"></a><span class="co"># Comment</span></span>
<span id="cb9-44"><a href="#cb9-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-45"><a href="#cb9-45" aria-hidden="true" tabindex="-1"></a>df_drww <span class="sc">%&gt;%</span></span>
<span id="cb9-46"><a href="#cb9-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb9-47"><a href="#cb9-47" aria-hidden="true" tabindex="-1"></a>    <span class="at">is_female =</span> <span class="fu">ifelse</span>(sex <span class="sc">==</span> <span class="st">"Female"</span>,<span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb9-48"><a href="#cb9-48" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb9-49"><a href="#cb9-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">all_of</span>(the_vars)) <span class="sc">%&gt;%</span></span>
<span id="cb9-50"><a href="#cb9-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb9-51"><a href="#cb9-51" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">all_of</span>(the_vars ),</span>
<span id="cb9-52"><a href="#cb9-52" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">"Variable"</span>,</span>
<span id="cb9-53"><a href="#cb9-53" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">"Value"</span></span>
<span id="cb9-54"><a href="#cb9-54" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb9-55"><a href="#cb9-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Variable)</span>
<span id="cb9-56"><a href="#cb9-56" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-57"><a href="#cb9-57" aria-hidden="true" tabindex="-1"></a><span class="co"># ---- Step 6 -----</span></span>
<span id="cb9-58"><a href="#cb9-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-59"><a href="#cb9-59" aria-hidden="true" tabindex="-1"></a><span class="co"># Comment</span></span>
<span id="cb9-60"><a href="#cb9-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-61"><a href="#cb9-61" aria-hidden="true" tabindex="-1"></a>df_drww <span class="sc">%&gt;%</span></span>
<span id="cb9-62"><a href="#cb9-62" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb9-63"><a href="#cb9-63" aria-hidden="true" tabindex="-1"></a>    <span class="at">is_female =</span> <span class="fu">ifelse</span>(sex <span class="sc">==</span> <span class="st">"Female"</span>,<span class="dv">1</span>, <span class="dv">0</span>)</span>
<span id="cb9-64"><a href="#cb9-64" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb9-65"><a href="#cb9-65" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">all_of</span>(the_vars)) <span class="sc">%&gt;%</span></span>
<span id="cb9-66"><a href="#cb9-66" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(</span>
<span id="cb9-67"><a href="#cb9-67" aria-hidden="true" tabindex="-1"></a>    <span class="at">cols =</span> <span class="fu">all_of</span>(the_vars ),</span>
<span id="cb9-68"><a href="#cb9-68" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_to =</span> <span class="st">"Variable"</span>,</span>
<span id="cb9-69"><a href="#cb9-69" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_to =</span> <span class="st">"Value"</span></span>
<span id="cb9-70"><a href="#cb9-70" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb9-71"><a href="#cb9-71" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Variable) <span class="sc">%&gt;%</span></span>
<span id="cb9-72"><a href="#cb9-72" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb9-73"><a href="#cb9-73" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">N obs</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">n</span>(),</span>
<span id="cb9-74"><a href="#cb9-74" aria-hidden="true" tabindex="-1"></a>    <span class="at">Missing =</span> <span class="fu">sum</span>(<span class="fu">is.na</span>(Value)),</span>
<span id="cb9-75"><a href="#cb9-75" aria-hidden="true" tabindex="-1"></a>    <span class="at">Min =</span> <span class="fu">min</span>(Value, <span class="at">na.rm =</span> T),</span>
<span id="cb9-76"><a href="#cb9-76" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">25th perc</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">quantile</span>(Value, .<span class="dv">25</span>, <span class="at">na.rm=</span>T),</span>
<span id="cb9-77"><a href="#cb9-77" aria-hidden="true" tabindex="-1"></a>    <span class="at">Mean =</span> <span class="fu">mean</span>(Value, <span class="at">na.rm=</span>T),</span>
<span id="cb9-78"><a href="#cb9-78" aria-hidden="true" tabindex="-1"></a>    <span class="at">Median =</span> <span class="fu">median</span>(Value, <span class="at">na.rm =</span> T),</span>
<span id="cb9-79"><a href="#cb9-79" aria-hidden="true" tabindex="-1"></a>    <span class="st">`</span><span class="at">75th perc</span><span class="st">`</span> <span class="ot">=</span> <span class="fu">quantile</span>(Value, .<span class="dv">75</span>, <span class="at">na.rm=</span>T),</span>
<span id="cb9-80"><a href="#cb9-80" aria-hidden="true" tabindex="-1"></a>    <span class="at">Max =</span> <span class="fu">max</span>(Value, <span class="at">na.rm =</span> T)</span>
<span id="cb9-81"><a href="#cb9-81" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb9-82"><a href="#cb9-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-83"><a href="#cb9-83" aria-hidden="true" tabindex="-1"></a><span class="co"># ---- Step 7 -----</span></span>
<span id="cb9-84"><a href="#cb9-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-85"><a href="#cb9-85" aria-hidden="true" tabindex="-1"></a><span class="co"># Comment</span></span>
<span id="cb9-86"><a href="#cb9-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-87"><a href="#cb9-87" aria-hidden="true" tabindex="-1"></a><span class="co"># ---- Step 8 -----</span></span>
<span id="cb9-88"><a href="#cb9-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-89"><a href="#cb9-89" aria-hidden="true" tabindex="-1"></a><span class="co"># Comment</span></span>
<span id="cb9-90"><a href="#cb9-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-91"><a href="#cb9-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-92"><a href="#cb9-92" aria-hidden="true" tabindex="-1"></a><span class="co"># ---- Step 9 -----</span></span>
<span id="cb9-93"><a href="#cb9-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-94"><a href="#cb9-94" aria-hidden="true" tabindex="-1"></a><span class="co"># Comment</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
</section>
<section id="explore-the-demographic-predictors-of-russians-support-for-the-war-in-ukraine" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Explore the demographic predictors of Russians’ Support for the War in Ukraine</h1>
<p>Today, we will estimate four models to explore how Russian support for the war in Ukraine varies with demographic predictors.</p>
<ul>
<li><p><code>m1</code> provides a baseline model that predicts support for the war as a linear function of <code>age</code>, <code>sex</code>, and <code>education_n</code> measured as numeric scale (1 = Primary School, 5 = Graduate Degree).</p></li>
<li><p><code>m2</code> is an <strong>interaction regression model</strong> that asks whether the relationship between <code>age</code> and <code>support</code> varies by <code>sex</code></p></li>
<li><p><code>m3</code> is a <strong>polynomial regression model</strong>, that includes a term for “age-squared” which allows the relationship between age and support to vary over different levels of age</p></li>
<li><p><code>m4</code> adds an interaction term to the <em>polynomial</em> regression from <code>m3</code> essentially allowing for separate curves for male and female respondents.</p></li>
</ul>
<hr>
<section id="describe-your-expectations-for-these-models" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="describe-your-expectations-for-these-models"><span class="header-section-number">3.1</span> Describe your expectations for these models</h2>
<p>Before you estimate these models, please answer the following:</p>
<p><strong>In the baseline model, <code>m1</code></strong> what do you expect the sign of the coefficient for each predictor to be:</p>
<ul>
<li><p><em>Age</em> (<strong>Positive/Negative</strong>)</p></li>
<li><p><em>Sex</em> (<strong>Positive/Negative</strong>)<a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a></p></li>
<li><p><em>Education</em> (<strong>Positive/Negative</strong>)</p></li>
</ul>
<p><strong>In the interaction model, <code>m2</code></strong></p>
<ul>
<li><p>Do you think the relationship between age and support will vary by sex (<strong>Yes/No</strong>)</p></li>
<li><p>If you said yes, do you think the coefficient on the interaction between age and sex will be positive or negative (<strong>Positive/Negative</strong>)</p></li>
</ul>
<p><strong>In the polynomial model, <code>m3</code></strong></p>
<ul>
<li><p>If the coefficient on <code>age</code> is positive and the coefficient on <code>age^2</code> is positive, then as age increases, the increase in the predicted level of support will be (<strong>increasing/decreasing</strong>)</p></li>
<li><p>If the coefficient on <code>age</code> is positive and the coefficient on <code>age^2</code> is negative, then as age increases, the increase in the predicted level of support will be (<strong>increasing/decreasing</strong>)</p></li>
</ul>
<p><strong>In <code>m4</code></strong></p>
<ul>
<li>If the coefficients on the interaction terms between the <code>sex</code> variable and the age variables (<code>age</code> and <code>age^2</code>) is statistically significant, this implies that the relationship between <code>age</code> and support for the war is (<strong>similar/different</strong>) for male and female respondents.</li>
</ul>
<hr>
</section>
<section id="estimate-the-regression-models" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="estimate-the-regression-models"><span class="header-section-number">3.2</span> Estimate the regression models</h2>
<p>Uncomment the code below, and replace the <code>???</code> with the appropriate terms to fit the following models.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Baseline Model</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="co"># m1 &lt;- lm(support_war01 ~ ??? + ??? + ???, ???)</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Interaction model: Allow coefficient for age to vary with sex</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a><span class="co"># m2 &lt;- lm(support_war01 ~ age*??? + education_n, df_drww)</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Polynomial model: Allow coefficient for age to vary by age</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a><span class="co"># m3 &lt;- lm(support_war01 ~ age + I(???^2) + sex + education_n, df_drww)</span></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Separate Polynomial: Allow coefficient for age to vary by age separately  by sex</span></span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a><span class="co"># m4 &lt;- lm(support_war01 ~ (age + I(age^2))*??? + education_n, df_drww)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
</section>
</section>
<section id="display-your-models-in-a-regression-table-and-offer-some-initial-interpretations" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> Display your models in a regression table and offer some initial interpretations</h1>
<p>Using code from previous labs and lectures, please display the models from the previous section in a regression table and offer some initial interpretations.</p>
<p>You can use the <a href="https://pols1600.paultesta.org/labs/06-lab-comments.html#4_Estimate_a_model_controlling_for_age_and_income" target="_blank">code from last week’s lab as a guide.</a></p>
<ul>
<li>Try adding the argument, <code>digits = 4</code> to <code>htmlreg</code></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Display m1, m2, m3, m4 in a regression table</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="co"># texreg::htmlreg(list(m1, m2, m3, m4), digits = 5) %&gt;% HTML() %&gt;% browsable()</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>In particular, please answer the following:</strong></p>
<p>For <code>m1</code> (Model 1) how do predicted levels of support for the war, change with</p>
<ul>
<li><p><strong>Age</strong> Write a sentence or two here describing the relationship in terms a human can understand.</p></li>
<li><p><strong>Sex</strong></p></li>
<li><p><strong>Education</strong></p></li>
</ul>
<p>For <code>m2</code>(Model 2) does the relationship between age and support appear to differ for male and female respondents (<strong>Yes/No</strong>)</p>
<p>For <code>m3</code> (Model 3) Does the relationship between age and support appear to be constant or does the predicted marginal effect of an increase in age differ<a href="#fn5" class="footnote-ref" id="fnref5" role="doc-noteref"><sup>5</sup></a></p>
<ul>
<li>(<strong>The marginal effect of age is constant / The marginal effect of age varies</strong>)</li>
</ul>
<p>For <code>m4</code> (Model 4) do the varying marginal effects of age appear to also vary by gender?<a href="#fn6" class="footnote-ref" id="fnref6" role="doc-noteref"><sup>6</sup></a></p>
<ul>
<li>(<strong>Yes/No</strong>)</li>
</ul>
<hr>
</section>
<section id="use-r2-to-compare-models" class="level1" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> Use <span class="math inline">\(R^2\)</span> to compare models</h1>
<p>Now take a look at the bottom rows in your regression table which show each model’s <span class="math inline">\(R^2\)</span> and adjusted <span class="math inline">\(R^2\)</span>.</p>
<p>Recall from class, that <span class="math inline">\(R^2\)</span> describes the proportion of the variance in our outcome (support for the war), explained by the predictors in our model (age, sex, education, and some interactions/polynomials).</p>
<p>You may also remember that <span class="math inline">\(R^2\)</span> always increases as we add more predictors to the model. To account for this, we often look at the adjusted <span class="math inline">\(R^2\)</span> which weights the increase in variance explained (decrease in variance unexplained) by the number of additional predictors needed to produce that increase.</p>
<p>You regression table only reports results to a few decimal places.</p>
<p>Let’s use the <code>summary()</code> function to extract and save the <span class="math inline">\(R^2\)</span> (<code>r.squared</code>) and adjusted <span class="math inline">\(R^2\)</span> (<code>adj.r.squared</code>) for each model. The code for <code>m1</code> is there as an example.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># m1</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="co"># m1_r_squared &lt;- summary(m1)$r.squared</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="co"># m1_r_squared</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="co"># m1_adj_r_squared &lt;- summary(m1)$adj.r.squared</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="co"># m1_adj_r_squared</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a><span class="co"># m2</span></span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a><span class="co"># m3</span></span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a><span class="co"># m4</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Please answer the following:</p>
<ul>
<li><p><strong>How does the</strong> <span class="math inline">\(R^2\)</span> change from <code>m1</code> to <code>m4</code></p></li>
<li><p><strong>How does the adjusted</strong> <span class="math inline">\(R^2\)</span> change from <code>m1</code> to <code>m4</code></p></li>
<li><p><strong>Overall, which model should we prefer?</strong></p></li>
</ul>
<hr>
</section>
<section id="produce-and-visualize-predicted-values-for-m1-and-m3" class="level1" data-number="6">
<h1 data-number="6"><span class="header-section-number">6</span> Produce and visualize predicted values for m1 and m3</h1>
<p>Now let’s produce and visualize predicted values to help us interpret the relationship between age and support for the war <code>m1</code> (our baseline model) and <code>m3</code> (our polynomial model)</p>
<p>We demonstrated the steps for producing predicted values in Tuesday’s <a href="https://pols1600.paultesta.org/slides/07-slides.html#64">lecture</a></p>
<p>To review: you’ll need to</p>
<ol type="1">
<li>Fit a model (already done)</li>
<li>Create a prediction data frame (<code>pred_df</code>)</li>
</ol>
<ul>
<li>use <code>expand_grid()</code></li>
<li>vary <code>age</code> using <code>seq()</code></li>
<li>hold <code>sex</code> and <code>education</code> constant at typical values</li>
</ul>
<ol start="3" type="1">
<li>Use this prediction data frame to obtain predicted values from each model and save the output as a new column in <code>pred_df</code></li>
</ol>
<ul>
<li>for example <code>pred_df$fit_m1 &lt;- predict(m1, newdata = pred_df)</code></li>
</ul>
<ol start="4" type="1">
<li>Visualize the results using ggplot.</li>
</ol>
<ul>
<li>use <code>pred_df</code> as your data</li>
<li>map <code>age</code> to x axis</li>
<li>map <code>fit_m1</code> or <code>fit_m3</code> to the y axis</li>
<li>tell ggplot to draw a line using <code>geom_line()</code></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Create a prediction data frame (`pred_df`)</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>pred_df <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">age =</span> <span class="fu">seq</span>(<span class="dv">18</span>, <span class="dv">99</span>, <span class="at">length.out =</span> <span class="dv">10</span>),</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">sex =</span> <span class="st">"Male"</span>,</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">education_n =</span> <span class="fu">mean</span>(df_drww<span class="sc">$</span>education_n, <span class="at">na.rm =</span> T)</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>pred_df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   age  sex education_n
1   18 Male    3.166667
2   27 Male    3.166667
3   36 Male    3.166667
4   45 Male    3.166667
5   54 Male    3.166667
6   63 Male    3.166667
7   72 Male    3.166667
8   81 Male    3.166667
9   90 Male    3.166667
10  99 Male    3.166667</code></pre>
</div>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 3  Use this prediction data frame to obtain predicted values from our model</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Save the output from predict() back into our prediction data frame</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="co"># pred_df$fit_m1 &lt;- predict(m1, newdata = pred_df)</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a><span class="co"># pred_df$fit_m3 &lt;- predict(m3, newdata = pred_df)</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a><span class="do">## predicted values for m1</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a><span class="do">## predicted values for m3</span></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a><span class="co"># 4. Visualize the results using ggplot.</span></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a><span class="do">## plot predicted values for m1</span></span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a><span class="co"># pred_df %&gt;%</span></span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a><span class="co">#   ggplot(aes(x = age,</span></span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a><span class="co">#              y = fit_m1))+</span></span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_line()</span></span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a><span class="do">## plot predicted values for m3</span></span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a><span class="co"># pred_df %&gt;%</span></span>
<span id="cb15-26"><a href="#cb15-26" aria-hidden="true" tabindex="-1"></a><span class="co">#   ggplot(aes(x = age,</span></span>
<span id="cb15-27"><a href="#cb15-27" aria-hidden="true" tabindex="-1"></a><span class="co">#              y = fit_m3))+</span></span>
<span id="cb15-28"><a href="#cb15-28" aria-hidden="true" tabindex="-1"></a><span class="co">#   geom_line()</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Please offer a brief interpretation of these two figures</strong></p>
<hr>
</section>
<section id="produce-and-visualize-predicted-values-for-m2-and-m4" class="level1" data-number="7">
<h1 data-number="7"><span class="header-section-number">7</span> Produce and visualize predicted values for m2 and m4</h1>
<p>Finally, let’s see how to produce and interpret predictions for models <code>m2</code> and <code>m4</code>.</p>
<p>Recall, that in <code>m2</code> we allowed the coefficient on <code>age</code> to vary by <code>sex</code> and in <code>m4</code> our model estimates separate age curves for male and female respondents.</p>
<p>In the code chunk below</p>
<ol start="2" type="1">
<li>Create a new prediction data frame (<code>pred_df_int</code>)</li>
</ol>
<ul>
<li>use <code>expand_grid()</code></li>
<li>vary <code>age</code> using <code>seq()</code></li>
<li>vary <code>sex = c("Male","Female")</code></li>
<li>hold <code>education</code> constant at a typical value</li>
</ul>
<ol start="3" type="1">
<li>Use this prediction data frame to obtain predicted values from each model and save the output as a new column in <code>pred_df_int</code></li>
</ol>
<ul>
<li>for example: <code>pred_df_int$fit_m2 &lt;- predict(m2, newdata = pred_df_int)</code></li>
</ul>
<ol start="4" type="1">
<li>Visualize the results using ggplot.</li>
</ol>
<ul>
<li>use <code>pred_df_int</code> as your data</li>
<li>map <code>age</code> to x axis</li>
<li>map <code>fit_m2</code> or <code>fit_m4</code> to the y axis</li>
<li>map <code>sex</code> to <code>col</code> to produce separate lines by the values of <code>sex</code></li>
<li>tell ggplot to draw a line using <code>geom_line()</code></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Create a prediction data frame (`pred_df_int`)</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>pred_df_int <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">age =</span> <span class="fu">seq</span>(<span class="dv">18</span>, <span class="dv">99</span>, <span class="at">length.out =</span> <span class="dv">10</span>),</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">sex =</span> <span class="fu">c</span>(<span class="st">"Male"</span>,<span class="st">"Female"</span>),</span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">education_n =</span> <span class="fu">mean</span>(df_drww<span class="sc">$</span>education_n, <span class="at">na.rm =</span> T)</span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>pred_df_int</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   age    sex education_n
1   18   Male    3.166667
2   27   Male    3.166667
3   36   Male    3.166667
4   45   Male    3.166667
5   54   Male    3.166667
6   63   Male    3.166667
7   72   Male    3.166667
8   81   Male    3.166667
9   90   Male    3.166667
10  99   Male    3.166667
11  18 Female    3.166667
12  27 Female    3.166667
13  36 Female    3.166667
14  45 Female    3.166667
15  54 Female    3.166667
16  63 Female    3.166667
17  72 Female    3.166667
18  81 Female    3.166667
19  90 Female    3.166667
20  99 Female    3.166667</code></pre>
</div>
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Use this prediction data frame to obtain predicted values from our model</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Save the output from predict() back into our prediction data frame</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="do">## predicted values for m2</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a><span class="do">## predicted values for m4</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a><span class="co"># 4. Visualize the results using ggplot.</span></span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-15"><a href="#cb18-15" aria-hidden="true" tabindex="-1"></a><span class="do">## plot predicted values for m2</span></span>
<span id="cb18-16"><a href="#cb18-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-17"><a href="#cb18-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-18"><a href="#cb18-18" aria-hidden="true" tabindex="-1"></a><span class="do">## plot predicted values for m4</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><strong>Again,please offer a brief interpretation of these two figures</strong></p>
<hr>
</section>
<section id="explore-another-relationship-in-the-data-optional" class="level1" data-number="8">
<h1 data-number="8"><span class="header-section-number">8</span> Explore another relationship in the data (Optional)</h1>
<p>Finally, if you’re finished with all the sections above, take some time to explore the data:</p>
<ol type="1">
<li>Formulate a question you could ask of the data</li>
<li>Estimate a model (or models) that provides insights into this question</li>
<li>Produce a table(s) and figure(s) that helps you interpret your model(s)</li>
</ol>
<p>For fun, let’s say the group that produces the most combination of question/model/interpretation, gets some candy next class.</p>
<p>Some questions you might explore:</p>
<ul>
<li>How do demographic factors predict trust in Russia’s government</li>
<li>Are their systematic differences in who chooses not to answers questions about support for the war or trust in government?</li>
<li>Are there noticeable regional differences in support/trust?</li>
<li>Should we model education as numeric scale or as a categorical factor?</li>
<li>How does the use of social media (either in general or particular types of social media) predict support for the war or Trust in government</li>
</ul>
</section>
<section id="take-the-class-survey" class="level1 unnumbered">
<h1 class="unnumbered">Take the Class Survey</h1>
<p>Please take a few moments to complete the <a href="https://brown.co1.qualtrics.com/jfe/form/SV_5d2ZbPxo6uFcjRQ" target="_blank">class survey</a> for this week.</p>


</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>Mathematically, recall that the slope/first derivative of the line <span class="math inline">\(y = f(x) = 2x\)</span> is constant <span class="math inline">\((f'(x) = 2)\)</span>. If we increase x by 1, we expect y to increase by 2, while the derivative of a parabola <span class="math inline">\(y = f(z) = z^2\)</span> varies with <span class="math inline">\(z\)</span> <span class="math inline">\((f'(z) = 2x)\)</span>. Going from z= 2 to z= 3 is associated with a greater increase in y, then going from z=1 to z=2. Our model, however, is still <a href="https://blog.minitab.com/en/adventures-in-statistics-2/what-is-the-difference-between-linear-and-nonlinear-equations-in-regression-analysis#:~:text=In%20statistics%2C%20a%20regression%20equation,produce%20a%20U%2Dshaped%20curve.">linear in <em>parameters</em></a> <span class="math inline">\(\beta\)</span>. That is, it is still a linear regression. If our model included some parameter <span class="math inline">\(\theta^2\)</span>, then it would be a non-linear regression.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>In a machine learning framework, we trying to find an <a href="https://towardsdatascience.com/understanding-the-bias-variance-tradeoff-165e6942b229">optimal tradeoff</a> between reducing bias in our predictors by including more predictors and minimizing variance in predictions by not overfitting the data.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p>I think, google translate was a bit unclear. But higher numbers equal more education.<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn4"><p>This is tricky, you need to know what the reference (excluded) category will be.<a href="#fnref4" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn5"><p>Basically, I’m asking whether the coefficient on <code>I(age^2)</code> is statistically significant. If it is, then the change in predicted support for the war among say 20-year-olds compared to 30-year-olds, would be different than change between 30- to 40-year-olds. Interpreting polynomials terms and interaction models is much easier if, as we do later, we simply obtain and plot the predicted values from this model<a href="#fnref5" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn6"><p>As in the previous question, basically you need to look at the table and see if the coefficients on the interaction terms are statistically significant. It’s a little more complicated than this, but if they are significant, this is evidence of differences across Sex.<a href="#fnref6" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>