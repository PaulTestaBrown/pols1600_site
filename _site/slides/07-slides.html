<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.545">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>POLS 1600</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/quarto-contrib/fontawesome6-0.1.0/all.css" rel="stylesheet">
<link href="../site_libs/quarto-contrib/fontawesome6-0.1.0/latex-fontsize.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="../site_libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>
<link href="../site_libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">
<script src="../site_libs/datatables-binding-0.32/datatables.js"></script>
<script src="../site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<link href="../site_libs/dt-core-1.13.6/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="../site_libs/dt-core-1.13.6/css/jquery.dataTables.extra.css" rel="stylesheet">
<script src="../site_libs/dt-core-1.13.6/js/jquery.dataTables.min.js"></script>
<link href="../site_libs/crosstalk-1.2.1/css/crosstalk.min.css" rel="stylesheet">
<script src="../site_libs/crosstalk-1.2.1/js/crosstalk.min.js"></script>
<script src="../site_libs/kePrint-0.0.1/kePrint.js"></script>
<link href="../site_libs/lightable-0.0.1/lightable.css" rel="stylesheet">

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">POLS 1600</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../syllabus.html"> 
<span class="menu-text">Syllabus</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../class/index.html"> 
<span class="menu-text">Class</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../assignments/index.html"> 
<span class="menu-text">Assignments</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
    <div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="07-slides.html"><i class="bi bi-file-slides"></i>RevealJS</a></li></ul></div></div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">POLS 1600</h1>
<p class="subtitle lead">Interpreting and Evaluating<br>Linear Models</p>
</div>



<div class="quarto-title-meta">

    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">Updated Mar 14, 2024</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="overview" class="level1 inverse">
<h1 class="inverse"><i class="fa-solid fa-map-location" aria-label="map-location"></i> Overview</h1>
<section id="class-plan" class="level2">
<h2 class="anchored" data-anchor-id="class-plan">Class Plan</h2>
<ul>
<li>Announcements (2-3 min)</li>
<li>Setup (2-3 min)</li>
<li>Feedback (15 min)</li>
<li>Topics:
<ul>
<li>What does it mean to control for X</li>
<li>How to make predictions with regression</li>
<li>Evaluating model fit</li>
<li>Difference-in-Differences</li>
<li>Set up for Lab 7</li>
</ul></li>
</ul>
</section>
<section id="goals" class="level2">
<h2 class="anchored" data-anchor-id="goals">Goals</h2>
<ul>
<li><p>Regression models <span class="blue">partition variation</span> in an outcome into variation explained by the model and not explained by the model</p></li>
<li><p>Individual regression coefficients reflect the <span class="blue">variation explained by that predictor</span>, and <span class="blue">only that predictor</span></p></li>
<li><p><span class="blue">Predicted values</span> for regression models aid in <span class="blue">substantive interpretation</span></p></li>
<li><p><span class="blue">Measures of model fit</span> like <span class="math inline">\(R^2\)</span> can be useful for comparing different regression models</p></li>
<li><p><span class="blue">Difference-in-differences</span> designs combine <span class="blue">pre-post</span> and <span class="blue">treatment-control</span> comparisons to make <span class="blue">stronger causal claims</span>.</p></li>
</ul>
</section>
<section id="annoucements" class="level2">
<h2 class="anchored" data-anchor-id="annoucements">Annoucements</h2>
<ul>
<li><a href="https://pols1600.paultesta.org/assignments/a1" target="_blank">Assignment 1: Research Questions</a> due Tuesday, March 12
<ul>
<li>Feedback by class on Thursday</li>
</ul></li>
<li><a href="https://pols1600.paultesta.org/assignments/a2" target="_blank">Assignment 2 Data:</a> due Friday March 22</li>
</ul>
</section>
<section id="setup-packages-for-today" class="level2">
<h2 class="anchored" data-anchor-id="setup-packages-for-today">Setup: Packages for today</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Pacakges for today</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>the_packages <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  <span class="do">## R Markdown</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">"kableExtra"</span>,<span class="st">"DT"</span>,<span class="st">"texreg"</span>,<span class="st">"htmltools"</span>,</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Tidyverse</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">"tidyverse"</span>, <span class="st">"lubridate"</span>, <span class="st">"forcats"</span>, <span class="st">"haven"</span>, <span class="st">"labelled"</span>,</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Extensions for ggplot</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>  <span class="st">"ggmap"</span>,<span class="st">"ggrepel"</span>, <span class="st">"ggridges"</span>, <span class="st">"ggthemes"</span>, <span class="st">"ggpubr"</span>, </span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>  <span class="st">"GGally"</span>, <span class="st">"scales"</span>, <span class="st">"dagitty"</span>, <span class="st">"ggdag"</span>, <span class="st">"ggforce"</span>,</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Data </span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>  <span class="st">"COVID19"</span>,<span class="st">"maps"</span>,<span class="st">"mapdata"</span>,<span class="st">"qss"</span>,<span class="st">"tidycensus"</span>, <span class="st">"dataverse"</span>, </span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Analysis</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>  <span class="st">"DeclareDesign"</span>, <span class="st">"easystats"</span>, <span class="st">"zoo"</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="do">## Define a function to load (and if needed install) packages</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="co">#| label = "ipak"</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>ipak <span class="ot">&lt;-</span> <span class="cf">function</span>(pkg){</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>    new.pkg <span class="ot">&lt;-</span> pkg[<span class="sc">!</span>(pkg <span class="sc">%in%</span> <span class="fu">installed.packages</span>()[, <span class="st">"Package"</span>])]</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">length</span>(new.pkg)) </span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>        <span class="fu">install.packages</span>(new.pkg, <span class="at">dependencies =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sapply</span>(pkg, require, <span class="at">character.only =</span> <span class="cn">TRUE</span>)</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a><span class="do">## Install (if needed) and load libraries in the_packages</span></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a><span class="fu">ipak</span>(the_packages)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   kableExtra            DT        texreg     htmltools     tidyverse 
         TRUE          TRUE          TRUE          TRUE          TRUE 
    lubridate       forcats         haven      labelled         ggmap 
         TRUE          TRUE          TRUE          TRUE          TRUE 
      ggrepel      ggridges      ggthemes        ggpubr        GGally 
         TRUE          TRUE          TRUE          TRUE          TRUE 
       scales       dagitty         ggdag       ggforce       COVID19 
         TRUE          TRUE          TRUE          TRUE          TRUE 
         maps       mapdata           qss    tidycensus     dataverse 
         TRUE          TRUE          TRUE          TRUE          TRUE 
DeclareDesign     easystats           zoo 
         TRUE          TRUE          TRUE </code></pre>
</div>
</div>
</section>
<section id="feedback" class="level2 center">
<h2 class="center anchored" data-anchor-id="feedback">Feedback</h2>
</section>
<section id="what-did-we-like" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="what-did-we-like">What did we like</h2>
<div class="cell">
<div class="cell-output-display">
<div id="htmlwidget-9c12566c1e4039f48548" style="width:100%;height:90%;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-9c12566c1e4039f48548">{"x":{"filter":"none","vertical":false,"fillContainer":false,"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24"],["I like the way I'm learning how to code. The process itself--the readings, then lecture, then lab, etc--has been very helpful in making the material stick.","I've enjoyed making graphs and messing with colors","I found working with a group to be very rewarding and i have enjoyed being able to do that, especially while working through tougher tasks in a lab.","I have truly enjoyed learning R. It has been useful in projects in some of my other classes already!","Being able to turn statistical information into visuals has been fun\n","I like when I can recognize a problem and find a solution without outside help.","I liked being able to add to the plots and kind of make it our own.","Learning coding by replicating research has been a challenging and fun approach","I appreciate going through the coding in class.","Linear regression","I'm finding all of the skills we're learning to be really useful. I'm enjoying the labs and getting to apply the new coding we learn at the beginning of the week.","I enjoyed doing the labs up until question 6.","I like doing the labs individually and then together.","I've enjoyed making models and seeing data.","I find R to be a useful tool. A bit tricky at times, sometimes very finicky, but useful","I've heard people talk about linear regressions a bunch but never knew what they were so it's nice to finally know what they do/mean!\n","I enjoyed the lab this week","I have liked the course so far. I particularly appreciate how low-stress you make the class feel. Even though I am sometimes confused, I never feel like I need to stress about my grade just about learning for my own sake. The Week 6 lab was both useful and fun.","I think professor Testa is a very charismatic person, making the process of learning R code more fun!","Despite being a 9 a.m. class, I am always welcomed with excitement and camaraderie that contributes to my overall engagement and participation in the course.","","I like how we get to collaborate. I'm not skilled with coding or technology in general, but my group members have been very helpful.","I always enjoy the times where we take a minute to draw larger real-world implications from the data, it grounds the work we're doing and makes all those functions seem less complicated","Today's lab was fun. I appreciate the break down of the regressions and the repetitive use of the functions helped solidify their purpose for me."]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>Likes<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"columnDefs":[{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"Likes","targets":1}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
<section id="what-did-we-dislike" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="what-did-we-dislike">What did we dislike</h2>
<div class="cell">
<div class="cell-output-display">
<div id="htmlwidget-eca07b259a2dcace9f7c" style="width:100%;height:90%;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-eca07b259a2dcace9f7c">{"x":{"filter":"none","vertical":false,"fillContainer":false,"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24"],["I keep forgetting to do the survey.","Labs are a lot of copy/paste, which is easier but would be good to learn to write some code","I've had a hard time figuring out my set up and keeping up with the pace of the class.","It is completely understandable that the nature of the course's material requires that we move slow and ensure that everyone is keeping with the pace of the class. It is frustrating for me sometimes that we cannot continue moving at the pace intended for the course but that is more of a structural issue that is very hard to fix. Thank you for doing everything that you have to make sure that no one gets left behind!","There is too much material scheduled for each class. In lectures, we end up skipping over slides, and the labs can't be finished during class time. This is only a major issue since the lab is only submitted by one person. That means you need to coordinate with the others outside of class to make sure everything is right, which just adds time and stress. \n","The lab questions still feel very unclear as to what they're getting at. I think when we've discussion linear regressions very little asking to interpret coefficients is hard because we didn't spend enough time going over it in class.","The specificity of the code and how it can be different every time.","","I'm a bit frustrated because I don't feel like we've learned enough actual skills with the data. I appreciate going through the information together but don't feel like I'm getting a lot out of the labs even though I'm trying. It's also hard only having one TA for a coding-based class.","Also, linear regression","It seems like my group members are pretty consistently unprepared, which can be frustrating.","The concepts starting from 7 was a bit less clearer for me even when reading the textbook so I would like to go over the concepts a bit more","I find it confusing how much explanation and words are in the labs it can be confusing to keep my place in it","All is going well so far. Writing code is still hard, but copy/paste is manageable.","In the same vein, R. It can be infuriating, annoying, and difficult to learn","My group members have been looking at the solutions during class when we do the lab, so they're always super far ahead and I get stressed that I can't talk about the coding with my group. I want to try and figure it out my self so I can actually learn but they just want to get the lab done as quickly as possible.","","The early labs were way to long. I think the week 6 lab was the perfect length. I think focusing on fewer concepts and breaking them down is much easier than trying to do anything. Like I feel like I understand how to make a linear regression much better than I did some other stuff.","I find it too long sometimes when we are working individually(or as a group) on coding because there are often errors that prevent me or my group members to advance in the code.","I feel like I haven't gained much practical R skills. I think if there were more variety in the data we are analyzing, this would allow me to think about R in different ways. If there is any possibility of analyzing data other than those from Covid, I think this would help with overall engagement.","","","While we do have very accessible content like tutorials and readings it's still hard to remember all the content sometimes","It's just very difficult to focus on the material when an error comes up and suddenly you're behind."]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>Dislikes<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"columnDefs":[{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"Dislikes","targets":1}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
<section id="what-were-good-at" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="what-were-good-at">What we’re good at</h2>
<div class="cell">
<div class="cell-output-display">
<div id="htmlwidget-dfe17e5dfcff3518cdc6" style="width:100%;height:90%;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-dfe17e5dfcff3518cdc6">{"x":{"filter":"none","vertical":false,"fillContainer":false,"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24"],["Making the graphs/plots and staying organized.","Follow directions","I do well in checking back my code to problem solve and see where I may have gone wrong/","I have gotten very good at understanding the tools to wrangle data. After working on the lab today after class I also feel much more confident with data visualization. I feel that I have a strong understanding of all the material covered in the class to date.","Play around with the themes to get the best dark mode. And maybe use the mutate and filter functions","I've gotten better at looking at past code used for help and intuitively being able to adapt it for other uses.","Set it up","","I can make a box (command option i) :)","Loading packages","Create vectors and load data","figuring out what to add/modify existing code to get results that I want","I really like linear regression so far","Follow directions","Plots!","Linear regressions\n","ggplot","I think I know how to make a linear regression, and I think I at least somewhat know how to do a high level overview.","Now I can interpret the linear regression models!","manipulating the data","","Nothing really. I'm getting better, though","summaries and dims","I'm good at recognizing errors and generally don't make small mistakes."]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>code_skills<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"columnDefs":[{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"code_skills","targets":1}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
<section id="what-were-working-on" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="what-were-working-on">What we’re working on</h2>
<div class="cell">
<div class="cell-output-display">
<div id="htmlwidget-76042f30c51208fb2c02" style="width:100%;height:90%;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-76042f30c51208fb2c02">{"x":{"filter":"none","vertical":false,"fillContainer":false,"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24"],["I wish I could understand the tutorials better.","Understand what the code itself actually does","Learning what I'm doing while coding and understanding why I am coding.","Nothing as of yet! I have interests about more detailed applications of the tools that we have been using but I am perfectly fine with doing that on my own so we can focus on the foundational tools in class.","Often, I understand the code that you run or provide. I just wish that without provided code or prompts, I would be able to come up with the idea of what is needed.","I wish I understood the best strategy for problem solving when I feel completely lost on how to write code that will do what I need it to.","How to mutate the data to present what we want. Also the connections between the stats concepts and the coding.","","I just wish we could get a higher level understanding of when to use these more complex formulas.","syntax","Linear regressions","the lm stuff is very foreign to me, would like to go over the concepts through explanation of words","I wish I understood how to make graphs better","What the pipe symbol does, as well as how regression models work","Linear Regression","What the beta values mean. Still a little unclear on coefficients.","","I think my main thing is just understanding where to go when I am given the taste. Like it still difficult for me when given a prompt to say \"This is what I need to do\" without some prompting.","it would be nice to delve into what the square root of R and the other indicators below the coefficients mean","knowing how to do stuff more intuitively and fluently","I wish I had a theoretical understanding of the math behind the functions we've learned so I could analyze the results more sufficiently. Without a theoretical understanding, I wonder if my future research will hold up to scrutiny or if I will struggle to create the best-fitting model for a given regression.","How to interpret data. I usually find the numbers in the output confusing.","Just general syntax and how to be more fluid with it, know how to apply it more automatically","I wish I was able to recall functions better."]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>code_challenge<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"columnDefs":[{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"code_challenge","targets":1}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
<section id="how-are-we-doing" class="level2">
<h2 class="anchored" data-anchor-id="how-are-we-doing">How are we doing?</h2>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="07-slides_files/figure-revealjs/howwedoing-1.png" class="img-fluid figure-img" width="960"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="dont-trust-the-polls" class="level2">
<h2 class="anchored" data-anchor-id="dont-trust-the-polls">Don’t trust the polls</h2>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="07-slides_files/figure-revealjs/figtrump-1.png" class="img-fluid figure-img" width="960"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="section" class="level2">
<h2 class="anchored" data-anchor-id="section"></h2>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="07-slides_files/figure-revealjs/unnamed-chunk-10-1.png" class="img-fluid figure-img" width="960"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="what-should-we-do-going-forward" class="level2">
<h2 class="anchored" data-anchor-id="what-should-we-do-going-forward">What should we do going forward?</h2>
<ul>
<li>From me:
<ul>
<li>Shorter labs</li>
<li>Shorter slides</li>
<li>More coding, less copy-pasting</li>
</ul></li>
<li>From you?</li>
</ul>
</section>
</section>
<section id="what-does-it-mean-to-control-for-x" class="level1 inverse">
<h1 class="inverse"><i class="fa-solid fa-lightbulb" aria-label="lightbulb"></i> What does it mean to “control for X”</h1>
<section id="regression-models-partition-variance" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="regression-models-partition-variance">Regression models partition variance</h2>
<p>Regression models <span class="blue">partition variance</span>, separating the <span class="blue">variation in the outcome</span> <strong>into</strong> <span class="blue">variation explained by the predictors</span> in our model and the <span class="blue">remaining variation not explained</span> by these predictors</p>
<p><span class="math display">\[\begin{aligned}
\textrm{Total Variance} &amp;= \textrm{Variance Explained by Model} + \textrm{Unexplained Variance} \\
\textrm{Observed} &amp;= \textrm{Predicted Value} + \textrm{Error}\\
\textrm{Y} &amp;=  E[Y|X] + \epsilon\\
\textrm{Y} &amp;=  X\hat{\beta} + \hat{\epsilon}\\
\textrm{Y} &amp;= \hat{Y} + \hat{\epsilon}
\end{aligned}\]</span></p>
</section>
<section id="section-1" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="section-1"></h2>
<section id="coefficients-describe-the-unique-variance-in-y-explained-by-x-and-only-x" class="level4">
<h4 class="anchored" data-anchor-id="coefficients-describe-the-unique-variance-in-y-explained-by-x-and-only-x">Coefficients describe the unique variance in Y explained by X (and only X)</h4>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-1-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-1" role="tab" aria-controls="tabset-1-1" aria-selected="true">Task</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-2" role="tab" aria-controls="tabset-1-2" aria-selected="false"><i class="fa-solid fa-code" aria-label="code"></i></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-1-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-1-3" role="tab" aria-controls="tabset-1-3" aria-selected="false"><i class="fa-solid fa-table" aria-label="table"></i></a></li></ul>
<div class="tab-content">
<div id="tabset-1-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-1-1-tab">
<p>The coefficients in a regression model describe the variation in the outcome explained by that predictor, and only that predictor.</p>
<p>Let’s fit three models from last week’s lab and look at how the coefficients change from model to model</p>
</div>
<div id="tabset-1-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="fu">url</span>(<span class="st">"https://pols1600.paultesta.org/files/data/06_lab.rda"</span>))</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>m1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(new_deaths_pc_14day <span class="sc">~</span> rep_voteshare_std, covid_lab)</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>m2 <span class="ot">&lt;-</span> <span class="fu">lm</span>(new_deaths_pc_14day <span class="sc">~</span> rep_voteshare_std <span class="sc">+</span> med_age_std, covid_lab)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>m3 <span class="ot">&lt;-</span> <span class="fu">lm</span>(new_deaths_pc_14day <span class="sc">~</span> rep_voteshare_std <span class="sc">+</span> med_age_std <span class="sc">+</span> med_income_std, covid_lab)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-1-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-1-3-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">htmlreg</span>(<span class="fu">list</span>(m1, m2, m3)) <span class="sc">%&gt;%</span> <span class="fu">HTML</span>() <span class="sc">%&gt;%</span> <span class="fu">browsable</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<table class="texreg table table-sm table-striped small" data-quarto-postprocess="true">
<caption>Statistical models</caption>
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th" style="padding-left: 5px; padding-right: 5px">&nbsp;</th>
<th data-quarto-table-cell-role="th" style="padding-left: 5px; padding-right: 5px">Model 1</th>
<th data-quarto-table-cell-role="th" style="padding-left: 5px; padding-right: 5px">Model 2</th>
<th data-quarto-table-cell-role="th" style="padding-left: 5px; padding-right: 5px">Model 3</th>
</tr>
</thead>
<tbody>
<tr class="odd" style="border-top: 1px solid #000000;">
<td style="padding-left: 5px; padding-right: 5px">(Intercept)</td>
<td style="padding-left: 5px; padding-right: 5px">0.57<sup>***</sup></td>
<td style="padding-left: 5px; padding-right: 5px">0.57<sup>***</sup></td>
<td style="padding-left: 5px; padding-right: 5px">0.57<sup>***</sup></td>
</tr>
<tr class="even">
<td style="padding-left: 5px; padding-right: 5px">&nbsp;</td>
<td style="padding-left: 5px; padding-right: 5px">(0.05)</td>
<td style="padding-left: 5px; padding-right: 5px">(0.05)</td>
<td style="padding-left: 5px; padding-right: 5px">(0.04)</td>
</tr>
<tr class="odd">
<td style="padding-left: 5px; padding-right: 5px">rep_voteshare_std</td>
<td style="padding-left: 5px; padding-right: 5px">0.23<sup>***</sup></td>
<td style="padding-left: 5px; padding-right: 5px">0.23<sup>***</sup></td>
<td style="padding-left: 5px; padding-right: 5px">0.07</td>
</tr>
<tr class="even">
<td style="padding-left: 5px; padding-right: 5px">&nbsp;</td>
<td style="padding-left: 5px; padding-right: 5px">(0.05)</td>
<td style="padding-left: 5px; padding-right: 5px">(0.05)</td>
<td style="padding-left: 5px; padding-right: 5px">(0.07)</td>
</tr>
<tr class="odd">
<td style="padding-left: 5px; padding-right: 5px">med_age_std</td>
<td style="padding-left: 5px; padding-right: 5px">&nbsp;</td>
<td style="padding-left: 5px; padding-right: 5px">0.03</td>
<td style="padding-left: 5px; padding-right: 5px">-0.02</td>
</tr>
<tr class="even">
<td style="padding-left: 5px; padding-right: 5px">&nbsp;</td>
<td style="padding-left: 5px; padding-right: 5px">&nbsp;</td>
<td style="padding-left: 5px; padding-right: 5px">(0.05)</td>
<td style="padding-left: 5px; padding-right: 5px">(0.05)</td>
</tr>
<tr class="odd">
<td style="padding-left: 5px; padding-right: 5px">med_income_std</td>
<td style="padding-left: 5px; padding-right: 5px">&nbsp;</td>
<td style="padding-left: 5px; padding-right: 5px">&nbsp;</td>
<td style="padding-left: 5px; padding-right: 5px">-0.22<sup>**</sup></td>
</tr>
<tr class="even">
<td style="padding-left: 5px; padding-right: 5px">&nbsp;</td>
<td style="padding-left: 5px; padding-right: 5px">&nbsp;</td>
<td style="padding-left: 5px; padding-right: 5px">&nbsp;</td>
<td style="padding-left: 5px; padding-right: 5px">(0.07)</td>
</tr>
<tr class="odd" style="border-top: 1px solid #000000;">
<td style="padding-left: 5px; padding-right: 5px">R<sup>2</sup></td>
<td style="padding-left: 5px; padding-right: 5px">0.31</td>
<td style="padding-left: 5px; padding-right: 5px">0.31</td>
<td style="padding-left: 5px; padding-right: 5px">0.44</td>
</tr>
<tr class="even">
<td style="padding-left: 5px; padding-right: 5px">Adj. R<sup>2</sup></td>
<td style="padding-left: 5px; padding-right: 5px">0.29</td>
<td style="padding-left: 5px; padding-right: 5px">0.28</td>
<td style="padding-left: 5px; padding-right: 5px">0.40</td>
</tr>
<tr class="odd" style="border-bottom: 2px solid #000000;">
<td style="padding-left: 5px; padding-right: 5px">Num. obs.</td>
<td style="padding-left: 5px; padding-right: 5px">51</td>
<td style="padding-left: 5px; padding-right: 5px">51</td>
<td style="padding-left: 5px; padding-right: 5px">51</td>
</tr>
</tbody><tfoot>
<tr class="even">
<td colspan="4" style="font-size: 0.8em"><sup>***</sup>p &lt; 0.001; <sup>**</sup>p &lt; 0.01; <sup>*</sup>p &lt; 0.05</td>
</tr>
</tfoot>

</table>


</div>
</div>
</div>
</div>
</div>
</section>
</section>
<section id="why-do-coefficients-change-when-we-control-for-variables" class="level2 center">
<h2 class="center anchored" data-anchor-id="why-do-coefficients-change-when-we-control-for-variables">Why do coefficients change when we control for variables?</h2>
</section>
<section id="residualized-regression" class="level2">
<h2 class="anchored" data-anchor-id="residualized-regression">Residualized Regression</h2>
<p>Residualized regression is way of understanding what it means to <span class="blue">control for variables</span> in a regression.</p>
<p>Residualized regression provides a way of illustrating what we mean when say the coefficients describe the unique variance in Y explained by some predictor <span class="math inline">\(x\)</span> (and only <span class="math inline">\(x\)</span>)</p>
</section>
<section id="whats-a-residual" class="level2">
<h2 class="anchored" data-anchor-id="whats-a-residual">What’s a residual</h2>
<ul>
<li><span class="blue">Residuals</span> represent the part of the outcome variable, <span class="blue">not explained</span> by the predictors in a model
<ul>
<li>Difference between the observed <span class="math inline">\(y\)</span> and the predicted <span class="math inline">\(\hat{y}\)</span></li>
</ul></li>
</ul>
<p><span class="math display">\[y = \overbrace{\beta_0 + \beta_1x_1 + \beta_2 x_2  + \dots \beta_j x_j}^{\text{Predictors}} + \underbrace{\epsilon}_{\text{Residuals}}\]</span></p>
</section>
<section id="residuals-are-uncorrelated-with-x-and-haty" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="residuals-are-uncorrelated-with-x-and-haty">Residuals are uncorrelated with <span class="math inline">\(X\)</span> and <span class="math inline">\(\hat{y}\)</span></h2>
<div class="columns">
<div class="column" style="width:40%;">
<p>Residuals are uncorrelated with (orthogonal to) the predictors <span class="math inline">\(X\)</span>, and predicted values <span class="math inline">\(X\beta\)</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Trust but verify</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cor</span>(<span class="fu">resid</span>(m2),covid_lab<span class="sc">$</span>rep_voteshare_std) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 3.600777e-17</code></pre>
</div>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cor</span>(<span class="fu">resid</span>(m2),covid_lab<span class="sc">$</span>med_age_std)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 7.021125e-17</code></pre>
</div>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cor</span>(<span class="fu">resid</span>(m2),<span class="fu">fitted</span>(m2))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -1.036606e-17</code></pre>
</div>
</div>
</div><div class="column" style="width:55%;">
<p><img src="https://i.stack.imgur.com/UEOIP.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="section-4" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="section-4"></h2>
<section id="residualized-regression-1" class="level4">
<h4 class="anchored" data-anchor-id="residualized-regression-1">Residualized Regression</h4>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-2-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-1" role="tab" aria-controls="tabset-2-1" aria-selected="true"><i class="fa-solid fa-lightbulb" aria-label="lightbulb"></i></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-2" role="tab" aria-controls="tabset-2-2" aria-selected="false"><i class="fa-solid fa-code" aria-label="code"></i> m2</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-2-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-2-3" role="tab" aria-controls="tabset-2-3" aria-selected="false"><i class="fa-solid fa-code" aria-label="code"></i> m3</a></li></ul>
<div class="tab-content">
<div id="tabset-2-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-2-1-tab">
<div class="nonincremental">
<p>For a model like <code>m2</code> we can recover the coefficient on <code>rep_voteshare_std</code> by:</p>
<ol type="1">
<li>Regressing <code>new_deaths_pc_14day</code> on <code>med_age_std</code> to get the <span class="blue">residual</span> variation in Covid-19 deaths <span class="blue">not explained</span> by median age</li>
<li>Regressing <code>rep_voteshare_std</code> on <code>med_age_std</code> to get the <span class="blue">residual</span> variation in Republican Vote Share <span class="blue">not explained</span> by median age</li>
<li>Regressing the residuals from 1. (Deaths not explained by age) on the residuals from 2. (Vote share not explained by age) to obtain the <span class="blue">same</span> coefficient from <code>m2</code> for <code>rep_voteshare_std</code></li>
</ol>
<p>The same principle holds for <code>m3</code></p>
</div>
</div>
<div id="tabset-2-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Regressing `new_deaths_pc_14da` on `med_age_std`</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>m2_death_by_age <span class="ot">&lt;-</span> <span class="fu">lm</span>(new_deaths_pc_14day <span class="sc">~</span> med_age_std, covid_lab)</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Save residuals</span></span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>covid_lab<span class="sc">$</span>res_death_no_age <span class="ot">&lt;-</span> <span class="fu">resid</span>(m2_death_by_age)</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Regressing `rep_voteshare_std` on `med_age_std` </span></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>m2_repvs_by_age <span class="ot">&lt;-</span> <span class="fu">lm</span>(rep_voteshare_std <span class="sc">~</span> med_age_std, covid_lab)</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Save residuals</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>covid_lab<span class="sc">$</span>res_repvs_no_age <span class="ot">&lt;-</span> <span class="fu">resid</span>(m2_repvs_by_age)</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Residualized regression of deaths on Rep Vote Share</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>m2_res <span class="ot">&lt;-</span> <span class="fu">lm</span>(res_death_no_age <span class="sc">~</span> res_repvs_no_age, covid_lab)</span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Mutliple regression</span></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(m2)[<span class="dv">2</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>rep_voteshare_std 
         0.230745 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Residualized regression</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(m2_res)[<span class="dv">2</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>res_repvs_no_age 
        0.230745 </code></pre>
</div>
</div>
</div>
<div id="tabset-2-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-2-3-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. Regressing `new_deaths_pc_14da` on `med_age_std` and med_income_std</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>m3_death_by_age_income <span class="ot">&lt;-</span> <span class="fu">lm</span>(new_deaths_pc_14day <span class="sc">~</span> med_age_std <span class="sc">+</span> med_income_std, covid_lab)</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Save residuals</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>covid_lab<span class="sc">$</span>res_death_no_age_income <span class="ot">&lt;-</span> <span class="fu">resid</span>(m3_death_by_age_income)</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Regressing `rep_voteshare_std` on `med_age_std` and med_income_std</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>m3_repvs_by_age_income <span class="ot">&lt;-</span> <span class="fu">lm</span>(rep_voteshare_std <span class="sc">~</span> med_age_std <span class="sc">+</span> med_income_std, covid_lab)</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Save residuals</span></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>covid_lab<span class="sc">$</span>res_repvs_no_age_income <span class="ot">&lt;-</span> <span class="fu">resid</span>(m3_repvs_by_age_income)</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Residualized regression of deaths on Rep Vote Share</span></span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>m3_res <span class="ot">&lt;-</span> <span class="fu">lm</span>(res_death_no_age_income <span class="sc">~</span> res_repvs_no_age_income, covid_lab)</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a><span class="co"># multiple regression coefficient</span></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(m3)[<span class="dv">2</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>rep_voteshare_std 
       0.07140446 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Same as  residualized regression coefficient</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(m3_res)[<span class="dv">2</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>res_repvs_no_age_income 
             0.07140446 </code></pre>
</div>
</div>
</div>
</div>
</div>
</section>
</section>
<section id="why-did-the-coefficient-on-rep-vote-share-change-in-m3-but-not-m2" class="level2 center">
<h2 class="center anchored" data-anchor-id="why-did-the-coefficient-on-rep-vote-share-change-in-m3-but-not-m2">Why did the coefficient on Rep Vote Share change in <code>m3</code> but not <code>m2</code>?</h2>
</section>
<section id="section-6" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="section-6"></h2>
</section>
<section id="section-7" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="section-7"></h2>
<div class="cell">
<div class="cell-output-display">
<table class="texreg table table-sm table-striped small" data-quarto-postprocess="true">
<caption>Statistical models</caption>
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">&nbsp;</th>
<th data-quarto-table-cell-role="th" style="padding-left: 5px; padding-right: 5px; border-bottom: 1px solid #000000">DV: Death</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th" style="padding-left: 5px; padding-right: 5px">&nbsp;</th>
<th data-quarto-table-cell-role="th" style="padding-left: 5px; padding-right: 5px">Baseline</th>
</tr>
</thead>
<tbody>
<tr class="odd" style="border-top: 1px solid #000000;">
<td style="padding-left: 5px; padding-right: 5px">(Intercept)</td>
<td style="padding-left: 5px; padding-right: 5px">0.57<sup>***</sup></td>
</tr>
<tr class="even">
<td style="padding-left: 5px; padding-right: 5px">&nbsp;</td>
<td style="padding-left: 5px; padding-right: 5px">(0.05)</td>
</tr>
<tr class="odd">
<td style="padding-left: 5px; padding-right: 5px">rep_voteshare_std</td>
<td style="padding-left: 5px; padding-right: 5px">0.23<sup>***</sup></td>
</tr>
<tr class="even">
<td style="padding-left: 5px; padding-right: 5px">&nbsp;</td>
<td style="padding-left: 5px; padding-right: 5px">(0.05)</td>
</tr>
<tr class="odd" style="border-top: 1px solid #000000;">
<td style="padding-left: 5px; padding-right: 5px">R<sup>2</sup></td>
<td style="padding-left: 5px; padding-right: 5px">0.31</td>
</tr>
<tr class="even">
<td style="padding-left: 5px; padding-right: 5px">Adj. R<sup>2</sup></td>
<td style="padding-left: 5px; padding-right: 5px">0.29</td>
</tr>
<tr class="odd" style="border-bottom: 2px solid #000000;">
<td style="padding-left: 5px; padding-right: 5px">Num. obs.</td>
<td style="padding-left: 5px; padding-right: 5px">51</td>
</tr>
</tbody><tfoot>
<tr class="odd">
<td colspan="2" style="font-size: 0.8em"><sup>***</sup>p &lt; 0.001; <sup>**</sup>p &lt; 0.01; <sup>*</sup>p &lt; 0.05</td>
</tr>
</tfoot>

</table>


</div>
</div>
</section>
<section id="section-8" class="level2">
<h2 class="anchored" data-anchor-id="section-8"></h2>
<p><span class="math display">\[
\text{Covid-19 Deaths} = \beta_0 + \beta_1 \text{Rep Vote Share}
\]</span></p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="07-slides_files/figure-revealjs/venn_iv1-1.png" class="img-fluid figure-img" width="960"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="section-9" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="section-9"></h2>
<div class="cell">
<div class="cell-output-display">
<table class="texreg table table-sm table-striped small" data-quarto-postprocess="true">
<caption>Statistical models</caption>
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">&nbsp;</th>
<th colspan="3" data-quarto-table-cell-role="th" style="padding-left: 5px; padding-right: 5px; border-bottom: 1px solid #000000">DV: Death</th>
<th data-quarto-table-cell-role="th" style="padding-left: 5px; padding-right: 5px; border-bottom: 1px solid #000000">DV: Vote Share</th>
<th data-quarto-table-cell-role="th" style="padding-left: 5px; padding-right: 5px; border-bottom: 1px solid #000000">DV: Res. Deaths</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th" style="padding-left: 5px; padding-right: 5px">&nbsp;</th>
<th data-quarto-table-cell-role="th" style="padding-left: 5px; padding-right: 5px">Baseline</th>
<th data-quarto-table-cell-role="th" style="padding-left: 5px; padding-right: 5px">Mutliple</th>
<th data-quarto-table-cell-role="th" style="padding-left: 5px; padding-right: 5px">Deaths</th>
<th data-quarto-table-cell-role="th" style="padding-left: 5px; padding-right: 5px">Vote Share</th>
<th data-quarto-table-cell-role="th" style="padding-left: 5px; padding-right: 5px">Deaths</th>
</tr>
</thead>
<tbody>
<tr class="odd" style="border-top: 1px solid #000000;">
<td style="padding-left: 5px; padding-right: 5px">(Intercept)</td>
<td style="padding-left: 5px; padding-right: 5px">0.57<sup>***</sup></td>
<td style="padding-left: 5px; padding-right: 5px">0.57<sup>***</sup></td>
<td style="padding-left: 5px; padding-right: 5px">0.57<sup>***</sup></td>
<td style="padding-left: 5px; padding-right: 5px">-0.00</td>
<td style="padding-left: 5px; padding-right: 5px">-0.00</td>
</tr>
<tr class="even">
<td style="padding-left: 5px; padding-right: 5px">&nbsp;</td>
<td style="padding-left: 5px; padding-right: 5px">(0.05)</td>
<td style="padding-left: 5px; padding-right: 5px">(0.05)</td>
<td style="padding-left: 5px; padding-right: 5px">(0.06)</td>
<td style="padding-left: 5px; padding-right: 5px">(0.14)</td>
<td style="padding-left: 5px; padding-right: 5px">(0.05)</td>
</tr>
<tr class="odd">
<td style="padding-left: 5px; padding-right: 5px">rep_voteshare_std</td>
<td style="padding-left: 5px; padding-right: 5px">0.23<sup>***</sup></td>
<td style="padding-left: 5px; padding-right: 5px">0.23<sup>***</sup></td>
<td style="padding-left: 5px; padding-right: 5px">&nbsp;</td>
<td style="padding-left: 5px; padding-right: 5px">&nbsp;</td>
<td style="padding-left: 5px; padding-right: 5px">&nbsp;</td>
</tr>
<tr class="even">
<td style="padding-left: 5px; padding-right: 5px">&nbsp;</td>
<td style="padding-left: 5px; padding-right: 5px">(0.05)</td>
<td style="padding-left: 5px; padding-right: 5px">(0.05)</td>
<td style="padding-left: 5px; padding-right: 5px">&nbsp;</td>
<td style="padding-left: 5px; padding-right: 5px">&nbsp;</td>
<td style="padding-left: 5px; padding-right: 5px">&nbsp;</td>
</tr>
<tr class="odd">
<td style="padding-left: 5px; padding-right: 5px">med_age_std</td>
<td style="padding-left: 5px; padding-right: 5px">&nbsp;</td>
<td style="padding-left: 5px; padding-right: 5px">0.03</td>
<td style="padding-left: 5px; padding-right: 5px">0.00</td>
<td style="padding-left: 5px; padding-right: 5px">-0.12</td>
<td style="padding-left: 5px; padding-right: 5px">&nbsp;</td>
</tr>
<tr class="even">
<td style="padding-left: 5px; padding-right: 5px">&nbsp;</td>
<td style="padding-left: 5px; padding-right: 5px">&nbsp;</td>
<td style="padding-left: 5px; padding-right: 5px">(0.05)</td>
<td style="padding-left: 5px; padding-right: 5px">(0.06)</td>
<td style="padding-left: 5px; padding-right: 5px">(0.14)</td>
<td style="padding-left: 5px; padding-right: 5px">&nbsp;</td>
</tr>
<tr class="odd">
<td style="padding-left: 5px; padding-right: 5px">res_repvs_no_age</td>
<td style="padding-left: 5px; padding-right: 5px">&nbsp;</td>
<td style="padding-left: 5px; padding-right: 5px">&nbsp;</td>
<td style="padding-left: 5px; padding-right: 5px">&nbsp;</td>
<td style="padding-left: 5px; padding-right: 5px">&nbsp;</td>
<td style="padding-left: 5px; padding-right: 5px">0.23<sup>***</sup></td>
</tr>
<tr class="even">
<td style="padding-left: 5px; padding-right: 5px">&nbsp;</td>
<td style="padding-left: 5px; padding-right: 5px">&nbsp;</td>
<td style="padding-left: 5px; padding-right: 5px">&nbsp;</td>
<td style="padding-left: 5px; padding-right: 5px">&nbsp;</td>
<td style="padding-left: 5px; padding-right: 5px">&nbsp;</td>
<td style="padding-left: 5px; padding-right: 5px">(0.05)</td>
</tr>
<tr class="odd" style="border-top: 1px solid #000000;">
<td style="padding-left: 5px; padding-right: 5px">R<sup>2</sup></td>
<td style="padding-left: 5px; padding-right: 5px">0.31</td>
<td style="padding-left: 5px; padding-right: 5px">0.31</td>
<td style="padding-left: 5px; padding-right: 5px">0.00</td>
<td style="padding-left: 5px; padding-right: 5px">0.02</td>
<td style="padding-left: 5px; padding-right: 5px">0.31</td>
</tr>
<tr class="even">
<td style="padding-left: 5px; padding-right: 5px">Adj. R<sup>2</sup></td>
<td style="padding-left: 5px; padding-right: 5px">0.29</td>
<td style="padding-left: 5px; padding-right: 5px">0.28</td>
<td style="padding-left: 5px; padding-right: 5px">-0.02</td>
<td style="padding-left: 5px; padding-right: 5px">-0.00</td>
<td style="padding-left: 5px; padding-right: 5px">0.30</td>
</tr>
<tr class="odd" style="border-bottom: 2px solid #000000;">
<td style="padding-left: 5px; padding-right: 5px">Num. obs.</td>
<td style="padding-left: 5px; padding-right: 5px">51</td>
<td style="padding-left: 5px; padding-right: 5px">51</td>
<td style="padding-left: 5px; padding-right: 5px">51</td>
<td style="padding-left: 5px; padding-right: 5px">51</td>
<td style="padding-left: 5px; padding-right: 5px">51</td>
</tr>
</tbody><tfoot>
<tr class="odd">
<td colspan="6" style="font-size: 0.8em"><sup>***</sup>p &lt; 0.001; <sup>**</sup>p &lt; 0.01; <sup>*</sup>p &lt; 0.05</td>
</tr>
</tfoot>

</table>


</div>
</div>
</section>
<section id="section-10" class="level2">
<h2 class="anchored" data-anchor-id="section-10"></h2>
<p><span class="math display">\[
\text{Deaths} = \beta_0 + \beta_1 \text{Rep VS} + \beta_2 \text{Age}
\]</span></p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="07-slides_files/figure-revealjs/venn_iv2-1.png" class="img-fluid figure-img" width="960"></p>
</figure>
</div>
</div>
</div>
<p><span class="math inline">\(\beta_1\)</span> doesn’t change because <code>age</code> has no relationship to <code>deaths</code> in these data</p>
</section>
<section id="section-11" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="section-11"></h2>
<div class="cell">
<div class="cell-output-display">
<table class="texreg table table-sm table-striped small" data-quarto-postprocess="true">
<caption>Statistical models</caption>
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">&nbsp;</th>
<th colspan="3" data-quarto-table-cell-role="th" style="padding-left: 5px; padding-right: 5px; border-bottom: 1px solid #000000">DV: Death</th>
<th data-quarto-table-cell-role="th" style="padding-left: 5px; padding-right: 5px; border-bottom: 1px solid #000000">DV: Vote Share</th>
<th data-quarto-table-cell-role="th" style="padding-left: 5px; padding-right: 5px; border-bottom: 1px solid #000000">DV: Res. Death</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th" style="padding-left: 5px; padding-right: 5px">&nbsp;</th>
<th data-quarto-table-cell-role="th" style="padding-left: 5px; padding-right: 5px">Baseline</th>
<th data-quarto-table-cell-role="th" style="padding-left: 5px; padding-right: 5px">Mutliple</th>
<th data-quarto-table-cell-role="th" style="padding-left: 5px; padding-right: 5px">Deaths</th>
<th data-quarto-table-cell-role="th" style="padding-left: 5px; padding-right: 5px">Vote Share</th>
<th data-quarto-table-cell-role="th" style="padding-left: 5px; padding-right: 5px">Deaths</th>
</tr>
</thead>
<tbody>
<tr class="odd" style="border-top: 1px solid #000000;">
<td style="padding-left: 5px; padding-right: 5px">(Intercept)</td>
<td style="padding-left: 5px; padding-right: 5px">0.57<sup>***</sup></td>
<td style="padding-left: 5px; padding-right: 5px">0.57<sup>***</sup></td>
<td style="padding-left: 5px; padding-right: 5px">0.57<sup>***</sup></td>
<td style="padding-left: 5px; padding-right: 5px">-0.00</td>
<td style="padding-left: 5px; padding-right: 5px">0.00</td>
</tr>
<tr class="even">
<td style="padding-left: 5px; padding-right: 5px">&nbsp;</td>
<td style="padding-left: 5px; padding-right: 5px">(0.05)</td>
<td style="padding-left: 5px; padding-right: 5px">(0.04)</td>
<td style="padding-left: 5px; padding-right: 5px">(0.04)</td>
<td style="padding-left: 5px; padding-right: 5px">(0.10)</td>
<td style="padding-left: 5px; padding-right: 5px">(0.04)</td>
</tr>
<tr class="odd">
<td style="padding-left: 5px; padding-right: 5px">rep_voteshare_std</td>
<td style="padding-left: 5px; padding-right: 5px">0.23<sup>***</sup></td>
<td style="padding-left: 5px; padding-right: 5px">0.07</td>
<td style="padding-left: 5px; padding-right: 5px">&nbsp;</td>
<td style="padding-left: 5px; padding-right: 5px">&nbsp;</td>
<td style="padding-left: 5px; padding-right: 5px">&nbsp;</td>
</tr>
<tr class="even">
<td style="padding-left: 5px; padding-right: 5px">&nbsp;</td>
<td style="padding-left: 5px; padding-right: 5px">(0.05)</td>
<td style="padding-left: 5px; padding-right: 5px">(0.07)</td>
<td style="padding-left: 5px; padding-right: 5px">&nbsp;</td>
<td style="padding-left: 5px; padding-right: 5px">&nbsp;</td>
<td style="padding-left: 5px; padding-right: 5px">&nbsp;</td>
</tr>
<tr class="odd">
<td style="padding-left: 5px; padding-right: 5px">med_age_std</td>
<td style="padding-left: 5px; padding-right: 5px">&nbsp;</td>
<td style="padding-left: 5px; padding-right: 5px">-0.02</td>
<td style="padding-left: 5px; padding-right: 5px">-0.03</td>
<td style="padding-left: 5px; padding-right: 5px">-0.22<sup>*</sup></td>
<td style="padding-left: 5px; padding-right: 5px">&nbsp;</td>
</tr>
<tr class="even">
<td style="padding-left: 5px; padding-right: 5px">&nbsp;</td>
<td style="padding-left: 5px; padding-right: 5px">&nbsp;</td>
<td style="padding-left: 5px; padding-right: 5px">(0.05)</td>
<td style="padding-left: 5px; padding-right: 5px">(0.05)</td>
<td style="padding-left: 5px; padding-right: 5px">(0.10)</td>
<td style="padding-left: 5px; padding-right: 5px">&nbsp;</td>
</tr>
<tr class="odd">
<td style="padding-left: 5px; padding-right: 5px">med_income_std</td>
<td style="padding-left: 5px; padding-right: 5px">&nbsp;</td>
<td style="padding-left: 5px; padding-right: 5px">-0.22<sup>**</sup></td>
<td style="padding-left: 5px; padding-right: 5px">-0.27<sup>***</sup></td>
<td style="padding-left: 5px; padding-right: 5px">-0.74<sup>***</sup></td>
<td style="padding-left: 5px; padding-right: 5px">&nbsp;</td>
</tr>
<tr class="even">
<td style="padding-left: 5px; padding-right: 5px">&nbsp;</td>
<td style="padding-left: 5px; padding-right: 5px">&nbsp;</td>
<td style="padding-left: 5px; padding-right: 5px">(0.07)</td>
<td style="padding-left: 5px; padding-right: 5px">(0.05)</td>
<td style="padding-left: 5px; padding-right: 5px">(0.10)</td>
<td style="padding-left: 5px; padding-right: 5px">&nbsp;</td>
</tr>
<tr class="odd">
<td style="padding-left: 5px; padding-right: 5px">res_repvs_no_age_income</td>
<td style="padding-left: 5px; padding-right: 5px">&nbsp;</td>
<td style="padding-left: 5px; padding-right: 5px">&nbsp;</td>
<td style="padding-left: 5px; padding-right: 5px">&nbsp;</td>
<td style="padding-left: 5px; padding-right: 5px">&nbsp;</td>
<td style="padding-left: 5px; padding-right: 5px">0.07</td>
</tr>
<tr class="even">
<td style="padding-left: 5px; padding-right: 5px">&nbsp;</td>
<td style="padding-left: 5px; padding-right: 5px">&nbsp;</td>
<td style="padding-left: 5px; padding-right: 5px">&nbsp;</td>
<td style="padding-left: 5px; padding-right: 5px">&nbsp;</td>
<td style="padding-left: 5px; padding-right: 5px">&nbsp;</td>
<td style="padding-left: 5px; padding-right: 5px">(0.07)</td>
</tr>
<tr class="odd" style="border-top: 1px solid #000000;">
<td style="padding-left: 5px; padding-right: 5px">R<sup>2</sup></td>
<td style="padding-left: 5px; padding-right: 5px">0.31</td>
<td style="padding-left: 5px; padding-right: 5px">0.44</td>
<td style="padding-left: 5px; padding-right: 5px">0.43</td>
<td style="padding-left: 5px; padding-right: 5px">0.55</td>
<td style="padding-left: 5px; padding-right: 5px">0.02</td>
</tr>
<tr class="even">
<td style="padding-left: 5px; padding-right: 5px">Adj. R<sup>2</sup></td>
<td style="padding-left: 5px; padding-right: 5px">0.29</td>
<td style="padding-left: 5px; padding-right: 5px">0.40</td>
<td style="padding-left: 5px; padding-right: 5px">0.40</td>
<td style="padding-left: 5px; padding-right: 5px">0.53</td>
<td style="padding-left: 5px; padding-right: 5px">0.00</td>
</tr>
<tr class="odd" style="border-bottom: 2px solid #000000;">
<td style="padding-left: 5px; padding-right: 5px">Num. obs.</td>
<td style="padding-left: 5px; padding-right: 5px">51</td>
<td style="padding-left: 5px; padding-right: 5px">51</td>
<td style="padding-left: 5px; padding-right: 5px">51</td>
<td style="padding-left: 5px; padding-right: 5px">51</td>
<td style="padding-left: 5px; padding-right: 5px">51</td>
</tr>
</tbody><tfoot>
<tr class="odd">
<td colspan="6" style="font-size: 0.8em"><sup>***</sup>p &lt; 0.001; <sup>**</sup>p &lt; 0.01; <sup>*</sup>p &lt; 0.05</td>
</tr>
</tfoot>

</table>


</div>
</div>
</section>
<section id="section-12" class="level2">
<h2 class="anchored" data-anchor-id="section-12"></h2>
<p><span class="math display">\[
\text{Deaths} = \beta_0 + \beta_1 \text{Rep VS} + \beta_2 \text{Age} + \beta_3 \text{Income}
\]</span></p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="07-slides_files/figure-revealjs/venn_iv3-1.png" class="img-fluid figure-img" width="960"></p>
</figure>
</div>
</div>
</div>
<p><span class="math inline">\(\beta_1\)</span> decreases because after controlling for <code>income</code> there is less unique variation explained only by <code>republican vote share</code></p>
</section>
</section>
<section id="using-regression-to-make-predictions" class="level1 inverse">
<h1 class="inverse"><i class="fa-solid fa-lightbulb" aria-label="lightbulb"></i> Using regression to make predictions</h1>
<section id="using-regression-to-produce-predicted-values" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="using-regression-to-produce-predicted-values">Using regression to produce predicted values</h2>
<p>Coefficients in a regression define a formula which produces a predicted value of the outcome <span class="math inline">\(y\)</span> when the predictors <span class="math inline">\(X\)</span> take particular values.</p>
<p><span class="math display">\[
\begin{aligned}y &amp;= \overbrace{\beta_0 + \beta_1x_1 + \beta_2 x_2  + \dots \beta_j x_j}^{\text{Predictors}} + \underbrace{\epsilon}_{\text{Residuals}} &amp;\\
y &amp;= \beta_0 + \beta_1x_{rvs} + \beta_2x_{age}+ \beta_3x_{inc} + \epsilon &amp; \text{m3}\\
y &amp;= 0.56 + 0.07x_{rvs} - 0.02 x_{age} - 0.22 x_{inc} + \hat{\epsilon} &amp; \text{estimated m3}\\
y &amp;= 0.56 + 0.07(-0.87) - 0.02(0.62) - 0.22(0.38) + \hat{\epsilon} &amp; \text{prediction for RI} \\
\overbrace{0.22}^{\text{Observed}} &amp;= \underbrace{0.41}_{\text{Predicted}} + \overbrace{(-0.19)}^{\text{Residual}} &amp;
\end{aligned}
\]</span></p>
</section>
<section id="producing-predicted-values-in-r" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="producing-predicted-values-in-r">Producing Predicted Values in R</h2>
<p>The basic steps to producing predicted values in R as follows:</p>
<ul>
<li>Fit a model using <code>lm()</code></li>
<li>Create a <span class="blue">prediction data frame</span> using <code>expand_grid()</code>:
<ul>
<li>vary the values of the predictor you’re interested in</li>
<li>hold all the other predictors in your model constant at some typical value.</li>
</ul></li>
<li>Input the model from <code>lm()</code> and the <span class="blue">prediction data frame</span>, into the <code>predict()</code> function to obtain <span class="blue">predicted values</span>.
<ul>
<li>Save predictions as a new column in your <span class="blue">prediction data frame</span> (I generally call them <code>fit</code>)</li>
</ul></li>
<li>Plot predicted values in your <span class="blue">prediction data frame</span> to help interpret your model</li>
</ul>
</section>
<section id="section-13" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="section-13"></h2>
<section id="are-there-decreasing-returns-to-vaccination" class="level4">
<h4 class="anchored" data-anchor-id="are-there-decreasing-returns-to-vaccination">Are there decreasing returns to vaccination?</h4>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-3-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-1" role="tab" aria-controls="tabset-3-1" aria-selected="true">Task</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-2" role="tab" aria-controls="tabset-3-2" aria-selected="false"><i class="fa-solid fa-code" aria-label="code"></i> m4</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-3" role="tab" aria-controls="tabset-3-3" aria-selected="false"><i class="fa-solid fa-table" aria-label="table"></i> Table</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-4" role="tab" aria-controls="tabset-3-4" aria-selected="false"><i class="fa-solid fa-code" aria-label="code"></i> Predict</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-3-5-tab" data-bs-toggle="tab" data-bs-target="#tabset-3-5" role="tab" aria-controls="tabset-3-5" aria-selected="false"><i class="fa-solid fa-chart-line" aria-label="chart-line"></i> Fig</a></li></ul>
<div class="tab-content">
<div id="tabset-3-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-3-1-tab">
<p>Suppose we thought the <span class="blue">marginal effect</span> – (here, predicted change in deaths from a 1 percent increase in the percent of the population vaccinated) of vaccines varied.</p>
<p>There might be large gains from going to low to average rates of vaccination, but after a certain threshold, the decreases in deaths would taper off.</p>
<p>We could test this by including a <span class="blue">polynomial term</span> <code>I(percent_vaccinated)^2</code> in our model.</p>
<p>Including a polynomial term, allows the marginal effect to vary, based on the value of the predictor.</p>
<p>It’s hard to interpret the coefficients on <span class="blue">polynomial terms</span> (or interaction terms) just by looking at coefficients in a table</p>
<p>Instead, we’ll produce a plot of predicted values to test these claims</p>
</div>
<div id="tabset-3-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>m4 <span class="ot">&lt;-</span> <span class="fu">lm</span>(new_deaths_pc_14day <span class="sc">~</span> percent_vaccinated <span class="sc">+</span> <span class="fu">I</span>(percent_vaccinated<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> rep_voteshare_std <span class="sc">+</span> med_age_std <span class="sc">+</span> med_income_std, covid_lab</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>           )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-3-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-3-tab">
<table class="texreg" style="margin: 10px auto;border-collapse: collapse;border-spacing: 0px;caption-side: bottom;color: #000000;border-top: 2px solid #000000;">
<caption>
Statistical models
</caption>
<thead>
<tr>
<th style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</th>
<th style="padding-left: 5px;padding-right: 5px;">
Model 1
</th>
</tr>
</thead>
<tbody>
<tr style="border-top: 1px solid #000000;">
<td style="padding-left: 5px;padding-right: 5px;">
(Intercept)
</td>
<td style="padding-left: 5px;padding-right: 5px;">
6.194<sup>**</sup>
</td>
</tr>
<tr>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
(2.186)
</td>
</tr>
<tr>
<td style="padding-left: 5px;padding-right: 5px;">
percent_vaccinated
</td>
<td style="padding-left: 5px;padding-right: 5px;">
-0.169<sup>*</sup>
</td>
</tr>
<tr>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
(0.077)
</td>
</tr>
<tr>
<td style="padding-left: 5px;padding-right: 5px;">
percent_vaccinated^2
</td>
<td style="padding-left: 5px;padding-right: 5px;">
0.001
</td>
</tr>
<tr>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
(0.001)
</td>
</tr>
<tr>
<td style="padding-left: 5px;padding-right: 5px;">
rep_voteshare_std
</td>
<td style="padding-left: 5px;padding-right: 5px;">
-0.062
</td>
</tr>
<tr>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
(0.081)
</td>
</tr>
<tr>
<td style="padding-left: 5px;padding-right: 5px;">
med_age_std
</td>
<td style="padding-left: 5px;padding-right: 5px;">
0.053
</td>
</tr>
<tr>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
(0.053)
</td>
</tr>
<tr>
<td style="padding-left: 5px;padding-right: 5px;">
med_income_std
</td>
<td style="padding-left: 5px;padding-right: 5px;">
-0.114
</td>
</tr>
<tr>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
(0.068)
</td>
</tr>
<tr style="border-top: 1px solid #000000;">
<td style="padding-left: 5px;padding-right: 5px;">
R<sup>2</sup>
</td>
<td style="padding-left: 5px;padding-right: 5px;">
0.561
</td>
</tr>
<tr>
<td style="padding-left: 5px;padding-right: 5px;">
Adj. R<sup>2</sup>
</td>
<td style="padding-left: 5px;padding-right: 5px;">
0.512
</td>
</tr>
<tr style="border-bottom: 2px solid #000000;">
<td style="padding-left: 5px;padding-right: 5px;">
Num. obs.
</td>
<td style="padding-left: 5px;padding-right: 5px;">
51
</td>
</tr>
</tbody>
<tfoot>
<tr>
<td style="font-size: 0.8em;" colspan="2">
<sup>***</sup>p &lt; 0.001; <sup>**</sup>p &lt; 0.01; <sup>*</sup>p &lt; 0.05
</td>
</tr>
</tfoot>
</table>
</div>
<div id="tabset-3-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-4-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>pred_df <span class="ot">&lt;-</span> <span class="fu">expand_grid</span>(</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">percent_vaccinated =</span> <span class="fu">sort</span>(<span class="fu">unique</span>(covid_lab<span class="sc">$</span>percent_vaccinated)),</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Set standardized predictors to their means of 0</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">rep_voteshare_std =</span> <span class="dv">0</span>,</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">med_age_std =</span> <span class="dv">0</span>,</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">med_income_std =</span> <span class="dv">0</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>pred_df<span class="sc">$</span>fit <span class="ot">&lt;-</span> <span class="fu">predict</span>(m4, <span class="at">newdata =</span> pred_df)</span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>pred_df <span class="sc">%&gt;%</span> </span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(percent_vaccinated, fit))<span class="sc">+</span></span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>()<span class="sc">+</span></span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Predicted Covid-19 Deaths</span><span class="sc">\n</span><span class="st">(per capita, 14-day average)"</span>,</span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Percent of State's population that's Vaccinated"</span></span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span> </span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="ot">-&gt;</span> fig_m4</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-3-5" class="tab-pane" role="tabpanel" aria-labelledby="tabset-3-5-tab">
<p>For a typical state, early increases in vaccination rate are associated with larger declines in predicted deaths from Covid-19</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="07-slides_files/figure-revealjs/unnamed-chunk-25-1.png" class="img-fluid figure-img" width="960"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="evaluating-model-fit" class="level1 inverse">
<h1 class="inverse"><i class="fa-solid fa-lightbulb" aria-label="lightbulb"></i> Evaluating Model Fit</h1>
<section id="evaluating-model-fit-1" class="level2">
<h2 class="anchored" data-anchor-id="evaluating-model-fit-1">Evaluating Model Fit</h2>
<p>Models partition variance. We can summarize the overall fit of our model using measures like <span class="math inline">\(R^2\)</span></p>
<p><span class="math display">\[R^2 = \frac{\text{variance(predicted values )}}{ \text{variance(observed values )}}\]</span></p>
</section>
<section id="r2" class="level2">
<h2 class="anchored" data-anchor-id="r2">R^2</h2>
<p>More formally, you’ll see <span class="math inline">\(R^2\)</span> defined in terms of “Sums of Squares”</p>
<ul>
<li>TSS = <span class="blue">Total Sum of Squares</span> = Variance of the Outcome</li>
<li>ESS = <span class="blue">Explained Sum of Squares</span> = Variance of the Predicted Values</li>
<li>RSS = <span class="blue">Sum of Squared Residuals</span> = Variance of the Residuals</li>
</ul>
<p><span class="math display">\[R^2 = \frac{ESS}{TSS}= 1 - \frac{RSS}{TSS}\]</span></p>
</section>
<section id="calculating-r2-in-r" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="calculating-r2-in-r">Calculating <span class="math inline">\(R^2\)</span> in R</h2>
<p>We could do it by hand, finding that our model explained about 43 percent of the observed variation deaths.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ESS / TSS</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="fu">var</span>(m3<span class="sc">$</span>fitted.values)<span class="sc">/</span><span class="fu">var</span>(m3<span class="sc">$</span>model<span class="sc">$</span>new_deaths_pc_14day)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.4393655</code></pre>
</div>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 1 - RSS/TSS</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span> <span class="sc">-</span> <span class="fu">var</span>(m3<span class="sc">$</span>residuals)<span class="sc">/</span><span class="fu">var</span>(m3<span class="sc">$</span>model<span class="sc">$</span>new_deaths_pc_14day)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.4393655</code></pre>
</div>
</div>
<p>But generally we let the <code>summary()</code> function do it for us:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(m3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = new_deaths_pc_14day ~ rep_voteshare_std + med_age_std + 
    med_income_std, data = covid_lab)

Residuals:
     Min       1Q   Median       3Q      Max 
-0.50751 -0.19703 -0.06278  0.20024  0.92320 

Coefficients:
                  Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)        0.56561    0.04425  12.782  &lt; 2e-16 ***
rep_voteshare_std  0.07140    0.06654   1.073  0.28869    
med_age_std       -0.01692    0.04744  -0.357  0.72296    
med_income_std    -0.21669    0.06660  -3.254  0.00211 ** 
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.316 on 47 degrees of freedom
Multiple R-squared:  0.4394,    Adjusted R-squared:  0.4036 
F-statistic: 12.28 on 3 and 47 DF,  p-value: 4.689e-06</code></pre>
</div>
</div>
</section>
<section id="adjusted-r2" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="adjusted-r2">Adjusted <span class="math inline">\(R^2\)</span></h2>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-4-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-1" role="tab" aria-controls="tabset-4-1" aria-selected="true">Adjusted <span class="math inline">\(R^2\)</span></a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-4-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-2" role="tab" aria-controls="tabset-4-2" aria-selected="false"><i class="fa-solid fa-code" aria-label="code"></i> Example</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-4-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-4-3" role="tab" aria-controls="tabset-4-3" aria-selected="false"><i class="fa-solid fa-chart-line" aria-label="chart-line"></i> Figure</a></li></ul>
<div class="tab-content">
<div id="tabset-4-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-4-1-tab">
<div class="nonincremental">
<ul>
<li><p>One can show that a models <span class="math inline">\(R^2\)</span> <span class="blue">always increases</span> as we <span class="blue">add predictors</span>, even when they’re unrelated to the outcome</p></li>
<li><p>The <span class="blue">adjusted <span class="math inline">\(R^2\)</span></span> adjusts for this by weighting the <span class="math inline">\(R^2\)</span> of a model by the number of predictors</p></li>
</ul>
<p><span class="math display">\[\text{adj. }R^2 = 1 - \frac{RSS/(n-k)}{TSS/(n-1)}\]</span></p>
</div>
</div>
<div id="tabset-4-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-4-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>ex_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> <span class="fu">rnorm</span>(<span class="dv">100</span>) </span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">bind_cols</span>(</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">data.frame</span>(<span class="fu">matrix</span>(<span class="fu">rnorm</span>(<span class="dv">10000</span>), <span class="at">ncol=</span><span class="dv">100</span>))</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> janitor<span class="sc">::</span><span class="fu">clean_names</span>()</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a>the_formulas <span class="ot">&lt;-</span> <span class="fu">list</span>()</span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">51</span>){</span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>  vars <span class="ot">&lt;-</span> <span class="fu">names</span>(ex_df)[<span class="dv">2</span><span class="sc">:</span>i]</span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>  the_formulas[[i<span class="dv">-1</span>]] <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="st">"y~"</span>,<span class="fu">paste</span>(vars,<span class="at">collapse =</span> <span class="st">"+"</span>))</span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a>the_formulas <span class="sc">%&gt;%</span> </span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a>  purrr<span class="sc">::</span><span class="fu">map</span>(as.formula) <span class="sc">%&gt;%</span> </span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a>  purrr<span class="sc">::</span><span class="fu">map</span>(lm, <span class="at">data=</span>ex_df) <span class="sc">%&gt;%</span> </span>
<span id="cb27-18"><a href="#cb27-18" aria-hidden="true" tabindex="-1"></a>  purrr<span class="sc">::</span><span class="fu">map</span>(summary) <span class="sc">%&gt;%</span> </span>
<span id="cb27-19"><a href="#cb27-19" aria-hidden="true" tabindex="-1"></a>  purrr<span class="sc">::</span><span class="fu">map_df</span>(glance) <span class="ot">-&gt;</span> r2_df</span>
<span id="cb27-20"><a href="#cb27-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-21"><a href="#cb27-21" aria-hidden="true" tabindex="-1"></a>r2_df <span class="sc">%&gt;%</span> </span>
<span id="cb27-22"><a href="#cb27-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(df, r.squared))<span class="sc">+</span></span>
<span id="cb27-23"><a href="#cb27-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">col =</span> <span class="st">"R^2"</span>))<span class="sc">+</span></span>
<span id="cb27-24"><a href="#cb27-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>()<span class="sc">+</span></span>
<span id="cb27-25"><a href="#cb27-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">y=</span>adj.r.squared,<span class="at">col =</span> <span class="st">"Adjusted R^2"</span>))<span class="sc">+</span></span>
<span id="cb27-26"><a href="#cb27-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">y=</span>adj.r.squared))<span class="sc">+</span></span>
<span id="cb27-27"><a href="#cb27-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb27-28"><a href="#cb27-28" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Number of predictors"</span>,</span>
<span id="cb27-29"><a href="#cb27-29" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Proportion of Variance Explained"</span>,</span>
<span id="cb27-30"><a href="#cb27-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Adding unrelated predictors increases a model's R^2</span><span class="sc">\n</span><span class="st">while the Adjusted R^2 provides a better indicator of poor fit "</span>,</span>
<span id="cb27-31"><a href="#cb27-31" aria-hidden="true" tabindex="-1"></a>    <span class="at">col =</span><span class="st">"Model fit"</span></span>
<span id="cb27-32"><a href="#cb27-32" aria-hidden="true" tabindex="-1"></a>  ) <span class="ot">-&gt;</span> fig_r2</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-4-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-4-3-tab">
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="07-slides_files/figure-revealjs/unnamed-chunk-29-1.png" class="img-fluid figure-img" width="960"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="section-14" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="section-14"></h2>
<section id="using-r2-to-compare-models" class="level4">
<h4 class="anchored" data-anchor-id="using-r2-to-compare-models">Using <span class="math inline">\(R^2\)</span> to compare models</h4>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-5-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-1" role="tab" aria-controls="tabset-5-1" aria-selected="true">ANOVA</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-5-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-2" role="tab" aria-controls="tabset-5-2" aria-selected="false"><i class="fa-solid fa-code" aria-label="code"></i> m5</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-5-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-3" role="tab" aria-controls="tabset-5-3" aria-selected="false"><i class="fa-solid fa-table" aria-label="table"></i> Table</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-5-4-tab" data-bs-toggle="tab" data-bs-target="#tabset-5-4" role="tab" aria-controls="tabset-5-4" aria-selected="false"><i class="fa-solid fa-code" aria-label="code"></i> Anova</a></li></ul>
<div class="tab-content">
<div id="tabset-5-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-5-1-tab">
<p>When models are <em>nested</em> (larger models contain all the predictors of smaller models), we can ask, does including the additional predictors in the larger model explain more variation in the outcome than we would expect would happen if we just added additional, random variable.</p>
<p>Formally we call this process an <a href="https://towardsdatascience.com/anova-for-regression-fdb49cf5d684#:~:text=It%20is%20the%20same%20as,or%20more%20categorical%20predictor%20variables." target="_blank">Analysis of Variance (ANOVA)</a></p>
<p>Let’s assess the added predictive power of <code>I(percent_vaccinated^2)</code> by estimating a model without it and comparing models using ANOVA</p>
</div>
<div id="tabset-5-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-5-2-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Estimate model without polynomial</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>m5 <span class="ot">&lt;-</span> <span class="fu">lm</span>(new_deaths_pc_14day <span class="sc">~</span> percent_vaccinated  <span class="sc">+</span> rep_voteshare_std <span class="sc">+</span> med_age_std <span class="sc">+</span> med_income_std, covid_lab</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>           )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
<div id="tabset-5-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-5-3-tab">
<table class="texreg" style="margin: 10px auto;border-collapse: collapse;border-spacing: 0px;caption-side: bottom;color: #000000;border-top: 2px solid #000000;">
<caption>
Statistical models
</caption>
<thead>
<tr>
<th style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</th>
<th style="padding-left: 5px;padding-right: 5px;">
Model 1
</th>
<th style="padding-left: 5px;padding-right: 5px;">
Model 2
</th>
</tr>
</thead>
<tbody>
<tr style="border-top: 1px solid #000000;">
<td style="padding-left: 5px;padding-right: 5px;">
(Intercept)
</td>
<td style="padding-left: 5px;padding-right: 5px;">
6.194<sup>**</sup>
</td>
<td style="padding-left: 5px;padding-right: 5px;">
2.532<sup>***</sup>
</td>
</tr>
<tr>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
(2.186)
</td>
<td style="padding-left: 5px;padding-right: 5px;">
(0.657)
</td>
</tr>
<tr>
<td style="padding-left: 5px;padding-right: 5px;">
percent_vaccinated
</td>
<td style="padding-left: 5px;padding-right: 5px;">
-0.169<sup>*</sup>
</td>
<td style="padding-left: 5px;padding-right: 5px;">
-0.035<sup>**</sup>
</td>
</tr>
<tr>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
(0.077)
</td>
<td style="padding-left: 5px;padding-right: 5px;">
(0.012)
</td>
</tr>
<tr>
<td style="padding-left: 5px;padding-right: 5px;">
percent_vaccinated^2
</td>
<td style="padding-left: 5px;padding-right: 5px;">
0.001
</td>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
</tr>
<tr>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
(0.001)
</td>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
</tr>
<tr>
<td style="padding-left: 5px;padding-right: 5px;">
rep_voteshare_std
</td>
<td style="padding-left: 5px;padding-right: 5px;">
-0.062
</td>
<td style="padding-left: 5px;padding-right: 5px;">
-0.089
</td>
</tr>
<tr>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
(0.081)
</td>
<td style="padding-left: 5px;padding-right: 5px;">
(0.082)
</td>
</tr>
<tr>
<td style="padding-left: 5px;padding-right: 5px;">
med_age_std
</td>
<td style="padding-left: 5px;padding-right: 5px;">
0.053
</td>
<td style="padding-left: 5px;padding-right: 5px;">
0.071
</td>
</tr>
<tr>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
(0.053)
</td>
<td style="padding-left: 5px;padding-right: 5px;">
(0.053)
</td>
</tr>
<tr>
<td style="padding-left: 5px;padding-right: 5px;">
med_income_std
</td>
<td style="padding-left: 5px;padding-right: 5px;">
-0.114
</td>
<td style="padding-left: 5px;padding-right: 5px;">
-0.119
</td>
</tr>
<tr>
<td style="padding-left: 5px;padding-right: 5px;">
&nbsp;
</td>
<td style="padding-left: 5px;padding-right: 5px;">
(0.068)
</td>
<td style="padding-left: 5px;padding-right: 5px;">
(0.070)
</td>
</tr>
<tr style="border-top: 1px solid #000000;">
<td style="padding-left: 5px;padding-right: 5px;">
R<sup>2</sup>
</td>
<td style="padding-left: 5px;padding-right: 5px;">
0.561
</td>
<td style="padding-left: 5px;padding-right: 5px;">
0.531
</td>
</tr>
<tr>
<td style="padding-left: 5px;padding-right: 5px;">
Adj. R<sup>2</sup>
</td>
<td style="padding-left: 5px;padding-right: 5px;">
0.512
</td>
<td style="padding-left: 5px;padding-right: 5px;">
0.490
</td>
</tr>
<tr style="border-bottom: 2px solid #000000;">
<td style="padding-left: 5px;padding-right: 5px;">
Num. obs.
</td>
<td style="padding-left: 5px;padding-right: 5px;">
51
</td>
<td style="padding-left: 5px;padding-right: 5px;">
51
</td>
</tr>
</tbody>
<tfoot>
<tr>
<td style="font-size: 0.8em;" colspan="3">
<sup>***</sup>p &lt; 0.001; <sup>**</sup>p &lt; 0.01; <sup>*</sup>p &lt; 0.05
</td>
</tr>
</tfoot>
</table>
</div>
<div id="tabset-5-4" class="tab-pane" role="tabpanel" aria-labelledby="tabset-5-4-tab">
<p>The anova suggests that including a polynomial provides a <em>marginal</em> improvement to fit (p &lt; 0.10)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(m5, m4)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Variance Table

Model 1: new_deaths_pc_14day ~ percent_vaccinated + rep_voteshare_std + 
    med_age_std + med_income_std
Model 2: new_deaths_pc_14day ~ percent_vaccinated + I(percent_vaccinated^2) + 
    rep_voteshare_std + med_age_std + med_income_std
  Res.Df    RSS Df Sum of Sq      F  Pr(&gt;F)  
1     46 3.9268                              
2     45 3.6758  1   0.25098 3.0725 0.08644 .
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="difference-in-differences" class="level1 inverse">
<h1 class="inverse"><i class="fa-solid fa-lightbulb" aria-label="lightbulb"></i> Difference-in-Differences</h1>
<section id="motivating-example-what-causes-cholera" class="level2 smaller" data-background-image="https://www.finebooksmagazine.com/sites/default/files/styles/gallery_item/public/media-images/2020-11/map-lead-4.jpg?h=2ded5a3f&amp;itok=Mn-K5rQc," data-background-opacity=".3">
<h2 class="smaller anchored" data-background-image="https://www.finebooksmagazine.com/sites/default/files/styles/gallery_item/public/media-images/2020-11/map-lead-4.jpg?h=2ded5a3f&amp;itok=Mn-K5rQc," data-background-opacity=".3" data-anchor-id="motivating-example-what-causes-cholera">Motivating Example: What causes Cholera?</h2>
<ul>
<li><p>In the 1800s, cholera was thought to be transmitted through the air.</p></li>
<li><p>John Snow (the physician, not the snack), to explore the origins eventunally concluding that cholera was transmitted through living organisms in water.</p></li>
<li><p>Leveraged a <strong>natural experiment</strong> in which one water company in London moved its pipes further upstream (reducing contamination for Lambeth), while other companies kept their pumps serving Southwark and Vauxhall in the same location.</p></li>
</ul>
</section>
<section id="notation" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="notation">Notation</h2>
<p>Let’s adopt a little notation to help us think about the logic of Snow’s design:</p>
<ul>
<li><p><span class="math inline">\(D\)</span>: treatment indicator, 1 for treated neighborhoods (Lambeth), 0 for control neighborhoods (Southwark and Vauxhall)</p></li>
<li><p><span class="math inline">\(T\)</span>: period indicator, 1 if post treatment (1854), 0 if pre-treatment (1849).</p></li>
<li><p><span class="math inline">\(Y_{di}(t)\)</span> the potential outcome of unit <span class="math inline">\(i\)</span></p>
<ul>
<li><p><span class="math inline">\(Y_{1i}(t)\)</span> the potential outcome of unit <span class="math inline">\(i\)</span> when treated between the two periods</p></li>
<li><p><span class="math inline">\(Y_{0i}(t)\)</span> the potential outcome of unit <span class="math inline">\(i\)</span> when control between the two periods</p></li>
</ul></li>
</ul>
</section>
<section id="causal-effects" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="causal-effects">Causal Effects</h2>
<p>The individual causal effect for unit i at time t is:</p>
<p><span class="math display">\[\tau_{it} = Y_{1i}(t) − Y_{0i}(t)\]</span></p>
<p>What we observe is</p>
<p><span class="math display">\[Y_i(t) = Y_{0i}(t)\cdot(1 − D_i(t)) + Y_{1i}(t)\cdot D_i(t)\]</span></p>
<p><span class="math inline">\(D\)</span> only equals 1, when <span class="math inline">\(T\)</span> equals 1, so we never observe <span class="math inline">\(Y_0i(1)\)</span> for the treated units.</p>
<p>In words, we don’t know what Lambeth’s outcome would have been in the second period, had they not been treated.</p>
</section>
<section id="average-treatment-on-treated" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="average-treatment-on-treated">Average Treatment on Treated</h2>
<p>Our goal is to estimate the average effect of treatment on treated (ATT):</p>
<p><span class="math display">\[\tau_{ATT} = E[Y_{1i}(1) -  Y_{0i}(1)|D=1]\]</span></p>
<p>That is, what would have happened in Lambeth, had their water company not moved their pipes</p>
</section>
<section id="average-treatment-on-treated-1" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="average-treatment-on-treated-1">Average Treatment on Treated</h2>
<p>Our goal is to estimate the average effect of treatment on treated (ATT):</p>
<p>We we can observe is:</p>
<table class="table">
<colgroup>
<col style="width: 25%">
<col style="width: 50%">
<col style="width: 25%">
</colgroup>
<thead>
<tr class="header">
<th></th>
<th>Pre-Period (T=0)</th>
<th>Post-Period (T=1)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Treated <span class="math inline">\(D_{i}=1\)</span></td>
<td><span class="math inline">\(E[Y_{0i}(0)\vert D_i = 1]\)</span></td>
<td><span class="math inline">\(E[Y_{1i}(1)\vert D_i = 1]\)</span></td>
</tr>
<tr class="even">
<td>Control <span class="math inline">\(D_i=0\)</span></td>
<td><span class="math inline">\(E[Y_{0i}(0)\vert D_i = 0]\)</span></td>
<td><span class="math inline">\(E[Y_{0i}(1)\vert D_i = 0]\)</span></td>
</tr>
</tbody>
</table>
</section>
<section id="data" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="data">Data</h2>
<p>Because potential outcomes notation is abstract, let’s consider a modified description of the Snow’s cholera death data from <a href="https://mixtape.scunning.com/difference-in-differences.html" target="_blank">Scott Cunningham</a>:</p>
<div class="cell">
<div class="cell-output-display">
<table class="table table-sm table-striped small">
<thead>
<tr class="header">
<th style="text-align: left;">Company</th>
<th style="text-align: right;">1849 (T=0)</th>
<th style="text-align: right;">1854 (T=1)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Lambeth (D=1)</td>
<td style="text-align: right;">85</td>
<td style="text-align: right;">19</td>
</tr>
<tr class="even">
<td style="text-align: left;">Southwark and Vauxhall (D=0)</td>
<td style="text-align: right;">135</td>
<td style="text-align: right;">147</td>
</tr>
</tbody>
</table>
</div>
</div>
</section>
<section id="how-can-we-estimate-the-effect-of-moving-pumps-upstream" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="how-can-we-estimate-the-effect-of-moving-pumps-upstream">How can we estimate the effect of moving pumps upstream?</h2>
<p>Recall, our goal is to estimate the effect of the the treatment on the treated:</p>
<p><span class="math display">\[\tau_{ATT} = E[Y_{1i}(1) -  Y_{0i}(1)|D=1]\]</span></p>
<p>Let’s conisder some strategies Snow could take to estimate this quantity:</p>
</section>
<section id="before-vs-after-comparisons" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="before-vs-after-comparisons">Before vs after comparisons:</h2>
<div class="nonincremental">
<ul>
<li><p>Snow could have compared Labmeth in 1854 <span class="math inline">\((E[Y_i(1)|D_i = 1] = 19)\)</span> to Lambeth in 1849 <span class="math inline">\((E[Y_i(0)|D_i = 1]=85)\)</span>, and claimed that moving the pumps upstream led to <strong>66 fewer cholera deaths.</strong></p></li>
<li><p>Assumes Lambeth’s pre-treatment outcomes in 1849 are a good proxy for what its outcomes would have been in 1954 if the pumps hadn’t moved <span class="math inline">\((E[Y_{0i}(1)|D_i = 1])\)</span>.</p></li>
<li><p>A skeptic might argue that Lambeth in 1849 <span class="math inline">\(\neq\)</span> Lambeth in 1854</p></li>
</ul>
<div class="cell">
<div class="cell-output-display">
<table class="table table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Company</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">1849 (T=0)</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">1854 (T=1)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left; font-weight: bold; color: blue !important;">Lambeth (D=1)</td>
<td style="text-align: right; font-weight: bold; color: blue !important;">85</td>
<td style="text-align: right; font-weight: bold; color: blue !important;">19</td>
</tr>
<tr class="even">
<td style="text-align: left;">Southwark and Vauxhall (D=0)</td>
<td style="text-align: right;">135</td>
<td style="text-align: right;">147</td>
</tr>
</tbody>
</table>


</div>
</div>
</div>
</section>
<section id="treatment-control-comparisons-in-the-post-period." class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="treatment-control-comparisons-in-the-post-period.">Treatment-Control comparisons in the Post Period.</h2>
<div class="nonincremental">
<ul>
<li><p>Snow could have compared outcomes between Lambeth and S&amp;V in 1954 (<span class="math inline">\(E[Yi(1)|Di = 1] − E[Yi(1)|Di = 0]\)</span>), concluding that the change in pump locations led to <strong>128 fewer deaths.</strong></p></li>
<li><p>Here the assumption is that the outcomes in S&amp;V and in 1854 provide a good proxy for what would have happened in Lambeth in 1954 had the pumps not been moved <span class="math inline">\((E[Y_{0i}(1)|D_i = 1])\)</span></p></li>
<li><p>Again, our skeptic could argue Lambeth <span class="math inline">\(\neq\)</span> S&amp;V</p></li>
</ul>
<div class="cell">
<div class="cell-output-display">
<table class="table table-sm table-striped small" data-quarto-postprocess="true">
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">Company</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">1849 (T=0)</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">1854 (T=1)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Lambeth (D=1)</td>
<td style="text-align: right;">85</td>
<td style="text-align: right; font-weight: bold; color: red !important;">19</td>
</tr>
<tr class="even">
<td style="text-align: left;">Southwark and Vauxhall (D=0)</td>
<td style="text-align: right;">135</td>
<td style="text-align: right; font-weight: bold; color: red !important;">147</td>
</tr>
</tbody>
</table>


</div>
</div>
</div>
</section>
<section id="difference-in-differences-1" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="difference-in-differences-1">Difference in Differences</h2>
<div class="nonincremental">
<p>To address these concerns, Snow employed what we now call a <span class="blue">difference-in-differences</span> design,</p>
<p>There are two, equivalent ways to view this design.</p>
<p><span class="math display">\[\underbrace{\{E[Y_{i}(1)|D_{i} = 1] − E[Y_{i}(1)|D_{i} = 0]\}}_{\text{1. Treat-Control |Post }}− \overbrace{\{E[Y_{i}(0)|D_{i} = 1] − E[Y_{i}(0)|D_{i}=0 ]}^{\text{Treated-Control|Pre}}\]</span></p>
<ul>
<li><p>Difference 1: Average change between Treated and Control in Post Period</p></li>
<li><p>Difference 2: Average change between Treated and Control in Pre Period</p></li>
</ul>
</div>
</section>
<section id="difference-in-differences-2" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="difference-in-differences-2">Difference in Differences</h2>
<div class="nonincremental">
<p><span class="math display">\[\underbrace{\{E[Y_{i}(1)|D_{i} = 1] − E[Y_{i}(1)|D_{i} = 0]\}}_{\text{1. Treat-Control |Post }}− \overbrace{\{E[Y_{i}(0)|D_{i} = 1] − E[Y_{i}(0)|D_{i}=0 ]}^{\text{Treated-Control|Pre}}\]</span> Is equivalent to:</p>
<p><span class="math display">\[\underbrace{\{E[Y_{i}(1)|D_{i} = 1] − E[Y_{i}(0)|D_{i} = 1]\}}_{\text{Post - Pre |Treated }}− \overbrace{\{E[Y_{i}(1)|D_{i} = 0] − E[Y_{i}(0)|D_{i}=0 ]}^{\text{Post-Pre|Control}}\]</span></p>
<ul>
<li>Difference 1: Average change between Treated over time</li>
<li>Difference 2: Average change between Control over time</li>
</ul>
</div>
</section>
<section id="difference-in-differences-3" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="difference-in-differences-3">Difference in Differences</h2>
<p>You’ll see the DiD design represented both ways, but they produce the same result:</p>
<p><span class="math display">\[
\tau_{ATT} = (19-147) - (85-135) = -78
\]</span></p>
<p><span class="math display">\[
\tau_{ATT} = (19-85) - (147-135) = -78
\]</span></p>
</section>
<section id="identifying-assumption-of-a-difference-in-differences-design" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="identifying-assumption-of-a-difference-in-differences-design">Identifying Assumption of a Difference in Differences Design</h2>
<p>The key assumption in this design is what’s known as the parallel trends assumption: <span class="math inline">\(E[Y_{0i}(1) − Y_{0i}(0)|D_i = 1] = E[Y_{0i}(1) − Y_{0i}(0)|D_i = 0]\)</span></p>
<ul>
<li>In words: If Lambeth hadn’t moved its pumps, it would have followed a similar path as S&amp;V</li>
</ul>
</section>
<section id="parallel-trends" class="level2">
<h2 class="anchored" data-anchor-id="parallel-trends">Parallel Trends</h2>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="07-slides_files/figure-revealjs/paralleltrends-1.png" class="img-fluid figure-img" width="960"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="using-lm-to-estimate-diff-in-diff" class="level2">
<h2 class="anchored" data-anchor-id="using-lm-to-estimate-diff-in-diff">Using lm to estimate Diff-in-Diff</h2>
<div class="tabset-margin-container"></div><div class="panel-tabset">
<ul class="nav nav-tabs" role="tablist"><li class="nav-item" role="presentation"><a class="nav-link active" id="tabset-6-1-tab" data-bs-toggle="tab" data-bs-target="#tabset-6-1" role="tab" aria-controls="tabset-6-1" aria-selected="true"><i class="fa-solid fa-table" aria-label="table"></i> Data</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-6-2-tab" data-bs-toggle="tab" data-bs-target="#tabset-6-2" role="tab" aria-controls="tabset-6-2" aria-selected="false"><i class="fa-solid fa-code" aria-label="code"></i> lm()</a></li><li class="nav-item" role="presentation"><a class="nav-link" id="tabset-6-3-tab" data-bs-toggle="tab" data-bs-target="#tabset-6-3" role="tab" aria-controls="tabset-6-3" aria-selected="false"><i class="fa-solid fa-chart-line" aria-label="chart-line"></i> Diff-in-Diff</a></li></ul>
<div class="tab-content">
<div id="tabset-6-1" class="tab-pane active" role="tabpanel" aria-labelledby="tabset-6-1-tab">
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>cholera_df <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">Location =</span> <span class="fu">c</span>(<span class="st">"S&amp;V"</span>,<span class="st">"Lambeth"</span>,<span class="st">"S&amp;V"</span>,<span class="st">"Lambeth"</span>),</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">Treated =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">0</span>, <span class="dv">1</span>),</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">Time =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">1</span>),</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">Deaths =</span> <span class="fu">c</span>(<span class="dv">135</span>,<span class="dv">85</span>,<span class="dv">147</span>,<span class="dv">19</span>)</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>cholera_df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 4
  Location Treated  Time Deaths
  &lt;chr&gt;      &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;
1 S&amp;V            0     0    135
2 Lambeth        1     0     85
3 S&amp;V            0     1    147
4 Lambeth        1     1     19</code></pre>
</div>
</div>
</div>
<div id="tabset-6-2" class="tab-pane" role="tabpanel" aria-labelledby="tabset-6-2-tab">
<p><span class="math display">\[
\text{Deaths} = \beta_0 + \beta_1\text{Treated} + \beta_2\text{Time} + \beta_3 \text{Treated}\times\text{Time}
\]</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>diff_in_diff <span class="ot">&lt;-</span> <span class="fu">lm</span>(Deaths <span class="sc">~</span> Treated <span class="sc">+</span> Time <span class="sc">+</span> Treated<span class="sc">:</span>Time, cholera_df)</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>diff_in_diff</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = Deaths ~ Treated + Time + Treated:Time, data = cholera_df)

Coefficients:
 (Intercept)       Treated          Time  Treated:Time  
         135           -50            12           -78  </code></pre>
</div>
</div>
</div>
<div id="tabset-6-3" class="tab-pane" role="tabpanel" aria-labelledby="tabset-6-3-tab">
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="07-slides_files/figure-revealjs/didplot-1.png" class="img-fluid figure-img" width="960"></p>
</figure>
</div>
</div>
</div>
<div class="nonincremental">
<ul>
<li><span class="math inline">\(\beta_0=\)</span> Outcome in control (S&amp;V) before treatment</li>
<li><span class="math inline">\(\beta_1=\)</span> Fixed, <span class="blue">time invariant</span> differences between <span class="blue">treated</span> and <span class="blue">control</span></li>
<li><span class="math inline">\(\beta_2=\)</span> Fixed, <span class="blue">unit invariant</span> differences between <span class="blue">pre</span> and <span class="blue">post</span> periods</li>
<li><span class="math inline">\(\beta_3=\)</span> <span class="blue">Difference-in-Differences</span> = <span class="math inline">\(E[Y_{1i}(1) -  Y_{0i}(1)|D=1]\)</span></li>
</ul>
</div>
</div>
</div>
</div>
</section>
<section id="summary" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="summary">Summary</h2>
<ul>
<li><p>A <span class="blue">Difference in Differences</span> (DiD, or diff-in-diff) design combines a pre-post comparison, with a treated and control comparison</p></li>
<li><p>Differencing twice accounts for fixed differences <span class="blue">across units</span> and <span class="blue">between periods</span></p>
<ul>
<li>But not time varying differences across units…</li>
</ul></li>
<li><p>The key identifying assumption of a DiD design is the assumption of <span class="blue">parallel trends</span></p>
<ul>
<li>Absent treatment, treated and control groups would see the same changes over time.</li>
<li>Hard to prove, possible to assess if we have multiple periods of pre-treatment observations</li>
</ul></li>
</ul>
</section>
<section id="generalizing-diff-in-diff-with-linear-regression" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="generalizing-diff-in-diff-with-linear-regression">Generalizing Diff-in-Diff with Linear Regression</h2>
<ul>
<li>Linear regression allows us to generalizes Diff-in-Diff to multiple periods and treatment interventions, with <span class="blue">fixed effects</span></li>
</ul>
<div class="fragment">
<p><span class="math display">\[
y_{it} = \overbrace{\alpha_i}^{\text{Unit FE}} + \underbrace{\gamma_t}_{\text{Period FE}} + \overbrace{\tau*d_{it}}^{\text{Treatment}} + \underbrace{X\beta}_{\text{Covariates}} + \epsilon_{it}
\]</span></p>
</div>
<ul>
<li><span class="blue">Unit fixed effects</span> <span class="math inline">\((\alpha_i)\)</span>control for time-invariant differences across units</li>
<li><span class="blue">Period fixed effects</span> <span class="math inline">\((\gamma_i)\)</span> control for unit-invariant differences across periods</li>
<li><span class="blue"><span class="math inline">\(\tau\)</span></span> corresponds the <span class="blue">Difference-in-Difference</span> estimate for a <span class="blue">two-way fixed effects</span> regression</li>
</ul>
</section>
<section id="extensions-and-limitations" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="extensions-and-limitations">Extensions and limitations</h2>
<ul>
<li>Interpretation of <span class="blue">two-way fixed effects</span> DiD estimator is <span class="blue">complicated</span>…
<ul>
<li><span class="citation" data-cites="Goodman-Bacon2021-ah">Goodman-Bacon (<a href="#ref-Goodman-Bacon2021-ah" role="doc-biblioref">2021</a>)</span></li>
</ul></li>
<li>More pre-treatment periods allow you assess “parallel trends” assumption</li>
<li>Alternative methods
<ul>
<li>Synthetic control</li>
<li>Event Study Designs</li>
</ul></li>
<li>What if you have multiple treatments or treatments that come and go?
<ul>
<li>Panel Matching</li>
<li>Generalized Synthetic control</li>
</ul></li>
</ul>
</section>
<section id="applications" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="applications">Applications</h2>
<ul>
<li><p><a href="https://www.nber.org/papers/w4509" target="_blank">Card and Krueger (1994)</a> What effect did raising the minimum wage in NJ have on employment</p></li>
<li><p><a href="https://onlinelibrary.wiley.com/doi/full/10.1111/ajps.12116?casa_token=_ceCu4SwzTEAAAAA%3AP9aeaZpT_Zh1VdWKXx_tEmzaJTtMJ1n0eG7EaYlvJZYN000re33cfMAI2O8N8htFJjOsln2GyVeQql4" target="_blank">Abadie, Diamond, &amp; Hainmueller (2014)</a> What effect did German Unification have on economic development in West Germany</p></li>
<li><p><a href="https://www.cambridge.org/core/journals/american-political-science-review/article/impact-of-recentralization-on-public-services-a-differenceindifferences-analysis-of-the-abolition-of-elected-councils-in-vietnam/3477854BAAFE152DC93C594169D64F58" target="_blank">Malesky, Nguyen and Tran (2014)</a> How does decentralization influence public services?</p></li>
</ul>
</section>
</section>
<section id="previewing-lab-7" class="level1 inverse">
<h1 class="inverse"><i class="fa-solid fa-code" aria-label="code"></i> Previewing Lab 7</h1>
<section id="replicating-grumbach-and-hill-2022" class="level2">
<h2 class="anchored" data-anchor-id="replicating-grumbach-and-hill-2022">Replicating Grumbach and Hill (2022)</h2>
<ul>
<li><p>In this week’s lab, we’ll be conducting a partial replication of <span class="citation" data-cites="Grumbach2022-zj">Grumbach and Hill (<a href="#ref-Grumbach2022-zj" role="doc-biblioref">2022</a>)</span> “Rock the Registration: Same Day Registration Increases Turnout of Young Voters.”</p></li>
<li><p>On Thursday, we’ll walk through</p>
<ul>
<li>the paper’s design and argument</li>
<li>setting up and exploring the data</li>
<li>reproducing some descriptive figures</li>
</ul></li>
<li><p>Next Thursday, we’ll focus on replicating and understanding the main results</p></li>
</ul>
</section>
<section id="section-15" class="level2">
<h2 class="anchored" data-anchor-id="section-15"></h2>
<p><img src="images/07_grumbach2022.png" class="img-fluid"></p>
</section>
<section id="general-structure-of-labs-7-8" class="level2">
<h2 class="anchored" data-anchor-id="general-structure-of-labs-7-8">General Structure of Labs 7-8</h2>
<p>Lab 7:</p>
<ul>
<li>Summarize the study</li>
<li>Download and load the data</li>
<li>Recode the data</li>
<li>Merge the data</li>
<li>Recreate Figures 1 and 2</li>
</ul>
<p>Lab 8:</p>
<ul>
<li>Estimate some baseline models to understand Two-Way Fixed Effects</li>
<li>Estimate some of the models in Figure 3</li>
<li>Extend the study, perhaps considering SDR by race or gender</li>
</ul>
</section>
<section id="reading-grumbach-and-hill-2022" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="reading-grumbach-and-hill-2022">Reading Grumbach and Hill (2022)</h2>
<p>Reading <span class="citation" data-cites="Grumbach2022-zj">Grumbach and Hill (<a href="#ref-Grumbach2022-zj" role="doc-biblioref">2022</a>)</span>, focus on being able to answer the following:</p>
<ul>
<li>What’s the research question?
<ul>
<li>General RQ: First sentence, second paragraph, p.&nbsp;405</li>
<li>Specific RQs: p.&nbsp;405-406</li>
</ul></li>
<li>What’s the theoretical framework?
<ul>
<li>Intro and Theory of Registration, p.&nbsp;407-409</li>
</ul></li>
<li>What’s the empirical design?
<ul>
<li>Methods pp.&nbsp;409-410</li>
</ul></li>
<li>What’s are the main results?
<ul>
<li>Results pp.&nbsp;410-413</li>
<li>Figure 3 in particular</li>
</ul></li>
</ul>
</section>
<section id="q1-download-the-replication-files" class="level2">
<h2 class="anchored" data-anchor-id="q1-download-the-replication-files">Q1: Download the replication files</h2>
<p>Rather than downloading the files directly from the paper’s <span class="blue">replication archives</span>, in this lab, we will <span class="blue">download the replication files</span> to your computers and then <span class="blue">load the data</span> into R from <span class="blue">where they’re saved</span></p>
<p>Please click <a href="https://dataverse.harvard.edu/dataset.xhtml?persistentId=doi:10.7910/DVN/AW5LU8" target="_blank">here</a> and let’s download the files together.</p>
</section>
<section id="go-to-the-papers-dataverse" class="level2">
<h2 class="anchored" data-anchor-id="go-to-the-papers-dataverse">1. Go to the paper’s dataverse</h2>
<p>Please click <a href="https://dataverse.harvard.edu/dataset.xhtml?persistentId=doi:10.7910/DVN/AW5LU8" target="_blank">here</a></p>
<p><img src="images/07_rep1.png" class="img-fluid"></p>
</section>
<section id="log-in-through-brown" class="level2">
<h2 class="anchored" data-anchor-id="log-in-through-brown">2. Log in through Brown</h2>
<p><img src="images/07_rep2.png" class="img-fluid"></p>
</section>
<section id="select-all-of-the-files" class="level2">
<h2 class="anchored" data-anchor-id="select-all-of-the-files">3. Select all of the files</h2>
<p>Make sure to <strong>Select all 11 files in this dataset</strong></p>
<p><img src="images/07_rep3.png" class="img-fluid"></p>
<p><img src="images/07_rep4.png" class="img-fluid"></p>
</section>
<section id="download-the-files-in-their-original-format" class="level2">
<h2 class="anchored" data-anchor-id="download-the-files-in-their-original-format">4. Download the files in their original format</h2>
<p><img src="images/07_rep5.png" class="img-fluid"></p>
</section>
<section id="section-16" class="level2">
<h2 class="anchored" data-anchor-id="section-16"></h2>
<section id="save-and-unzip-the-downloaded-files-into-your-course-folder-where-your-labs-are-saved" class="level3">
<h3 class="anchored" data-anchor-id="save-and-unzip-the-downloaded-files-into-your-course-folder-where-your-labs-are-saved">5. Save and unzip the downloaded files into your course folder where your labs are saved</h3>
<p><img src="images/07_rep6.png" class="img-fluid"></p>
</section>
</section>
<section id="q3-load-the-data-into-r" class="level2 smaller">
<h2 class="smaller anchored" data-anchor-id="q3-load-the-data-into-r">Q3: Load the data into R</h2>
<p>If you’ve saved the dataverse_files <span class="blue">into the folder where your lab is saved</span>, you should be able to run the following code after <span class="blue">setting the working directory</span> to <span class="blue">source file location</span>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Remember to set working directory:</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Session &gt; Set working directory &gt; Source file location</span></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Load fips_codes</span></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>fips_codes <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"dataverse_files/fips_codes_website.csv"</span>)<span class="sc">%&gt;%</span></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>  janitor<span class="sc">::</span><span class="fu">clean_names</span>()</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Load policy data</span></span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="st">"dataverse_files/policy_data_updated.RDS"</span>)<span class="sc">%&gt;%</span></span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a>  janitor<span class="sc">::</span><span class="fu">clean_names</span>()</span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Load CPS data</span></span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a>cps <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"dataverse_files/cps_00021.csv"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a>  janitor<span class="sc">::</span><span class="fu">clean_names</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="summary-1" class="level1 inverse">
<h1 class="inverse"><i class="fa-solid fa-home" aria-label="home"></i> Summary</h1>
<section id="summary-2" class="level2">
<h2 class="anchored" data-anchor-id="summary-2">Summary</h2>
</section>
<section id="references" class="level2">




</section>
</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-Goodman-Bacon2021-ah" class="csl-entry" role="listitem">
Goodman-Bacon, Andrew. 2021. <span>“<span class="nocase">Difference-in-differences with variation in treatment timing</span>.”</span> <em>Journal of Econometrics</em> 225 (2): 254–77.
</div>
<div id="ref-Grumbach2022-zj" class="csl-entry" role="listitem">
Grumbach, Jacob M, and Charlotte Hill. 2022. <span>“<span class="nocase">Rock the Registration: Same Day Registration Increases Turnout of Young Voters</span>.”</span> <em>The Journal of Politics</em> 84 (1): 405–17.
</div>
</div></section></div></main> <!-- /main -->

<script>
  // htmlwidgets need to know to resize themselves when slides are shown/hidden.
  // Fire the "slideenter" event (handled by htmlwidgets.js) when the current
  // slide changes (different for each slide format).
  (function () {
    // dispatch for htmlwidgets
    function fireSlideEnter() {
      const event = window.document.createEvent("Event");
      event.initEvent("slideenter", true, true);
      window.document.dispatchEvent(event);
    }

    function fireSlideChanged(previousSlide, currentSlide) {
      fireSlideEnter();

      // dispatch for shiny
      if (window.jQuery) {
        if (previousSlide) {
          window.jQuery(previousSlide).trigger("hidden");
        }
        if (currentSlide) {
          window.jQuery(currentSlide).trigger("shown");
        }
      }
    }

    // hookup for slidy
    if (window.w3c_slidy) {
      window.w3c_slidy.add_observer(function (slide_num) {
        // slide_num starts at position 1
        fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);
      });
    }

  })();
</script>

<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>