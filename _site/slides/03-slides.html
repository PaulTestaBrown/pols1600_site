<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.549">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Paul Testa">

<title>POLS 1600 - Week 03:</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="../site_libs/htmlwidgets/htmlwidgets.js"></script>
<link href="../site_libs/datatables-css/datatables-crosstalk.css" rel="stylesheet">
<script src="../site_libs/datatables-binding/datatables.js"></script>
<script src="../site_libs/jquery/jquery-3.6.0.min.js"></script>
<link href="../site_libs/dt-core/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="../site_libs/dt-core/css/jquery.dataTables.extra.css" rel="stylesheet">
<script src="../site_libs/dt-core/js/jquery.dataTables.min.js"></script>
<link href="../site_libs/crosstalk/css/crosstalk.min.css" rel="stylesheet">
<script src="../site_libs/crosstalk/js/crosstalk.min.js"></script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">POLS 1600</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../syllabus.html"> 
<span class="menu-text">Syllabus</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../class/index.html"> 
<span class="menu-text">Class</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../assignments/index.html"> 
<span class="menu-text">Assignments</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
    <div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="03-slides.html"><i class="bi bi-file-slides"></i>RevealJS</a></li></ul></div></div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Week 03:</h1>
<p class="subtitle lead">Casual Inference in Experimental Designs</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Paul Testa </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<p>class: inverse, center, middle # Overview</p>
<section id="general-plan" class="level2">
<h2 class="anchored" data-anchor-id="general-plan">General Plan</h2>
<ul>
<li>Groups, Labs &amp; Tutorials</li>
<li>Feedback</li>
<li>Review</li>
<li>Lecture:
<ul>
<li>Causal inference</li>
<li>Notations to describe causal claims</li>
<li>Causal Identification</li>
<li>Causal Identification in experimental designs</li>
</ul></li>
</ul>
</section>
<section id="group-assignments" class="level2">
<h2 class="anchored" data-anchor-id="group-assignments">Group Assignments</h2>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item" id="htmlwidget-d0366b73c41ec88a390e" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-d0366b73c41ec88a390e">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4"],["Anna Lister","Kate Kuli","Andreas Young","Claudia Spelman"],["Elizabeth Steeves","Fabian Lopez","Lorenzo Mahoney","Ariana Palomo"],["Will Lake","Taha Siddiqui","Amanda Page","Noah Soutier"],["Georgia Kennedy-Bailey","Samuel Levine","Elie Lubin","Bianca Rosen"],["Theo Simmons","Fengyu Seah","Hunter Keneley","Schuyler Dubitsky"],["Logan Torres","Jonathan Zhang","Osiris Russell-Delano","Aicha Sama"],["Natalia Ibarra","Khaled Abdo","Starrchild Jackson","Selene Luna"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>Group 1<\/th>\n      <th>Group 2<\/th>\n      <th>Group 3<\/th>\n      <th>Group 4<\/th>\n      <th>Group 5<\/th>\n      <th>Group 6<\/th>\n      <th>Group 7<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"Group 1","targets":1},{"name":"Group 2","targets":2},{"name":"Group 3","targets":3},{"name":"Group 4","targets":4},{"name":"Group 5","targets":5},{"name":"Group 6","targets":6},{"name":"Group 7","targets":7}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
<section id="labs-tutorials" class="level2">
<h2 class="anchored" data-anchor-id="labs-tutorials">Labs &amp; Tutorials</h2>
<ul>
<li>Upload Lab 2 if you haven’t done so already</li>
<li>Same for Tutorials 0, 1, 2.
<ul>
<li>Some confusion on what to upload, so let’s do a quick demo.</li>
</ul></li>
</ul>
<p>class: inverse, center, middle background-image:url(“https://m.media-amazon.com/images/I/51vs7dtZnZL._AC_.jpg”) background-size:contain</p>
</section>
<section id="feedback" class="level1">
<h1>Feedback</h1>
<section id="what-do-we-like" class="level2">
<h2 class="anchored" data-anchor-id="what-do-we-like">What do we like</h2>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="htmlwidget-53c3fa9e6eec5ef62d1c" style="width:100%;height:90%;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-53c3fa9e6eec5ef62d1c">{"x":{"filter":"none","vertical":false,"fillContainer":false,"data":[["1","2","3","4","5","6","7","8","9","10","11"],["Good intro! Feels like I have a good basic grasp of R","Liked the hands-on aspect of the lab.","I like that we go through the meaning behind each code chunk.","I really enjoyed the hands-on work through the more complicated parts of understanding R, such as the pipe function and creating objects.","I fixed my errors eventually.","I really like when we work all together, and when there's lots of repetition for hotkeys, etc. I definitely need to hear things more than once to understand them.","I found the textbook very useful.","i like that, with the lab this week, there were opportunities to work through codings individually and as a group. it made me more confident about recoding data on my own.","I liked working through visualizing data in R. I feel like I have a better sense of how to approach creating useful graphs from datasets and breaking up the process into tangible steps.","I liked being engaged in class through lab.","I liked plotting (simple) graphs. It feels nice to see a tangible product of coding"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>Likes<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":4,"columnDefs":[{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"Likes","targets":1}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[4,10,25,50,100]}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
<section id="what-do-we-dislike" class="level2">
<h2 class="anchored" data-anchor-id="what-do-we-dislike">What do we dislike</h2>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="htmlwidget-f167680b22fad09d1b58" style="width:100%;height:90%;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-f167680b22fad09d1b58">{"x":{"filter":"none","vertical":false,"fillContainer":false,"data":[["1","2","3","4","5","6","7","8","9","10","11"],["Honestly mostly the temperature of the room. Also there was a little too much content and too little time","Wished the lab moved a little faster.","N/A","For a class full of beginner coders, there may be more details than they can handle. At the beginning of the course, I feel like labs can be a bit shorter so the students can understand the coding a bit better.","I had trouble thinking of every step and finding the correct slide","I'm worried that in the future I won't be able to finish the labs in time.","I think the pace of the class and the lack of explanations on the functions even though the repeated use of them made me confused.","I'm still confused about how the tutorials work. for this week, mine isn't loading the data in and I don't know where to get the data set.","Sometimes copying and pasting code is helpful, but I feel slightly unprepared to tackle processing and visualizing data from scratch.","What to do next in the lab wasn't always clear, I wish that the info would have been presented in a more straight forward way.","We're starting to enter functions/syntax is isn't as intuitive as simple arithmetic. But I'm not too concerned -- I'll get there with practice"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>Dislikes<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":4,"columnDefs":[{"orderable":false,"targets":0},{"name":" ","targets":0},{"name":"Dislikes","targets":1}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[4,10,25,50,100]}},"evals":[],"jsHooks":[]}</script>
</div>
</div>
</section>
<section id="learning-to-code" class="level2">
<h2 class="anchored" data-anchor-id="learning-to-code">Learning to code:</h2>
<ul>
<li>Thinking programattically
<ul>
<li>Chunk big problems into concrete tasks</li>
</ul></li>
<li>Use R Markdown to organize your code</li>
<li>Learn to troubleshoot errors</li>
<li>Don’t be afraid to FAAFO</li>
</ul>
</section>
<section id="whos-got-the-right-of-way" class="level2">
<h2 class="anchored" data-anchor-id="whos-got-the-right-of-way">Who’s got the right of way?</h2>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Data</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">Turn =</span> <span class="fu">str_wrap</span>(<span class="fu">as_factor</span>(Turn), <span class="at">width =</span> <span class="dv">15</span>)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>  )<span class="sc">%&gt;%</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Aesthetics</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(Turn,<span class="at">fill=</span>Turn))<span class="sc">+</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Geometries</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat=</span><span class="st">"count"</span>)<span class="sc">+</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Other layers</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>()<span class="sc">+</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">fill =</span>F)<span class="sc">+</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()<span class="sc">+</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y=</span><span class="st">""</span>,</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>       <span class="at">x=</span><span class="st">""</span>,</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">"Another car is turning left, who goes first at a red light?"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="whos-got-the-right-of-way-1" class="level2">
<h2 class="anchored" data-anchor-id="whos-got-the-right-of-way-1">Who’s got the right of way?</h2>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="03-slides_files/figure-revealjs/unnamed-chunk-7-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="review" class="level2">
<h2 class="anchored" data-anchor-id="review">Review</h2>
<ul>
<li>Set up</li>
<li>Data wrangling</li>
<li>Data visualization</li>
</ul>
</section>
<section id="setup" class="level2">
<h2 class="anchored" data-anchor-id="setup">Setup</h2>
<p>Every time you work in R</p>
<ul>
<li><p>Save your file to your course or project folder</p></li>
<li><p>Set your working directory</p></li>
<li><p>Load, and if needed, install packages</p></li>
<li><p>Maybe change some global options in your .Rmd file</p></li>
</ul>
</section>
<section id="setting-your-working-directory" class="level2">
<h2 class="anchored" data-anchor-id="setting-your-working-directory">Setting your working directory:</h2>
<ul>
<li>My default code for setting a working directory is:</li>
</ul>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Set working directory</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>wd <span class="ot">&lt;-</span> <span class="st">"."</span> <span class="co"># Change to file path on your computer</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="fu">setwd</span>(wd)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li><p>This is really just a reminder to someone else using my code that they need to have their working directories set up correctly</p></li>
<li><p>R Studio sets the working directory automatically, when you knit the file</p></li>
<li><p>When I work on a file, I set the working directory manually</p></li>
</ul>
</section>
<section id="setting-your-working-directory-when-working-live" class="level2">
<h2 class="anchored" data-anchor-id="setting-your-working-directory-when-working-live">Setting your working directory when working “Live”</h2>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://statisticsglobe.com/wp-content/uploads/2020/03/figure-2-set-working-directory-to-source-file-location-manually.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="packages-for-today" class="level2">
<h2 class="anchored" data-anchor-id="packages-for-today">Packages for today</h2>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>the_packages <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  <span class="do">## R Markdown</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">"kableExtra"</span>,<span class="st">"DT"</span>,</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Tidyverse</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">"tidyverse"</span>, <span class="st">"lubridate"</span>, <span class="st">"forcats"</span>, </span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>  <span class="st">"haven"</span>, <span class="st">"labelled"</span>,</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>  <span class="do">## Extensions for ggplot</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>  <span class="st">"ggmap"</span>,<span class="st">"ggrepel"</span>, <span class="st">"ggridges"</span>, </span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>  <span class="st">"ggthemes"</span>, <span class="st">"ggpubr"</span>, <span class="st">"GGally"</span>,</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>  <span class="st">"scales"</span>, <span class="st">"dagitty"</span>, <span class="st">"ggdag"</span>, <span class="co">#&lt;&lt;</span></span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Data </span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>  <span class="st">"COVID19"</span>,<span class="st">"maps"</span>,<span class="st">"mapdata"</span>,</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>  <span class="st">"qss"</span> <span class="co">#&lt;&lt;</span></span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="define-a-function-to-load-and-if-needed-install-packages" class="level2">
<h2 class="anchored" data-anchor-id="define-a-function-to-load-and-if-needed-install-packages">Define a function to load (and if needed install) packages</h2>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>ipak <span class="ot">&lt;-</span> <span class="cf">function</span>(pkg){</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>    new.pkg <span class="ot">&lt;-</span> pkg[<span class="sc">!</span>(pkg <span class="sc">%in%</span> <span class="fu">installed.packages</span>()[, <span class="st">"Package"</span>])]</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="fu">length</span>(new.pkg)) </span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>        <span class="fu">install.packages</span>(new.pkg, <span class="at">dependencies =</span> <span class="cn">TRUE</span>)</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">sapply</span>(pkg, require, <span class="at">character.only =</span> <span class="cn">TRUE</span>)</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="load-packages-for-today" class="level2">
<h2 class="anchored" data-anchor-id="load-packages-for-today">Load packages for today</h2>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ipak</span>(the_packages)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>kableExtra         DT  tidyverse  lubridate    forcats      haven   labelled 
      TRUE       TRUE       TRUE       TRUE       TRUE       TRUE       TRUE 
     ggmap    ggrepel   ggridges   ggthemes     ggpubr     GGally     scales 
      TRUE       TRUE       TRUE       TRUE       TRUE       TRUE       TRUE 
   dagitty      ggdag    COVID19       maps    mapdata        qss 
      TRUE       TRUE       TRUE       TRUE       TRUE       TRUE </code></pre>
</div>
</div>
<p>class:inverse, center, middle # 💪 ## Load the Covid-19 Data</p>
</section>
<section id="load-the-covid-19-data" class="level2">
<h2 class="anchored" data-anchor-id="load-the-covid-19-data">Load the Covid-19 Data</h2>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># covid &lt;- COVID19::covid19(</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="co">#   country = "US",</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="co">#   level = 2,</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="co">#   verbose = F</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="co"># )</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="fu">url</span>(<span class="st">"https://pols1600.paultesta.org/files/data/covid.rda"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="filter-the-covid-19-data-to-include-just-us-states" class="level2">
<h2 class="anchored" data-anchor-id="filter-the-covid-19-data-to-include-just-us-states">Filter the Covid-19 Data to include Just US States</h2>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Vector containing of US territories</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>territories <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">"American Samoa"</span>,</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Guam"</span>,</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Northern Mariana Islands"</span>,</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Puerto Rico"</span>,</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>  <span class="st">"Virgin Islands"</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter out Territories and create state variable</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>covid_us <span class="ot">&lt;-</span> covid <span class="sc">%&gt;%</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span>administrative_area_level_2 <span class="sc">%in%</span> territories)<span class="sc">%&gt;%</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">state =</span> administrative_area_level_2</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="setting-global-options" class="level2">
<h2 class="anchored" data-anchor-id="setting-global-options">Setting global options</h2>
<ul>
<li>Lets you control the default behavior of R and R Markdown
<ul>
<li>Do you want to print warnings when you knit?</li>
<li>How big should your figures be</li>
</ul></li>
<li>I’ll typically set these for you</li>
</ul>
</section>
<section id="the-global-options-for-these-slides" class="level2">
<h2 class="anchored" data-anchor-id="the-global-options-for-these-slides">The global options for these slides</h2>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">htmltools.dir.version =</span> <span class="cn">FALSE</span>)</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>knitr<span class="sc">::</span>opts_chunk<span class="sc">$</span><span class="fu">set</span>(</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">warning =</span> <span class="cn">FALSE</span>, </span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">message =</span> <span class="cn">FALSE</span>, </span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">comment =</span> <span class="cn">NA</span>, </span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">dpi =</span> <span class="dv">300</span>, <span class="at">fig.align =</span> <span class="st">"center"</span>, <span class="at">out.width =</span> <span class="st">"80%"</span>, </span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">cache =</span> <span class="cn">FALSE</span>) <span class="co">#&lt;&lt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="cacheing" class="level2">
<h2 class="anchored" data-anchor-id="cacheing">Cacheing</h2>
<ul>
<li><p>Sometimes I will turn <a href="https://bookdown.org/yihui/rmarkdown-cookbook/cache.html" target="_blank">cacheing</a> on (<code>cache=TRUE</code>)</p></li>
<li><p>When you knit with cache-ing, R saves the output of each codechunk</p></li>
<li><p>The next time you knit, if the code in a code chunk hasn’t changed, R just loads the saved output from the previous session, rather than re-running the code.</p></li>
<li><p>This is useful when <a href="https://bookdown.org/yihui/rmarkdown-cookbook/cache.html" target="_blank">a chunk of code takes a long time to run</a></p></li>
<li><p>This can potentially create errors, if you change something in one code chunk, but subsequent code are unchanged and load older versions of your code, that don’t have the thing you changed.</p></li>
<li><p>If this happens, try turning off the cacheing (<code>cache=F</code>) and rerunning your code. If your code works, can turn cache-ing back on.</p></li>
</ul>
</section>
<section id="data-transformations" class="level2">
<h2 class="anchored" data-anchor-id="data-transformations">Data transformations</h2>
<p>You want to:</p>
<ul>
<li><p>Load some data</p></li>
<li><p>Combine multiple functions</p></li>
<li><p>Look at your data</p></li>
<li><p>Recode your data</p></li>
<li><p>Transform your data</p></li>
</ul>
</section>
<section id="data-transformations-1" class="level2">
<h2 class="anchored" data-anchor-id="data-transformations-1">Data transformations</h2>
<p>.pull-left[ You want to:</p>
<ul>
<li><p>Load some data</p></li>
<li><p>Combine multiple functions</p></li>
<li><p>Look at your data</p></li>
<li><p>Recode your data</p></li>
<li><p>Transform your data ]</p></li>
</ul>
<p>.pull-right[ You could use</p>
<ul>
<li><p><code>read_*</code> functions</p></li>
<li><p><code>%&gt;%</code> the “pipe” operator</p></li>
<li><p><code>glimpse()</code> <code>head()</code>, <code>filter()</code>, <code>select()</code>, <code>arrange()</code></p></li>
<li><p><code>mutate()</code>, <code>case_when()</code>, <code>ifelse()</code></p></li>
<li><p><code>summarize()</code>, <code>group_by()</code></p></li>
</ul>
<p>]</p>
</section>
</section>
<section id="section" class="level1">
<h1>🔍</h1>
</section>
<section id="recoding-categorical-data-in-r" class="level1">
<h1>Recoding categorical data in R</h1>
<p>Let’s clarify what’s going on when we create the <code>face_masks</code> variable from the <code>facial_coverings</code> variable</p>
<ul>
<li>Why are we doing this</li>
<li>What does <code>mutate()</code> do</li>
<li>What does <code>case_when()</code> do</li>
<li>What does <code>factor()</code> do</li>
</ul>
<section id="why-are-we-doing-this" class="level2">
<h2 class="anchored" data-anchor-id="why-are-we-doing-this">Why are we doing this?</h2>
<p>When we looked at the raw data, <code>facial_coverings</code> was a numeric variable with both positive and negative values</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(covid_us<span class="sc">$</span>facial_coverings)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
   -4    -3    -2    -1     0     1     2     3     4 
  410  5897  7362   275  3893  8604 17424  9191   622 </code></pre>
</div>
</div>
</section>
<section id="why-are-we-doing-this-1" class="level2">
<h2 class="anchored" data-anchor-id="why-are-we-doing-this-1">Why are we doing this?</h2>
<p>Substantively, the absolute value of these numeric values correspond to increasingly restrictive face mask policies:</p>
<ul>
<li>0 - No policy</li>
<li>1 - Recommended</li>
<li>2 - Required in some specified shared/public spaces outside the home with other people present, or some situations when social distancing not possible</li>
<li>3 - Required in all shared/public spaces outside the home with other people present or all situations when social distancing not possible</li>
<li>4 - Required outside the home at all times regardless of location or presence of other people</li>
</ul>
<p>With negative values denoting “best guesses” of the policy in effect for most people in a state - Example: Illinois is coded as a negative 4 when Chicago adopts a stringent face mask policy</p>
</section>
<section id="why-are-we-doing-this-2" class="level2">
<h2 class="anchored" data-anchor-id="why-are-we-doing-this-2">Why are we doing this?</h2>
<ul>
<li>The numbers for these policies reflect an <em>ordinal</em> ranking:
<ul>
<li>No policy is less restrictive than Recommendations is less restrictive than requirements …</li>
</ul></li>
<li>Beyond this ordering, the numbers themselves don’t convey any additional meaning:
<ul>
<li>A partial requirement (2) is not “twice as restrictive” as a recommendation (1).</li>
</ul></li>
<li>How to treat statewide policies (positive numbers) vs mixed regimes (negative) is tricky
<ul>
<li>Ideally, we’d use more granular data (e.g.&nbsp;counties)</li>
<li>In practice, we’ll collapse this distinction in our code</li>
<li>As social scientists, we’d then want explore how our results change using alternative coding rules</li>
</ul></li>
<li>By converting the numeric <code>facial_coverings</code> variable into the categorical, ordered factor <code>face_masks</code> we get a variable that:
<ul>
<li>Has meaningful labels</li>
<li>Retains the substantive ordering of policies</li>
</ul></li>
</ul>
</section>
<section id="creating-the-face_masks-variable" class="level2">
<h2 class="anchored" data-anchor-id="creating-the-face_masks-variable">Creating the <code>face_masks</code> variable</h2>
<p>Here’s the snippet of code I’ve given you in the past:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>covid_us <span class="sc">%&gt;%</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mutate</span>(</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">face_masks =</span> <span class="fu">case_when</span>(</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>      facial_coverings <span class="sc">==</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">"No policy"</span>,</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">abs</span>(facial_coverings) <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">"Recommended"</span>,</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">abs</span>(facial_coverings) <span class="sc">==</span> <span class="dv">2</span> <span class="sc">~</span> <span class="st">"Some requirements"</span>,</span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">abs</span>(facial_coverings) <span class="sc">==</span> <span class="dv">3</span> <span class="sc">~</span> <span class="st">"Required shared places"</span>,</span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">abs</span>(facial_coverings) <span class="sc">==</span> <span class="dv">4</span> <span class="sc">~</span> <span class="st">"Required all times"</span>,</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> <span class="fu">factor</span>(.,</span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>      <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"No policy"</span>,<span class="st">"Recommended"</span>,</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"Some requirements"</span>,</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"Required shared places"</span>,</span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"Required all times"</span>)</span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>    ) </span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>    ) <span class="ot">-&gt;</span> covid_us</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="creating-the-face_masks-variable-1" class="level2">
<h2 class="anchored" data-anchor-id="creating-the-face_masks-variable-1">Creating the <code>face_masks</code> variable</h2>
<p>Here’s a slightly clearer way of doing the same thing</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>covid_us <span class="sc">%&gt;%</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mutate</span>(</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Recode facial_coverings to create face_masks</span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">face_masks =</span> <span class="fu">case_when</span>(</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>      facial_coverings <span class="sc">==</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">"No policy"</span>,</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">abs</span>(facial_coverings) <span class="sc">==</span> <span class="dv">1</span> <span class="sc">~</span> <span class="st">"Recommended"</span>,</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">abs</span>(facial_coverings) <span class="sc">==</span> <span class="dv">2</span> <span class="sc">~</span> <span class="st">"Some requirements"</span>,</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>      <span class="fu">abs</span>(facial_coverings) <span class="sc">==</span> <span class="dv">3</span> <span class="sc">~</span> <span class="st">"Required shared places"</span>,</span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a>      <span class="fu">abs</span>(facial_coverings) <span class="sc">==</span> <span class="dv">4</span> <span class="sc">~</span> <span class="st">"Required all times"</span>,</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a>    ),</span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Turn face_masks into a factor with ordered policy levels</span></span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">face_masks =</span> <span class="fu">factor</span>(face_masks,</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>      <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"No policy"</span>,<span class="st">"Recommended"</span>,</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"Some requirements"</span>,</span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"Required shared places"</span>,</span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a>                 <span class="st">"Required all times"</span>)</span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>    ) </span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>    ) <span class="ot">-&gt;</span> covid_us</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="understanding-what-case_when-does" class="level2">
<h2 class="anchored" data-anchor-id="understanding-what-case_when-does">Understanding what <code>case_when()</code> does</h2>
<p>Let’s take a (pseudo) random slice of our data:</p>
<div class="cell" data-layout-align="center" data-highlight.output="[4,8,9]">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>covid_us <span class="sc">%&gt;%</span></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(date, state, facial_coverings, face_masks)<span class="sc">%&gt;%</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">dim</span>(covid_us)[<span class="dv">1</span>], <span class="at">size=</span><span class="dv">10</span>, <span class="at">replace =</span> F))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         date         state facial_coverings             face_masks
1  2020-04-26      Maryland                2      Some requirements
2  2022-04-25       Florida                1            Recommended
3  2020-12-16     Tennessee               -3 Required shared places
4  2020-05-15     Tennessee                1            Recommended
5  2021-09-18      Arkansas               -2      Some requirements
6  2021-09-08       Florida               -2      Some requirements
7  2020-07-11        Alaska               -3 Required shared places
8  2020-07-07 New Hampshire               -2      Some requirements
9  2022-09-11      Nebraska                2      Some requirements
10 2020-04-06        Oregon                1            Recommended</code></pre>
</div>
</div>
</section>
<section id="understanding-all-that-other-stuff-did" class="level2">
<h2 class="anchored" data-anchor-id="understanding-all-that-other-stuff-did">Understanding all that other stuff did</h2>
<p>.pull-left[ - <code>set.seed(123)</code> sets the “seed” that your computer uses to generate pseudo random numbers - <code>select()</code> selects just the <code>date</code>, <code>state</code>, <code>facial_coverings</code>, and <code>face_masks</code> columns from the data - <code>slice()</code> selects a slice of rows from the data - <code>sample()</code> takes random sample from the sequence of numbers 1 to 40,889 (<code>dim(covid_us)</code>) of size 10, without replacement (no duplicates), which <code>slice()</code> interprets as the rows you want to select</p>
<p>]</p>
<p>.pull-right[</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>covid_us <span class="sc">%&gt;%</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(date, state, facial_coverings, face_masks)<span class="sc">%&gt;%</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">dim</span>(covid_us)[<span class="dv">1</span>], <span class="at">size=</span><span class="dv">10</span>, <span class="at">replace =</span> F))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>]</p>
</section>
<section id="data-visualization" class="level2">
<h2 class="anchored" data-anchor-id="data-visualization">Data visualization</h2>
<p>A basic graphic requires at minimum:</p>
<ul>
<li><code>data:</code> the dataset containing the variables of interest.</li>
<li><code>aes</code>: aesthetic attributes of the geometric object. For example, x/y position, color, shape, and size. Aesthetic attributes are mapped to variables in the dataset.</li>
<li><code>geom:</code> the geometric object in question. This refers to the type of object we can observe in a plot For example: points, lines, and bars.</li>
</ul>
</section>
<section id="data-visualization-1" class="level2">
<h2 class="anchored" data-anchor-id="data-visualization-1">Data visualization</h2>
<p>Basic graphics are made even better with:</p>
<ul>
<li><code>facets</code></li>
<li><code>statistics</code></li>
<li><code>coordinates</code></li>
<li><code>themes</code></li>
</ul>
</section>
<section id="topics" class="level2">
<h2 class="anchored" data-anchor-id="topics">Topics</h2>
<ul>
<li><p>Causal inference</p></li>
<li><p>Notations to describe causal claims</p>
<ul>
<li>Potential Outcomes</li>
<li>Directed Acyclic Graphs</li>
</ul></li>
<li><p>Causal Identification</p>
<ul>
<li>Experimental designs (this week)</li>
<li>Observational designs (next week)</li>
</ul></li>
<li><p>Causal Identification in Experimental Designs</p>
<ul>
<li>How random assignment creates credible counter factual comparisons</li>
</ul></li>
</ul>
</section>
<section id="exercises" class="level2">
<h2 class="anchored" data-anchor-id="exercises">Exercises</h2>
<ol type="1">
<li><p>What kinds questions have causal interpretations?</p></li>
<li><p>Estimating an average treatment effect with the <code>resume</code> data</p></li>
<li><p>Exploring the data for Broockman and Kalla 2016</p></li>
</ol>
<p>class: inverse, center, middle # 💡 # Causal Inference ## <em>Causal claims imply counterfactual comparisons</em></p>
</section>
<section id="causal-claims-imply-counterfactual-comparisons" class="level2">
<h2 class="anchored" data-anchor-id="causal-claims-imply-counterfactual-comparisons">Causal claims imply counterfactual comparisons</h2>
<ul>
<li>Causal claims imply claims about counterfactuals
<ul>
<li>What would have happened if we were to change some aspect of the world?</li>
</ul></li>
</ul>
<p>–</p>
<p>What’s the counter factual for these claims:</p>
<p>–</p>
<ul>
<li>Foreign aid increases develop</li>
</ul>
<p>–</p>
<ul>
<li>Wikileaks cost Hillary Clinton the 2016 election</li>
</ul>
<p>–</p>
<ul>
<li>Democracies don’t fight wars with other democracies</li>
</ul>
<p>–</p>
<ul>
<li>Universal Pre-K improves child development</li>
</ul>
</section>
<section id="casual-claims-are-are-all-around-us" class="level2">
<h2 class="anchored" data-anchor-id="casual-claims-are-are-all-around-us">Casual claims are are all around us</h2>
<p>.pull-left[</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://images-na.ssl-images-amazon.com/images/I/A1qhBebbu6L.jpg" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%"></p>
</figure>
</div>
</div>
</div>
<p>]</p>
<p>–</p>
<p>.pull-right[</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://press.uchicago.edu/.imaging/mte/ucp/medium/dam/ucp/books/jacket/978/02/26/11/9780226112374.jpg/jcr:content/9780226112374.jpg" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%"></p>
</figure>
</div>
</div>
</div>
<p>]</p>
</section>
<section id="casual-claims-are-are-all-around-us-1" class="level2">
<h2 class="anchored" data-anchor-id="casual-claims-are-are-all-around-us-1">Casual claims are are all around us</h2>
<p>What are some questions that interest you?</p>
<p>What are the counterfactual comparisons they imply?</p>
<p>class: inverse, center, middle # 💡 # Notations to describe causal claims</p>
<p>In this course, we will use two forms of notation to describe our causal claims.</p>
<ul>
<li><p>Directed Acyclic Graphs</p></li>
<li><p>Potential Outcomes Notation</p></li>
</ul>
</section>
<section id="directed-acyclic-graphs" class="level2">
<h2 class="anchored" data-anchor-id="directed-acyclic-graphs">Directed Acyclic Graphs</h2>
<ul>
<li><p>Directed Acyclic Graphs provide a way of encoding assumptions about casual relationships</p>
<ul>
<li><p><strong>Directed</strong> Arrows <span class="math inline">\(\to\)</span> describe a direct causal effect</p></li>
<li><p>Arrow from <span class="math inline">\(D\to Y\)</span> means <span class="math inline">\(Y_i(d) \neq Y_i(d^\prime)\)</span> “The outcome ( <span class="math inline">\(Y\)</span>) for person <span class="math inline">\(i\)</span> when D happens ( <span class="math inline">\(Y_i(d)\)</span> ) is different than the the outcome when <span class="math inline">\(D\)</span> doesn’t happen ( <span class="math inline">\(Y_i(d^\prime)\)</span> )</p></li>
<li><p>No arrow = no effect ( <span class="math inline">\(Y_i(d) = Y_i(d^\prime)\)</span> )</p></li>
<li><p><strong>Acyclic:</strong> No cycles. A variable can’t cause itself</p></li>
</ul></li>
<li><p>Used by Pearl (<a href="http://bayes.cs.ucla.edu/jp_home.html" target="_blank">2009</a>, <a href="http://bayes.cs.ucla.edu/jp_home.html" target="_blank">2017</a>) to describe and assess causal structural models</p></li>
</ul>
<blockquote class="blockquote">
<p>Basically, they’re math’s fancy pants version of a flow chart</p>
</blockquote>
</section>
<section id="why-we-use-directed-acyclic-graphs" class="level2">
<h2 class="anchored" data-anchor-id="why-we-use-directed-acyclic-graphs">Why we use Directed Acyclic Graphs</h2>
<ul>
<li><p>Directed Acyclic Graphs are flexible ways of representing complex relationships</p></li>
<li><p>They’re great for illustrating sources of potential bias in our models:</p></li>
<li><p>Two types of bias we’ll talk about today:</p>
<ul>
<li><p><strong>Confounder bias:</strong> Bias that exists because two variables have a <em>common cause</em></p></li>
<li><p><strong>Collider bias:</strong> Bias we create when we condition on a <em>common consequence</em></p></li>
</ul></li>
</ul>
</section>
<section id="what-do-we-mean-by-bias" class="level2">
<h2 class="anchored" data-anchor-id="what-do-we-mean-by-bias">What do we mean by bias</h2>
<p>We’ll talk about lots of types of bias throughout this course.</p>
<p>Formally, we’ll say an estimate, <span class="math inline">\(\hat{\theta}\)</span> (“theta hat”) is an unbiased estimator of a parameter, <span class="math inline">\(\theta\)</span> (“theta”) if:</p>
<p><span class="math display">\[
E[\hat{\theta}] = \theta
\]</span></p>
<p>Bias or error, <span class="math inline">\(\epsilon\)</span>, is the difference between our estimate and the truth</p>
<p><span class="math display">\[
\epsilon = \hat{\theta} -\theta
\]</span></p>
<p>An estimator is unbiased if, on average, the errors equal 0</p>
<p><span class="math display">\[
E[\epsilon] = E[\hat{\theta} -\theta] = 0
\]</span></p>
</section>
<section id="bias-vs.-variance" class="level2">
<h2 class="anchored" data-anchor-id="bias-vs.-variance">Bias vs.&nbsp;variance</h2>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://www.cs.cornell.edu/courses/cs4780/2018fa/lectures/images/bias_variance/bullseye.png" class="quarto-figure quarto-figure-center figure-img" style="width:80.0%;height:80.0%"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="the-bias-variance-tradeoff" class="level2">
<h2 class="anchored" data-anchor-id="the-bias-variance-tradeoff">The Bias-Variance Tradeoff</h2>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="http://scott.fortmann-roe.com/docs/docs/BiasVariance/biasvariance.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="drawing-dags-in-r" class="level2">
<h2 class="anchored" data-anchor-id="drawing-dags-in-r">Drawing DAGs in R</h2>
<ul>
<li><p>Let’s draw some dags to consider some simple examples:</p>
<ul>
<li><p>Does drinking coffee cause lung cancer? (Confounding bias)</p></li>
<li><p>Does chicken pox cause influenza? (Collider bias)</p></li>
</ul></li>
<li><p>Nice examples of DAGs from <a href="https://ggdag.malco.io/index.html" target="_blank">ggdag</a></p></li>
</ul>
<section id="confounding-common-causes" class="level3">
<h3 class="anchored" data-anchor-id="confounding-common-causes">Confounding = Common Causes</h3>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="03-slides_files/figure-revealjs/unnamed-chunk-25-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="controlling-for-a-confounding-variable" class="level3">
<h3 class="anchored" data-anchor-id="controlling-for-a-confounding-variable">Controlling for a confounding variable</h3>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="03-slides_files/figure-revealjs/unnamed-chunk-26-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="colliders-common-consequence" class="level3">
<h3 class="anchored" data-anchor-id="colliders-common-consequence">Colliders = Common Consequence</h3>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="03-slides_files/figure-revealjs/unnamed-chunk-27-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="dont-condition-on-a-collider" class="level3">
<h3 class="anchored" data-anchor-id="dont-condition-on-a-collider">Don’t Condition on a Collider</h3>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="03-slides_files/figure-revealjs/unnamed-chunk-28-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="dont-condition-on-a-collider-1" class="level3">
<h3 class="anchored" data-anchor-id="dont-condition-on-a-collider-1">Don’t Condition on a Collider</h3>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="03-slides_files/figure-revealjs/unnamed-chunk-29-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="potential-outcomes" class="level2">
<h2 class="anchored" data-anchor-id="potential-outcomes">Potential Outcomes</h2>
<ul>
<li><p>DAGs are great for representing a wide array of relationships</p></li>
<li><p>Doing <a href="https://mixtape.scunning.com/dag.html" target="_blank">causal inference with DAGs</a> is a bit beyond the scope of this class</p></li>
<li><p>Instead, we’ll typically talk about causal claims using the logic of potential outcomes to describe the counterfactual comparisons we want to make.</p></li>
<li><p>To do this, we’ll need to get comfortable with some basic notation.</p></li>
</ul>
</section>
<section id="some-general-notes-on-notation" class="level2">
<h2 class="anchored" data-anchor-id="some-general-notes-on-notation">Some general notes on notation</h2>
<ul>
<li><p>Notation can seem scary, overwhelming, confusing.</p></li>
<li><p>Notation can be incredibly helpful for communicating precisely and clearly</p></li>
<li><p>Our goal is to demystify notation</p></li>
</ul>
</section>
<section id="general-notation-populations-and-samples" class="level2">
<h2 class="anchored" data-anchor-id="general-notation-populations-and-samples">General Notation: Populations and Samples</h2>
<ul>
<li><span class="math inline">\(U\)</span>: Population of units:
<ul>
<li>Finite population <span class="math inline">\(U = {1,2,3,\dots,N}\)</span></li>
<li>Infinite super population <span class="math inline">\(U = {1,2,3,\dots,\infty}\)</span></li>
</ul></li>
<li><span class="math inline">\(S\)</span>: sample of size <span class="math inline">\(n\)</span> from population <span class="math inline">\(U\)</span></li>
</ul>
</section>
<section id="general-notation-outcome-variables" class="level2">
<h2 class="anchored" data-anchor-id="general-notation-outcome-variables">General Notation: Outcome Variables</h2>
<ul>
<li><span class="math inline">\(Y_i\)</span>: Observed outcome from unit <span class="math inline">\(i\)</span>
<ul>
<li><span class="math inline">\(Y_i\)</span> might be whether persion <span class="math inline">\(i\)</span>, call them Paul has Covid while <span class="math inline">\(Y_j\)</span> would be whether person <span class="math inline">\(j\)</span>, call them Aleks has Covid</li>
</ul></li>
</ul>
</section>
<section id="general-notation-treatment-variables" class="level2">
<h2 class="anchored" data-anchor-id="general-notation-treatment-variables">General Notation: Treatment Variables</h2>
<ul>
<li><span class="math inline">\(D_i\)</span>: An indicator for the receipt of treatment. <span class="math inline">\(D_i\)</span> = 1 if treated, <span class="math inline">\(D_i\)</span> = 0 if untreated,
<ul>
<li><span class="math inline">\(D_i = 0\)</span> means Paul got the placebo in a vaccine trial</li>
<li><span class="math inline">\(D_i = 1\)</span> means Paul got the vaccine</li>
<li>Generalizes to multiple treatments <span class="math inline">\(D \in \{0,1,2,3, \dots\}\)</span></li>
</ul></li>
<li><span class="math inline">\(Z_i\)</span>: An indicator for the assignment of treatment. <span class="math inline">\(Z_i\)</span> = 1 if assigned to treatment, <span class="math inline">\(Z_i\)</span> = 0 if assigned to control,
<ul>
<li><span class="math inline">\(Z_i = 1\)</span> means Paul was assigned to receive the vaccine. Whether Paul got the vaccine depends on <span class="math inline">\(D_i\)</span></li>
</ul></li>
</ul>
</section>
<section id="general-notation-observed-and-unobserved-covariates" class="level2">
<h2 class="anchored" data-anchor-id="general-notation-observed-and-unobserved-covariates">General Notation: Observed and Unobserved Covariates</h2>
<ul>
<li><span class="math inline">\(X_i\)</span> pre-treatment covariates.
<ul>
<li><span class="math inline">\(X_i\)</span> might be Paul’s age, or gender, or partisan affiliation</li>
<li>Pre-treatment refers to things that are determined before the treatment is assigned and therefore cannot be influenced by the treatment</li>
</ul></li>
<li><span class="math inline">\(U_i\)</span> unobserved potential confounds
<ul>
<li><span class="math inline">\(_i\)</span> might be something we didn’t or can’t measure like Paul’s genome or general crankiness</li>
</ul></li>
</ul>
</section>
<section id="general-notation-expected-values" class="level2">
<h2 class="anchored" data-anchor-id="general-notation-expected-values">General Notation: Expected Values</h2>
<ul>
<li><p>The <span class="math inline">\(E[Y]\)</span> reads as “the expected value of Y”</p></li>
<li><p><span class="math inline">\(E[Y]\)</span> is defined as a probability weighted average based on the uncoditional probability of Y ( <span class="math inline">\(f(y)\)</span> )</p></li>
</ul>
<p><span class="math display">\[\operatorname{E}[Y] = \int_{-\infty}^\infty y f(y)\, dy\]</span></p>
</section>
<section id="general-notation-conditional-expectations" class="level2">
<h2 class="anchored" data-anchor-id="general-notation-conditional-expectations">General Notation: Conditional Expectations</h2>
<ul>
<li><p>The <span class="math inline">\(E[Y|X=x]\)</span> reads as “the expected value of Y conditional on the value of X”</p></li>
<li><p><span class="math inline">\(E[Y|X=x]\)</span> is defined as a probability weighted average of Y based on the conditional probability of Y given X ( <span class="math inline">\(y f_{Y|X}(y|x)\)</span> )</p></li>
</ul>
<p><span class="math display">\[\operatorname{E}[Y \vert X=x] = \int_{-\infty}^\infty y f (y\vert x) \, dy\]</span></p>
</section>
<section id="general-notation-expected-values-1" class="level2">
<h2 class="anchored" data-anchor-id="general-notation-expected-values-1">General Notation: Expected Values</h2>
<ul>
<li><p>Don’t worry about the math in this course.</p></li>
<li><p>We’ll talk more expected values during our discussion of probability</p></li>
<li><p>For now, just think of <span class="math inline">\(E[Y]\)</span> and <span class="math inline">\(E[Y|X=x]\)</span> as a theoretical averages which we can estimate from the empirical means in our data (<code>mean(data$y)</code>, <code>mean(data$y[data$x == 1]</code>))</p></li>
</ul>
</section>
<section id="potential-outcomes-notation" class="level2">
<h2 class="anchored" data-anchor-id="potential-outcomes-notation">Potential Outcomes Notation:</h2>
<ul>
<li>Potential outcomes notation is a way of describing counterfactuals</li>
</ul>
<p>–</p>
<ul>
<li><p><span class="math inline">\(Y_i(d)\)</span> is the value of the outcome if <span class="math inline">\(D_i\)</span> was <span class="math inline">\(d\)</span></p>
<ul>
<li><p><span class="math inline">\(Y_i(1)\)</span> is the vote share of Rep.&nbsp;Smith when they support #MeToo</p></li>
<li><p><span class="math inline">\(Y_i(0)\)</span> is the vote share of Rep.&nbsp;Smith when they do not support #MeToo.</p></li>
</ul></li>
</ul>
<p>–</p>
<ul>
<li>Potential outcomes are fixed, but we only observe one (of many) potential outcomes <span class="math inline">\(\to\)</span> <em>Fundamental Problem of Causal Inferenece</em></li>
</ul>
</section>
<section id="fundamental-problem-of-causal-infernece" class="level2">
<h2 class="anchored" data-anchor-id="fundamental-problem-of-causal-infernece">Fundamental Problem of Causal Infernece</h2>
<p>The individual causal effect (ICE), <span class="math inline">\(\tau_i\)</span>, of some treatment <span class="math inline">\(d_i\)</span> on some observation <span class="math inline">\(i\)</span> is</p>
<p><span class="math display">\[
\tau_i \equiv Y_i(1) - Y_i(0)
\]</span></p>
<ul>
<li><p>The <strong>fundamental problem of causal inference</strong> is that we only ever see one potential outcome for an individual, and so it’s <strong>impossible to know</strong> the causal effect of some intervention for that individual</p></li>
<li><p>The ICE is unidentified</p></li>
<li><p>Example:</p>
<ul>
<li>Paul got the vaccine. The individual effect of the vaccine on Paul is the difference in his health status when he got the vaccine compared to his health status when he got the placebo. But we only observe one of these two potential outcomes.</li>
</ul></li>
</ul>
<p>class: inverse, center, middle # 💡 # Causal Identification ## <em>What assumptions do we need to make for a causal claim to be credible</em></p>
</section>
<section id="identification" class="level2">
<h2 class="anchored" data-anchor-id="identification">Identification</h2>
<ul>
<li><p>Identification refers to what we can learn from the data available</p></li>
<li><p>A quantity of interest is <em>identified</em> if, with infinite data it can only take one value</p></li>
<li><p>Mathematically, we’ll sometimes say a coefficient in an equation is unidentified if</p>
<ul>
<li>We have more predictors than observations, or</li>
<li>Some of predictors are linear combinations of other predictors.</li>
</ul></li>
</ul>
</section>
<section id="causal-identification" class="level2">
<h2 class="anchored" data-anchor-id="causal-identification">Causal Identification</h2>
<ul>
<li><p><strong>Casual Identification</strong> refers to “the assumptions needed for statistical estimates to be given a causal interpretation” <a href="http://lukekeele.com/wp-content/uploads/2016/03/causal.pdf" target="_blank">Keele (2015)</a></p></li>
<li><p><strong>What’s Your Casual Identification Strategy:</strong> What are the assumptions that make your research design credible?</p></li>
<li><p>Identification &gt; Estimation</p></li>
</ul>
</section>
<section id="observational-vs-experimental-designs" class="level2">
<h2 class="anchored" data-anchor-id="observational-vs-experimental-designs">Observational vs Experimental Designs</h2>
<ul>
<li><p><strong>Experimental designs</strong> are studies in which a causal variable of interest, the <em>treatement</em>, is manipulated by the researcher to examine its causal effects on some <em>outcome</em> of interest</p></li>
<li><p><strong>Observational designs</strong> are studies in which a causal variable of interest is assigned by someone other than the researcher (nature, governments, people)</p></li>
</ul>
<p>class: inverse, center, middle # 💡 # Causal Identification in Experimental Designs</p>
</section>
<section id="the-fpoci-is-a-problem-of-missing-data" class="level2">
<h2 class="anchored" data-anchor-id="the-fpoci-is-a-problem-of-missing-data">The FPoCI is a problem of missing data</h2>
<p>That an individual causal effect <span class="math inline">\(\tau_i\)</span>, is defined as:</p>
<p><span class="math display">\[
\tau_i \equiv Y_i(1) - Y_i(0)
\]</span></p>
<p>The problem is that for any one individual, we only observe <span class="math inline">\(Y_i(1)\)</span> or <span class="math inline">\(Y_i(0)\)</span>, but never both.</p>
<ul>
<li>If Paul got the vaccine <span class="math inline">\((Y_{Paul}(Vaxxed)=\text{Covid Free})\)</span>, then we don’t know what Paul’s health status would have been, had he not got the vaccine <span class="math inline">\((Y_{Paul}(Unvaxxed) =???)\)</span></li>
</ul>
</section>
<section id="a-statistical-solution-to-the-fpoci" class="level2">
<h2 class="anchored" data-anchor-id="a-statistical-solution-to-the-fpoci">A statistical solution to the FPoCI</h2>
<p>Rather than individual causal effects:</p>
<p><span class="math display">\[
\tau_i \equiv Y_i(1) - Y_i(0)
\]</span></p>
<p>Focus on average causal effects</p>
<p><span class="math display">\[
E[\tau_i] = \overbrace{E[Y_i(1) - Y_i(0)]}^{\text{Average of a difference}} = \overbrace{E[Y_i(1)] - E[Y_i(0)]}^{\text{Difference of Averages}}
\]</span></p>
<p>When does the difference of averages provide us with a good estimate of the average difference?</p>
</section>
<section id="the-hospital-example" class="level2">
<h2 class="anchored" data-anchor-id="the-hospital-example">The hospital example</h2>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="https://i.pinimg.com/originals/1d/1e/dd/1d1eddaa79918e9cca7e7dc857d95ffe.jpg" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="the-hospital-example-1" class="level2">
<h2 class="anchored" data-anchor-id="the-hospital-example-1">The hospital example</h2>
<p>Want to know the effect of going to the hospital on people need to go to the hospital</p>
<p><span class="math display">\[
\text{What we want} = E[Y(1|D=1) - Y(0|D=1)]
\]</span></p>
<p><span class="math display">\[
\text{What we want} = E[\text{Mortality}(\text{Hospital}|\text{Sick}) - \text{Mortality}(\text{No Hospital}|\text{Sick})]
\]</span></p>
</section>
<section id="the-hospital-example-2" class="level2">
<h2 class="anchored" data-anchor-id="the-hospital-example-2">The hospital example</h2>
<p>Instead we might end up comparing outcomes among the sick and non-sick</p>
<p><span class="math display">\[\text{What we estimate} = E[Y(1|D=1)] - E[Y(0|D=0)]\]</span></p>
<p><span class="math display">\[\text{What we estimate} = E[\text{Mortality}(\text{Hospital})] - E[\text{Mortality}(\text{No Hospital})]\]</span></p>
</section>
<section id="selection-bias" class="level2">
<h2 class="anchored" data-anchor-id="selection-bias">Selection bias</h2>
<p>The hospital example illustrates the general problem of selection bias</p>
<p><span class="math display">\[\widehat{SATE}=\overbrace{\textbf{E[Y(1)|D=1]} - E[Y(0)|D=1]}^{\text{Average Effect of Treatment on Treated}}\\
\underbrace{+ E[Y(0)|D=1]- \textbf{E[Y(0)|D=0]}}_{\text{Selection Bias}}\]</span></p>
<ul>
<li>The bold quantities are things we can <strong>observe</strong> (estimate)</li>
<li><span class="math inline">\(E[Y(0)|D=1]\)</span> is a an unobservable counterfactual.</li>
<li>It’s the average health outcomes of people who went to the hospital <span class="math inline">\((D=1)\)</span> if they hadn’t <span class="math inline">\((Y(0)|D=1)\)</span></li>
</ul>
</section>
<section id="selection-bias-1" class="level2">
<h2 class="anchored" data-anchor-id="selection-bias-1">Selection bias</h2>
<ul>
<li><p>Adding and subtracting <span class="math inline">\(E[Y(0)|D=1]\)</span> thing doesn’t change the equation but it allows us to write what we can estimate in terms of two quantities:</p></li>
<li><p>The <strong>Average Treatment Effect on the Treated:</strong> <span class="math inline">\(\mathbf{E[Y(1)|D=1]} - E[Y(0)|D=1]\)</span></p>
<ul>
<li>This is what we <strong>want to know</strong> if we want to make causal claims about the effect of health care</li>
</ul></li>
<li><p><strong>Selection Bias:</strong> <span class="math inline">\(E[Y(0)|D=1] - \mathbf{E[Y(0)|D=0]}\)</span>,</p>
<ul>
<li>This is the difference in health outcomes between healthy folks who didn’t go to the hospital <span class="math inline">\((Y(0)|D=0)\)</span> and sick folks who went to the hopsital had they not gone <span class="math inline">\((Y(0)|D=1)\)</span></li>
<li>This what <strong>confounds our causal claims</strong> if we just compare outcomes among people who went to the hospital and people who didn’t</li>
<li>Selection bias equals 0 if <span class="math inline">\(E[Y(0)|D=1] = \mathbf{E[Y(0)|D=0]}\)</span></li>
<li><span class="math inline">\(E[Y(0)|D=1] = \mathbf{E[Y(0)|D=0]}\)</span> if <strong>D has been randomly assigned</strong></li>
</ul></li>
</ul>
</section>
<section id="random-assignment-solves-the-problem-of-selection-bias" class="level2">
<h2 class="anchored" data-anchor-id="random-assignment-solves-the-problem-of-selection-bias">Random Assignment “Solves” the Problem of Selection Bias</h2>
<p>Randomly assigning treatments creates <em>statistical independence</em> <span class="math inline">\((\unicode{x2AEB})\)</span> between treatment ( <span class="math inline">\(D\)</span> ) and potential outcomes ( <span class="math inline">\(Y(1),Y(0)\)</span> ) as well as any observed ( <span class="math inline">\(X\)</span> ) or unobserved confounders ( <span class="math inline">\(U\)</span> ):</p>
<p><span class="math display">\[Y_i(1),Y_i(0),\mathbf{X_i},\mathbf{U_i} \unicode{x2AEB} D_i\]</span></p>
</section>
<section id="random-assignment-solves-the-problem-of-selection-bias-1" class="level2">
<h2 class="anchored" data-anchor-id="random-assignment-solves-the-problem-of-selection-bias-1">Random Assignment “Solves” the Problem of Selection Bias</h2>
<p>When treatment has been randomly assigned, what we can observe ( <span class="math inline">\(E[Y_i|D=0], E[Y_i|D=1]\)</span> ), provides good (unbiased) estimates of theoretical quantities we want observe</p>
<p><span class="math display">\[E[Y_i|D=0] = E[Y_i(0)|D=0] = E[Y_i(0)] = E[Y_i(0)|D=1]\]</span></p>
<p><span class="math display">\[E[Y_i|D=1] = E[Y_i(1)|D=1] = E[Y_i(1)] = E[Y_i(1)|D=0]\]</span></p>
</section>
<section id="estimating-an-average-treatment-effect" class="level2">
<h2 class="anchored" data-anchor-id="estimating-an-average-treatment-effect">Estimating an Average Treatment Effect</h2>
<p>If we treatment as been randomly assigned, we can estimate the ATE by taking the difference of means between treatment and control:</p>
<p><span class="math display">\[
\begin{align*}
E \left[ \frac{\sum_1^m Y_i}{m}-\frac{\sum_{m+1}^N Y_i}{N-m}\right]&amp;=\overbrace{E \left[ \frac{\sum_1^m Y_i}{m}\right]}^{\substack{\text{Average outcome}\\
\text{among treated}\\ \text{units}}}
-\overbrace{E \left[\frac{\sum_{m+1}^N Y_i}{N-m}\right]}^{\substack{\text{Average outcome}\\
\text{among control}\\ \text{units}}}\\
&amp;= E [Y_i(1)|D_i=1] -E[Y_i(0)|D_i=0]
\end{align*}
\]</span></p>
<p>That is, the ATE is causally identified by the <strong>difference of means</strong> estimator in an experimental design</p>
</section>
<section id="causal-identification-with-experimental-designs" class="level2">
<h2 class="anchored" data-anchor-id="causal-identification-with-experimental-designs">Causal Identification with Experimental Designs</h2>
<p>Causal identification for an experiment, requires very few assumptions:</p>
<p>–</p>
<ul>
<li><strong>Independence</strong> (Satisfied by Randomization)
<ul>
<li><span class="math inline">\(Y(1), Y(0),X,U, \perp D\)</span></li>
</ul></li>
<li><strong>SUTVA</strong> Stable Unit Treatment Value Assumption (Depends on features of the design)
<ul>
<li>No interference between units <span class="math inline">\(Y_i(d_1, d_2, \dots, d_N) = Y_i(d_i)\)</span></li>
<li>No hidden values of the treatment/Variation in the treatment</li>
</ul></li>
</ul>
</section>
<section id="random-assignment-creates-testable-implications" class="level2">
<h2 class="anchored" data-anchor-id="random-assignment-creates-testable-implications">Random Assignment creates testable implications</h2>
<ul>
<li>If treatment has been randomly assigned, we would expect that there should be few differences between <strong>pre-treatment covariates</strong> in our treatment and control groups.</li>
</ul>
<p>–</p>
<ul>
<li>That is, on average, the only the thing that should differ between these groups is that one group got the treatment and one group did not.</li>
</ul>
<p>–</p>
<ul>
<li>If the treatment had an effect, than we can credibly claim that that effect was due to the presence or absence of the treatment, and not some alternative explanation.</li>
</ul>
<p>–</p>
<ul>
<li>This type of clean counterfactual comparison is what people mean when they talk about an <em>experimental ideal</em></li>
</ul>
</section>
<section id="no-causation-without-manipulation" class="level2">
<h2 class="anchored" data-anchor-id="no-causation-without-manipulation">No Causation without Manipulation?</h2>
<ul>
<li>“No causation without manipulation” - <a href="https://www.jstor.org/stable/2289064" target="_blank">Holland (1986)</a></li>
<li>Causal effects are well defined when we can imagine manipulating (changing) the value of <span class="math inline">\(D_i\)</span> and only <span class="math inline">\(D_i\)</span></li>
<li>But what about the “effects” of things like:
<ul>
<li>Race</li>
<li>Sex</li>
<li>Democracy</li>
</ul></li>
<li>Studying the effects of these factors requires strong theory and clever design <a href="https://scholar.harvard.edu/files/msen/files/race_causality.pdf" target="_blank">Sen and Wasow (2016)</a></li>
</ul>
<p>class:inverse, center, middle</p>
</section>
</section>
<section id="section-1" class="level1">
<h1>🔍</h1>
</section>
<section id="summary" class="level1">
<h1>Summary</h1>
</section>
<section id="causal-inference" class="level1">
<h1>Causal Inference</h1>
<p>–</p>
<ul>
<li>Causal Claims involve counterfactual comparisons</li>
</ul>
<p>–</p>
<ul>
<li>The fundamental problem of causal inference is that for an individual only observe one of many potential outcomes</li>
</ul>
<p>–</p>
<ul>
<li>Causal identification refers to the assumptions necessary to generate credible causal estimates</li>
</ul>
<p>–</p>
<ul>
<li>Experimental designs are identified by the random assignment of treatment which allows us to produce unbiased estimates of the <strong>Average Treatment Effect</strong></li>
</ul>
<p>–</p>
<ul>
<li>Estimates are unbiased if, on average, they’re equal to the trut <span class="math inline">\((E[\hat{\theta} - \theta] = 0 )\)</span></li>
</ul>
<p>–</p>
<ul>
<li>Two kinds of bias:
<ul>
<li>Confounding occurs when we <strong>fail to control</strong> for factors that influence both our outcome and explanatory variables</li>
<li>Colliding bias occurs when we <strong>control</strong> for factors influenced by both our outcome and explanatory variables</li>
</ul></li>
</ul>
<p>class: inverse, center, middle # 💪<br>
# Estimating an average treatment effect with the <code>resume</code> data</p>
<section id="the-resume-experiment-p.-33" class="level2">
<h2 class="anchored" data-anchor-id="the-resume-experiment-p.-33">The Resume Experiment (p.&nbsp;33)</h2>
<p>Let’s take a look at the resume experiment from your text book and compare some of Imai’s code to its <code>tidyverse</code> equivalent</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># make sure qss package is loaded</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(qss)</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">"resume"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="high-level-overview-p.-34" class="level2">
<h2 class="anchored" data-anchor-id="high-level-overview-p.-34">High level Overview (p.&nbsp;34)</h2>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(resume)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 4870    4</code></pre>
</div>
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(resume)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  firstname    sex  race call
1   Allison female white    0
2   Kristen female white    0
3   Lakisha female black    0
4   Latonya female black    0
5    Carrie female white    0
6       Jay   male white    0</code></pre>
</div>
</div>
</section>
<section id="high-level-overview-p.-34-1" class="level2">
<h2 class="anchored" data-anchor-id="high-level-overview-p.-34-1">High level Overview (p.&nbsp;34)</h2>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(resume)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  firstname             sex                race                call        
 Length:4870        Length:4870        Length:4870        Min.   :0.00000  
 Class :character   Class :character   Class :character   1st Qu.:0.00000  
 Mode  :character   Mode  :character   Mode  :character   Median :0.00000  
                                                          Mean   :0.08049  
                                                          3rd Qu.:0.00000  
                                                          Max.   :1.00000  </code></pre>
</div>
</div>
</section>
<section id="cross-tabs" class="level2">
<h2 class="anchored" data-anchor-id="cross-tabs">Cross Tabs</h2>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>race.call.tab <span class="ot">&lt;-</span> <span class="fu">table</span>(<span class="at">race =</span> resume<span class="sc">$</span>race,</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>                       <span class="at">call =</span> resume<span class="sc">$</span>call)</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>race.call.tab</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       call
race       0    1
  black 2278  157
  white 2200  235</code></pre>
</div>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">addmargins</span>(race.call.tab)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       call
race       0    1  Sum
  black 2278  157 2435
  white 2200  235 2435
  Sum   4478  392 4870</code></pre>
</div>
</div>
</section>
<section id="tidy-cross-tab" class="level2">
<h2 class="anchored" data-anchor-id="tidy-cross-tab">Tidy cross tab</h2>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>resume <span class="sc">%&gt;%</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(race, call)<span class="sc">%&gt;%</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">n =</span> <span class="fu">n</span>()</span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>  )<span class="sc">%&gt;%</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> call, <span class="at">values_from =</span> n)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 3
# Groups:   race [2]
  race    `0`   `1`
  &lt;chr&gt; &lt;int&gt; &lt;int&gt;
1 black  2278   157
2 white  2200   235</code></pre>
</div>
</div>
</section>
<section id="calculating-call-back-rates" class="level2">
<h2 class="anchored" data-anchor-id="calculating-call-back-rates">Calculating Call Back Rates</h2>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Overall</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(race.call.tab[,<span class="dv">2</span>])<span class="sc">/</span><span class="fu">nrow</span>(resume)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.08049281</code></pre>
</div>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Black names</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>cb_bl <span class="ot">&lt;-</span> <span class="fu">sum</span>(race.call.tab[<span class="dv">1</span>,<span class="dv">2</span>])<span class="sc">/</span><span class="fu">sum</span>(race.call.tab[<span class="dv">1</span>,])</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a><span class="co"># White Names</span></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>cb_wh <span class="ot">&lt;-</span> <span class="fu">sum</span>(race.call.tab[<span class="dv">2</span>,<span class="dv">2</span>])<span class="sc">/</span><span class="fu">sum</span>(race.call.tab[<span class="dv">2</span>,])</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a><span class="co"># ATE</span></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>cb_wh <span class="sc">-</span> cb_bl</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.03203285</code></pre>
</div>
</div>
</section>
<section id="calculating-call-back-rates-with-group_by" class="level2">
<h2 class="anchored" data-anchor-id="calculating-call-back-rates-with-group_by">Calculating Call Back Rates with group_by()</h2>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>resume <span class="sc">%&gt;%</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(race)<span class="sc">%&gt;%</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">call_back =</span> <span class="fu">mean</span>(call)</span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 2
  race  call_back
  &lt;chr&gt;     &lt;dbl&gt;
1 black    0.0645
2 white    0.0965</code></pre>
</div>
</div>
</section>
<section id="factor-variables-in-base-r" class="level2">
<h2 class="anchored" data-anchor-id="factor-variables-in-base-r">Factor variables in Base R</h2>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>resume<span class="sc">$</span>type <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>resume<span class="sc">$</span>type[resume<span class="sc">$</span>race <span class="sc">==</span> <span class="st">"black"</span> <span class="sc">&amp;</span> resume<span class="sc">$</span>sex <span class="sc">==</span> <span class="st">"female"</span>] <span class="ot">&lt;-</span> <span class="st">"BlackFemale"</span></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>resume<span class="sc">$</span>type[resume<span class="sc">$</span>race <span class="sc">==</span> <span class="st">"black"</span> <span class="sc">&amp;</span> resume<span class="sc">$</span>sex <span class="sc">==</span> <span class="st">"male"</span>] <span class="ot">&lt;-</span> <span class="st">"BlackMale"</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>resume<span class="sc">$</span>type[resume<span class="sc">$</span>race <span class="sc">==</span> <span class="st">"white"</span> <span class="sc">&amp;</span> resume<span class="sc">$</span>sex <span class="sc">==</span> <span class="st">"female"</span>] <span class="ot">&lt;-</span> <span class="st">"WhiteFemale"</span></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>resume<span class="sc">$</span>type[resume<span class="sc">$</span>race <span class="sc">==</span> <span class="st">"white"</span> <span class="sc">&amp;</span> resume<span class="sc">$</span>sex <span class="sc">==</span> <span class="st">"male"</span>] <span class="ot">&lt;-</span> <span class="st">"WhiteMale"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="factor-variables-in-tidy-r" class="level2">
<h2 class="anchored" data-anchor-id="factor-variables-in-tidy-r">Factor variables in Tidy R</h2>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>resume <span class="sc">%&gt;%</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">type_tidy =</span> <span class="fu">case_when</span>(</span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>      race <span class="sc">==</span> <span class="st">"black"</span> <span class="sc">&amp;</span> sex <span class="sc">==</span> <span class="st">"female"</span> <span class="sc">~</span> <span class="st">"BlackFemale"</span>,</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>      race <span class="sc">==</span> <span class="st">"black"</span> <span class="sc">&amp;</span> sex <span class="sc">==</span> <span class="st">"male"</span> <span class="sc">~</span> <span class="st">"BlackMale"</span>,</span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a>      race <span class="sc">==</span> <span class="st">"white"</span> <span class="sc">&amp;</span> sex <span class="sc">==</span> <span class="st">"female"</span> <span class="sc">~</span> <span class="st">"WhiteFemale"</span>,</span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>      race <span class="sc">==</span> <span class="st">"white"</span> <span class="sc">&amp;</span> sex <span class="sc">==</span> <span class="st">"male"</span> <span class="sc">~</span> <span class="st">"WhiteMale"</span></span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a>  ) <span class="ot">-&gt;</span> resume</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="comparing-approaches" class="level2">
<h2 class="anchored" data-anchor-id="comparing-approaches">Comparing approaches</h2>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(<span class="at">base=</span> resume<span class="sc">$</span>type, <span class="at">tidy=</span> resume<span class="sc">$</span>type_tidy)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>             tidy
base          BlackFemale BlackMale WhiteFemale WhiteMale
  BlackFemale        1886         0           0         0
  BlackMale             0       549           0         0
  WhiteFemale           0         0        1860         0
  WhiteMale             0         0           0       575</code></pre>
</div>
</div>
</section>
<section id="visualizing-call-back-rates-by-name" class="level2">
<h2 class="anchored" data-anchor-id="visualizing-call-back-rates-by-name">Visualizing Call Back Rates by Name</h2>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>resume <span class="sc">%&gt;%</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(race, sex,firstname)<span class="sc">%&gt;%</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">Y =</span> <span class="fu">mean</span>(call),</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">n =</span> <span class="fu">n</span>()</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>  )<span class="sc">%&gt;%</span></span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(Y)) <span class="sc">%&gt;%</span></span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">firstname =</span> forcats<span class="sc">::</span><span class="fu">fct_reorder</span>(firstname,Y)</span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a>  )<span class="sc">%&gt;%</span></span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(Y, firstname,<span class="at">col=</span>race, <span class="at">size=</span>n))<span class="sc">+</span></span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(sex<span class="sc">~</span>.,<span class="at">scales =</span> <span class="st">"free_y"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="03-slides_files/figure-revealjs/unnamed-chunk-42-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:80.0%"></p>
</figure>
</div>
</div>
</div>
<p>class:inverse, center, middle # 💪<br>
# Exploring the data for Broockman and Kalla 2016</p>
</section>
</section>
<section id="reading-academic-papers" class="level1">
<h1>Reading Academic Papers</h1>
<ul>
<li>Reading academic papers is a skill and takes practice.</li>
<li>You should aim to answer the following:
<ul>
<li>What’s the research question?</li>
<li>What’s the theoretical framework?</li>
<li>What’s the empirical design?</li>
<li>What’s are the main results?</li>
</ul></li>
</ul>
<section id="broockman-and-kalla-2016" class="level2">
<h2 class="anchored" data-anchor-id="broockman-and-kalla-2016">Broockman and Kalla (2016)</h2>
<ul>
<li>What’s the research question?</li>
<li>What’s the theoretical framework?</li>
<li>What’s the empirical design?</li>
<li>What’s are the main results?</li>
</ul>
</section>
<section id="study-design-a-placebo-controlled-field-experiment" class="level2">
<h2 class="anchored" data-anchor-id="study-design-a-placebo-controlled-field-experiment">Study Design :A placebo-controlled field experiment</h2>
<ol type="1">
<li>Recruited from voter files to complete a baseline survey</li>
<li>Among those who complete the survey, half are assigned to receive an intervention and half are assigned to receive a placebo</li>
<li>Only some are actually home or open the door when the canvassers knock.</li>
<li>These people are then recruited to participate in a series of surveys 3 days, 3 weeks, 6 weeks, and 3 months after the initial intervention.</li>
</ol>
</section>
<section id="data-for-thursday" class="level2">
<h2 class="anchored" data-anchor-id="data-for-thursday">Data for Thursday</h2>
<p>Let’s load the data from the orginal study</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="fu">url</span>(<span class="st">"https://pols1600.paultesta.org/files/data/03_lab.rda"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="codebook" class="level2">
<h2 class="anchored" data-anchor-id="codebook">Codebook</h2>
<ul>
<li><code>completed_baseline</code> whether someone completed the baseline survey (“Survey”) or not (“No Survey”)</li>
<li><code>treatment_assigned</code> what intervention someone who completed the baseline survey was assigned two (treatment= “Trans-Equality”, placebo = “Recycling”)</li>
<li><code>answered_door</code> whether someone answered the door (“Yes”) or not (“No”) when a canvasser came to their door</li>
<li><code>treatment_group</code> the treatment assignments of those who answered the door (treatment= “Trans-Equality”, placebo = “Recycling”)</li>
<li><code>vf_age</code> the age of the person in years</li>
<li><code>vf_female</code> the respondent’s sex (female = 1, male = 0)</li>
<li><code>vf_democrat</code> whether the person was a registered Democract (Democrat=1, 0 otherwise)</li>
<li><code>vf_white</code> whether the person was white (White=1, 0 otherwise)</li>
<li><code>vf_vg_12</code> whether the person voted in the 2012 general election (voted = 1, 0 otherwise)</li>
</ul>
</section>
<section id="hlo" class="level2">
<h2 class="anchored" data-anchor-id="hlo">HLO</h2>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(df)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 68,378
Columns: 14
$ completed_baseline &lt;chr&gt; "No Survey", "No Survey", "No Survey", "No Survey",…
$ treatment_assigned &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
$ answered_door      &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
$ treatment_group    &lt;chr&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
$ vf_age             &lt;dbl&gt; 23.00000, 38.00000, 48.00000, 49.20192, 49.20192, 4…
$ vf_female          &lt;dbl&gt; 0, 1, 0, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 1, 1, …
$ vf_democrat        &lt;dbl&gt; 1, 0, 0, 0, 0, 0, 0, 1, 0, 0, 1, 0, 1, 1, 0, 0, 1, …
$ vf_white           &lt;dbl&gt; 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0, …
$ vf_vg_12           &lt;dbl&gt; 0, 0, 1, 0, 0, 1, 0, 1, 1, 0, 1, 0, 1, 1, 0, 0, 1, …
$ therm_trans_t0     &lt;int&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
$ therm_trans_t1     &lt;int&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
$ therm_trans_t2     &lt;int&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
$ therm_trans_t3     &lt;int&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…
$ therm_trans_t4     &lt;int&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA,…</code></pre>
</div>
</div>
</section>
<section id="study-design" class="level2">
<h2 class="anchored" data-anchor-id="study-design">Study Design</h2>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(df<span class="sc">$</span>completed_baseline)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
No Survey    Survey 
    66553      1825 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(df<span class="sc">$</span>treatment_assigned)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
     Recycling Trans-Equality 
           913            912 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(df<span class="sc">$</span>answered_door)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
  No  Yes 
1324  501 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(df<span class="sc">$</span>treatment_group)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
     Recycling Trans-Equality 
           255            246 </code></pre>
</div>
</div>
</section>
<section id="assessing-balance-in-covariates" class="level2">
<h2 class="anchored" data-anchor-id="assessing-balance-in-covariates">Assessing balance in covariates</h2>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(completed_baseline <span class="sc">==</span> <span class="st">"Survey"</span>) <span class="sc">%&gt;%</span></span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(treatment_assigned,<span class="fu">starts_with</span>(<span class="st">"vf_"</span>))<span class="sc">%&gt;%</span></span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(treatment_assigned)<span class="sc">%&gt;%</span></span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="fu">starts_with</span>(<span class="st">"vf_"</span>), mean))<span class="ot">-&gt;</span>pretreatment_balance</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="assessing-balance-in-covariates-1" class="level2">
<h2 class="anchored" data-anchor-id="assessing-balance-in-covariates-1">Assessing balance in covariates</h2>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>pretreatment_balance</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 6
  treatment_assigned vf_age vf_female vf_democrat vf_white vf_vg_12
  &lt;chr&gt;               &lt;dbl&gt;     &lt;dbl&gt;       &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;
1 Recycling            46.3     0.593       0.463    0.209    0.757
2 Trans-Equality       47.7     0.582       0.488    0.217    0.719</code></pre>
</div>
</div>
</section>
<section id="assessing-balance-in-covariates-2" class="level2">
<h2 class="anchored" data-anchor-id="assessing-balance-in-covariates-2">Assessing balance in covariates</h2>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>pretreatment_balance <span class="sc">%&gt;%</span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gather</span>(.,<span class="at">key =</span> covariate, <span class="at">value =</span> value, <span class="sc">-</span>treatment_assigned) <span class="sc">%&gt;%</span></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">spread</span>(treatment_assigned, value) <span class="sc">%&gt;%</span></span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">Difference =</span> <span class="st">`</span><span class="at">Trans-Equality</span><span class="st">`</span> <span class="sc">-</span> Recycling</span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 4
  covariate   Recycling `Trans-Equality` Difference
  &lt;chr&gt;           &lt;dbl&gt;            &lt;dbl&gt;      &lt;dbl&gt;
1 vf_age         46.3             47.7      1.40   
2 vf_democrat     0.463            0.488    0.0246 
3 vf_female       0.593            0.582   -0.0103 
4 vf_vg_12        0.757            0.719   -0.0375 
5 vf_white        0.209            0.217    0.00790</code></pre>
</div>
</div>


</section>
</section>

</main> <!-- /main -->

<script>
  // htmlwidgets need to know to resize themselves when slides are shown/hidden.
  // Fire the "slideenter" event (handled by htmlwidgets.js) when the current
  // slide changes (different for each slide format).
  (function () {
    // dispatch for htmlwidgets
    function fireSlideEnter() {
      const event = window.document.createEvent("Event");
      event.initEvent("slideenter", true, true);
      window.document.dispatchEvent(event);
    }

    function fireSlideChanged(previousSlide, currentSlide) {
      fireSlideEnter();

      // dispatch for shiny
      if (window.jQuery) {
        if (previousSlide) {
          window.jQuery(previousSlide).trigger("hidden");
        }
        if (currentSlide) {
          window.jQuery(currentSlide).trigger("shown");
        }
      }
    }

    // hookup for slidy
    if (window.w3c_slidy) {
      window.w3c_slidy.add_observer(function (slide_num) {
        // slide_num starts at position 1
        fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);
      });
    }

  })();
</script>

<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>